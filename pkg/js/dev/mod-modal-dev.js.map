{"version":3,"sources":["mod-modal.js"],"names":["$","MyAMS","_initialized","modal","init","config","ajaxNav","document","on","evt","source","currentTarget","handlers","data","stopPropagation","preventDefault","require","then","open","zIndexModal","dialog","target","visibleModalsCount","length","zIndex","css","setTimeout","not","first","addClass","off","parents","form","confirmChangedForm","status","fn","Constructor","prototype","_checkScrollbar","_setScrollbar","initElement","element","options","Promise","resolve","reject","sourceData","url","attr","amsUrl","urlGetter","core","getFunctionByName","call","startsWith","ajax","type","cache","amsAllowCache","undefined","request","response","getResponse","dataType","contentType","result","handleJSON","content","wrap","parent","dialogData","dialogOptions","backdrop","settings","extend","amsOptions","executeFunctionByName","amsInit","append","show","hidden","stats","amsLogEvent","logPageview","initContent","close","objectOrParentWithClass","clearContent","remove","env","bundle","modules","push","console","debug"],"mappings":"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","sourcesContent":["/**\n * MyAMS modal dialogs support\n */\n\nconst $ = MyAMS.$;\n\nlet _initialized = false;\n\n\nexport const modal = {\n\n\tinit: () => {\n\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\n\t\tif (MyAMS.config.ajaxNav) {\n\t\t\t// Initialize modal dialogs links\n\t\t\t$(document).on('click', '[data-toggle=\"modal\"]', (evt) => {\n\t\t\t\tconst source = $(evt.currentTarget),\n\t\t\t\t\t  handlers = source.data('ams-disabled-handlers');\n\t\t\t\tif ((handlers === true) ||\n\t\t\t\t\t(handlers === 'click') ||\n\t\t\t\t\t(handlers === 'all')) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (source.data('ams-context-menu') === true) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (source.data('ams-stop-propagation') === true) {\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t}\n\t\t\t\tevt.preventDefault();\n\t\t\t\tMyAMS.require('modal').then(() => {\n\t\t\t\t\tMyAMS.modal.open(source);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Handle modal events to allow modals stacking\n\t\t */\n\t\tlet zIndexModal = 1100;\n\n\t\t$(document).on('shown.bs.modal', '.modal', (evt) => {\n\t\t\t// Enable modals stacking\n\t\t\tconst dialog = $(evt.target),\n\t\t\t\t  visibleModalsCount = $('.modal:visible').length,\n\t\t\t\t  zIndex = zIndexModal + (100 * visibleModalsCount);\n\t\t\tdialog.css('z-index', zIndex);\n\t\t\tsetTimeout(() => {\n\t\t\t\t$('.modal-backdrop').not('.modal-stack')\n\t\t\t\t\t\t\t\t\t.first()\n\t\t\t\t\t\t\t\t\t.css('z-index', zIndex - 10)\n\t\t\t\t\t\t\t\t\t.addClass('modal-stack');\n\t\t\t}, 0);\n\t\t\t// Check form contents before closing modals\n\t\t\t$(dialog).off('click', '[data-dismiss=\"modal\"]')\n\t\t\t\t\t .on('click', '[data-dismiss=\"modal\"]', (evt) => {\n\t\t\t\tconst source = $(evt.currentTarget),\n\t\t\t\t\t  dialog = source.parents('.modal').first();\n\t\t\t\tdialog.data('modal-result', $(evt.currentTarget).data('modal-dismiss-value'));\n\t\t\t\tif (MyAMS.form) {\n\t\t\t\t\tMyAMS.form.confirmChangedForm(dialog).then((status) => {\n\t\t\t\t\t\tif (status === 'success') {\n\t\t\t\t\t\t\tdialog.modal('hide');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tdialog.modal('hide');\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$(document).on('hidden.bs.modal', '.modal', () => {\n\t\t\tif ($('.modal:visible').length > 0) {\n\t\t\t\t$.fn.modal.Constructor.prototype._checkScrollbar();\n\t\t\t\t$.fn.modal.Constructor.prototype._setScrollbar();\n\t\t\t\t$('body').addClass('modal-open');\n\t\t\t}\n\t\t});\n\t},\n\n\tinitElement: (element) => {\n\t},\n\n\topen: (source, options) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet sourceData = {},\n\t\t\t\turl = source;\n\t\t\tif (typeof source !== 'string') {\n\t\t\t\tsourceData = source.data();\n\t\t\t\turl = source.attr('href') || sourceData.amsUrl;\n\t\t\t\tconst urlGetter = MyAMS.core.getFunctionByName(url);\n\t\t\t\tif (typeof urlGetter === 'function') {\n\t\t\t\t\turl = urlGetter.call(source);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!url) {\n\t\t\t\treject(\"No provided URL!\");\n\t\t\t}\n\t\t\tif (url.startsWith('#')) {  // Open inner modal\n\t\t\t\t$(url).modal('show');\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\t$.ajax({\n\t\t\t\t\ttype: 'get',\n\t\t\t\t\turl: url,\n\t\t\t\t\tcache: sourceData.amsAllowCache === undefined ? false : sourceData.amsAllowCache,\n\t\t\t\t\tdata: options\n\t\t\t\t}).then((data, status, request) => {\n\t\t\t\t\tMyAMS.require('ajax').then(() => {\n\t\t\t\t\t\tconst response = MyAMS.ajax.getResponse(request),\n\t\t\t\t\t\t\t  dataType = response.contentType,\n\t\t\t\t\t\t\t  result = response.data;\n\t\t\t\t\t\tswitch (dataType) {\n\t\t\t\t\t\t\tcase 'json':\n\t\t\t\t\t\t\t\tMyAMS.ajax.handleJSON(result,\n\t\t\t\t\t\t\t\t\t$($(source).data('ams-json-target') || '#content'));\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'script':\n\t\t\t\t\t\t\tcase 'xml':\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'html':\n\t\t\t\t\t\t\tcase 'text':\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tconst content = $(result),\n\t\t\t\t\t\t\t\t\tdialog = $('.modal-dialog', content.wrap('<div></div>').parent()),\n\t\t\t\t\t\t\t\t\tdialogData = dialog.data() || {},\n\t\t\t\t\t\t\t\t\tdialogOptions = {\n\t\t\t\t\t\t\t\t\t\tbackdrop: dialogData.backdrop === undefined ? 'static' : dialogData.backdrop\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tlet settings = $.extend({}, dialogOptions, dialogData.amsOptions);\n\t\t\t\t\t\t\t\tsettings = MyAMS.core.executeFunctionByName(dialogData.amsInit, dialog, settings) || settings;\n\t\t\t\t\t\t\t\t$('<div>').addClass('modal fade')\n\t\t\t\t\t\t\t\t\t\t  .data('dynamic', true)\n\t\t\t\t\t\t\t\t\t\t  .append(content)\n\t\t\t\t\t\t\t\t\t\t  .on('show.bs.modal', modal.show)\n\t\t\t\t\t\t\t\t\t\t  .on('hidden.bs.modal', modal.hidden)\n\t\t\t\t\t\t\t\t\t\t  .modal(settings);\n\t\t\t\t\t\t\t\tif (MyAMS.stats &&\n\t\t\t\t\t\t\t\t\t!((sourceData.amsLogEvent === false) ||\n\t\t\t\t\t\t\t\t\t  (dialogData.amsLogEvent === false))) {\n\t\t\t\t\t\t\t\t\tMyAMS.stats.logPageview(url);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Dynamic modal 'shown' callback\n\t * This callback is used to initialize modal's viewport size\n\t *\n\t * @param evt: source event\n\t */\n\tshow: (evt) => {\n\t\tconst dialog = $(evt.target);\n\t\tMyAMS.core.initContent(dialog);\n\t},\n\n\t/**\n\t * Close modal associated with given element\n\t *\n\t * @param element: the element contained into closed modal\n\t */\n\tclose: (element) => {\n\t\tif (typeof element === 'string') {\n\t\t\telement = $(element);\n\t\t} else if (typeof element === 'undefined') {\n\t\t\telement = $('.modal-dialog:last');\n\t\t}\n\t\tconst dialog = element.objectOrParentWithClass('modal');\n\t\tif (dialog.length > 0) {\n\t\t\tdialog.modal('hide');\n\t\t}\n\t},\n\n\t/**\n\t * Dynamic modal 'hidden' callback\n\t * This callback is used to remove dynamic modals\n\t *\n\t * @param evt: source event\n\t */\n\thidden: (evt) => {\n\t\tconst dialog = $(evt.target);\n\t\tMyAMS.core.clearContent(dialog);\n\t\tif (dialog.data('dynamic') === true) {\n\t\t\tdialog.remove();\n\t\t}\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (MyAMS.env.bundle) {\n\tMyAMS.config.modules.push('modal');\n} else {\n\tMyAMS.modal = modal;\n\tconsole.debug(\"MyAMS: modal module loaded...\");\n}\n"],"file":"mod-modal-dev.js"}
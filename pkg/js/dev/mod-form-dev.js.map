{"version":3,"file":"mod-form-dev.js","names":["$","MyAMS","templates","jsrender","require","_initialized","form","init","document","on","evt","button","currentTarget","exists","closest","data","resetHandler","customResetHandler","keyCode","ctrlKey","metaKey","first","click","blur","target","length","stopImmediatePropagation","window","checkBeforeUnload","initElement","element","forms","config","warnOnFormChange","each","idx","elt","formData","callback","amsChangedCallback","formChangeCallback","input","inputData","amsIgnoreChange","event","amsChangedEvent","setChanged","core","executeFunctionByName","setFocus","Promise","resolve","reject","setTimeout","focused","process","env","NODE_ENV","get","focus","i18n","FORM_CHANGED_WARNING","confirmChangedForm","then","alert","bigBox","status","title","WARNING","icon","message","resetChanged","attr","clearAlerts","handleDefaultReset","not","remove","removeClassPrefix","removeClass","find","trigger","getFunctionByName","amsResetCallback","undefined","call","amsResetCallbackOptions","removeAttr","amsResetHandler","amsKeepDefault","amsResetKeepDefault","preventDefault","amsResetHandlerOptions","setInvalid","widget","text","addClass","appendTo","getSettings","buttonData","options","defaults","submitWarning","showFormSubmitWarning","getValidators","getFormValidators","checkValidators","checkFormValidators","initSubmitButton","initFormSubmitButton","resetSubmitButton","resetFormSubmitButton","getData","getFormData","initData","initFormData","initDataCallback","getTarget","getFormTarget","initTarget","initFormTarget","getAction","getFormAction","getAjaxSettings","getFormAjaxSettings","getProgressSettings","getFormProgressSettings","getProgressState","getFormProgressState","submit","submitForm","datatype","submitOptions","submitHandler","replace","submitTarget","submitMessage","submitCallback","formSubmitCallback","progressHandler","progressFieldName","progressInterval","progressTarget","progressCallback","progressEndCallback","resetBeforeSubmit","keepModalOpen","resetAfterSubmit","resetFormAfterSubmit","resetTimeout","resetAfterError","resetFormAfterError","downloadTarget","getDownloadTarget","getFormDownloadTarget","initDownloadTarget","initFormDownloadTarget","resetDownloadTarget","resetFormDownloadTarget","settings","extend","extendPrefix","value","extendOnly","handler","amsSubmitButton","submitted","ajax","check","fn","ajaxSubmit","baseURL","extext","postData","veto","action","ajaxSettings","progress","parents","messageBox","WAIT","FORM_SUBMITTED","timeout","result","Map","formValidators","trim","split","validators","push","set","elementValidators","innerIdx","innerElt","size","checks","context","contextValidators","entries","validator","when","apply","output","results","isArray","concat","header","ERROR_OCCURED","ERRORS_OCCURED","parent","prop","html","amsFormData","name","val","TARGET_INIT_TEMPLATE_STRING","TARGET_INIT_TEMPLATE","markup","render","url","formHandler","startsWith","location","protocol","getAddr","base","type","cache","dataType","beforeSerialize","tinyMCE","triggerSave","beforeSubmit","uploadProgress","position","total","completed","css","complete","xhr","success","request","closeForm","modal","close","error","iframe","fieldname","generateUUID","interval","endCallback","_getProgressState","post","PROGRESS","current","_clearProgressState","clearTimeout","response","getResponse","contentType","handleJSON","opacity","delay","animate","initContent","helpers","scrollTo","offset","getResponseHeader","removeData","reset","hide","dom","root","iframeTarget","keepModal","stop","bundle","modules","console","debug"],"sources":["mod-form.js"],"sourcesContent":["/* global MyAMS, tinyMCE */\n/**\n * MyAMS forms support\n */\n\nconst $ = MyAMS.$;\n\nif (!$.templates) {\n\tconst jsrender = require('jsrender');\n\t$.templates = jsrender.templates;\n}\n\n\nlet _initialized = false;\n\n\n/**\n * MyAMS \"form\" module\n */\nexport const form = {\n\n\tinit: () => {\n\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\n\t\t// Add click listener on submit buttons\n\t\t$(document).on('click', '[type=\"submit\"], .submit', (evt) => {\n\t\t\tconst button = $(evt.currentTarget);\n\t\t\tif (button.exists()) {\n\t\t\t\t$(button).closest('form').data('ams-submit-button', button);\n\t\t\t}\n\t\t});\n\n\t\t// Cancel clicks on readonly checkbox\n\t\t$(document).on('click', 'input[type=\"checkbox\"][readonly]', () => {\n\t\t\treturn false;\n\t\t});\n\n\t\t// Initialize generic and custom reset handlers\n\t\t$(document).on('reset', MyAMS.form.resetHandler);\n\t\t$(document).on('reset', '[data-ams-reset-handler]', MyAMS.form.customResetHandler);\n\n\t\t// Submit form when CTRL+Enter key is pressed in textarea\n\t\t$(document).on('keydown', 'textarea', (evt) => {\n\t\t\tif ((evt.keyCode === 10 || evt.keyCode === 13) && (evt.ctrlKey || evt.metaKey)) {\n\t\t\t\tconst form = $(evt.currentTarget).closest('form');\n\t\t\t\t$('button[type=\"submit\"]', form).first().click();\n\t\t\t}\n\t\t});\n\n\t\t// Always blur readonly inputs\n\t\t$(document).on('focus', 'input[readonly]', (evt) => {\n\t\t\t$(evt.currentTarget).blur();\n\t\t});\n\n\t\t// Prevent bootstrap dialog from blocking TinyMCE focus\n\t\t$(document).on('focusin', (evt) => {\n\t\t\tif ($(evt.target).closest('.mce-window').length >= 0) {\n\t\t\t\tevt.stopImmediatePropagation();\n\t\t\t}\n\t\t});\n\n\t\t// Add unload event listener to check for modified forms\n\t\t$(window).on('beforeunload', MyAMS.form.checkBeforeUnload);\n\t},\n\n\tinitElement: (element) => {\n\n\t\tif (typeof element === 'string') {\n\t\t\telement = $(element);\n\t\t}\n\n\t\tlet forms;\n\t\tif (MyAMS.config.warnOnFormChange) {\n\t\t\tforms = $('form[data-ams-warn-on-change!=\"false\"]', element);\n\t\t} else {\n\t\t\tforms = $('form[data-ams-warn-on-change=\"true\"]', element);\n\t\t}\n\t\tforms.each((idx, elt) => {\n\t\t\tconst\n\t\t\t\tform = $(elt),\n\t\t\t\tformData = form.data(),\n\t\t\t\tcallback = formData.amsChangedCallback || MyAMS.config.formChangeCallback;\n\t\t\t$('input, select, textarea, [data-ams-changed-event]', form).each((idx, elt) => {\n\t\t\t\tconst\n\t\t\t\t\tinput = $(elt),\n\t\t\t\t\tinputData = input.data();\n\t\t\t\tif (inputData.amsIgnoreChange !== true) {\n\t\t\t\t\tconst event = inputData.amsChangedEvent || 'change';\n\t\t\t\t\tinput.on(event, () => {\n\t\t\t\t\t\tMyAMS.form.setChanged(form);\n\t\t\t\t\t\tMyAMS.core.executeFunctionByName(inputData.amsChangedCallback ||\n\t\t\t\t\t\t\tcallback, document, form, input);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tMyAMS.form.setFocus(element);\n\t},\n\n\tsetFocus: (element) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tlet focused = $('[data-ams-focus-target]', element).first();\n\t\t\t\tif (!focused.exists()) {\n\t\t\t\t\tif (window?.process?.env?.NODE_ENV === 'test') {\n\t\t\t\t\t\tfocused = $('input, select, textarea', element).first();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfocused = $('input:enabled:visible, ' +\n\t\t\t\t\t\t\t'select:enabled:visible, ' +\n\t\t\t\t\t\t\t'textarea:enabled:visible', element).first();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (focused.exists()) {\n\t\t\t\t\tfocused.get(0).focus();\n\t\t\t\t}\n\t\t\t\tresolve(focused);\n\t\t\t}, 100);\n\t\t});\n\t},\n\n\tcheckBeforeUnload: () => {\n\t\tif (MyAMS.i18n) {\n\t\t\tconst forms = $('form[data-ams-form-changed=\"true\"]');\n\t\t\tif (forms.exists()) {\n\t\t\t\treturn MyAMS.i18n.FORM_CHANGED_WARNING;\n\t\t\t}\n\t\t}\n\t},\n\n\tconfirmChangedForm: (element) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst forms = $('form[data-ams-form-changed=\"true\"]', element);\n\t\t\tif (forms.exists()) {\n\t\t\t\tMyAMS.require('alert').then(() => {\n\t\t\t\t\tMyAMS.alert.bigBox({\n\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\ttitle: MyAMS.i18n.WARNING,\n\t\t\t\t\t\ticon: 'text-danger fa-bell',\n\t\t\t\t\t\tmessage: MyAMS.i18n.FORM_CHANGED_WARNING\n\t\t\t\t\t}).then((button) => {\n\t\t\t\t\t\tif (button === 'success') {\n\t\t\t\t\t\t\tMyAMS.form.resetChanged(forms);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(button);\n\t\t\t\t\t});\n\t\t\t\t}, () => {\n\t\t\t\t\treject(\"Missing 'alert' module!\");\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tform.resetChanged(forms);\n\t\t\t\tresolve('success');\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Update form \"chenged\" status flag\n\t */\n\tsetChanged: (form) => {\n\t\tform.attr('data-ams-form-changed', true);\n\t},\n\n\t/**\n\t * Default form reset handler\n\t *\n\t * @param event: the original reset event\n\t */\n\tresetHandler: (event) => {\n\t\tconst form = $(event.target);\n\t\tMyAMS.form.clearAlerts(form);\n\t\tMyAMS.form.handleDefaultReset(form);\n\t},\n\n\t/**\n\t * Clear remaining form alerts before submitting form\n\t */\n\tclearAlerts: (form) => {\n\t\t$('.alert-danger, SPAN.state-error', form).not('.persistent').remove();\n\t\t$('.state-error', form).removeClassPrefix('state-');\n\t\t$('.invalid-feedback', form).remove();\n\t\t$('.is-invalid', form).removeClass('is-invalid');\n\t},\n\n\t/**\n\t * Call reset callbacks defined on a form\n\t */\n\thandleDefaultReset: (form) => {\n\t\tsetTimeout(() => {\n\t\t\tform.find('.select2').trigger('change');\n\t\t\t$('[data-ams-reset-callback]', form).each((idx, elt) => {\n\t\t\t\tconst\n\t\t\t\t\telement = $(elt),\n\t\t\t\t\tdata = element.data(),\n\t\t\t\t\tcallback = MyAMS.core.getFunctionByName(data.amsResetCallback);\n\t\t\t\tif (callback !== undefined) {\n\t\t\t\t\tcallback.call(document, form, element, data.amsResetCallbackOptions);\n\t\t\t\t}\n\t\t\t});\n\t\t\tMyAMS.form.resetChanged(form);\n\t\t}, 10);\n\t},\n\n\t/**\n\t * Reset form changed flag\n\t */\n\tresetChanged: (form) => {\n\t\tif (form !== undefined) {\n\t\t\t$(form).removeAttr('data-ams-form-changed');\n\t\t}\n\t},\n\n\t/**\n\t * Custom reset handler\n\t */\n\tcustomResetHandler: (event) => {\n\t\tconst\n\t\t\tform = $(event.target),\n\t\t\tdata = form.data();\n\t\tif (data.amsResetHandler) {\n\t\t\tif ((data.amsKeepDefault !== true) && (data.amsResetKeepDefault !== true)) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\tconst callback = MyAMS.core.getFunctionByName(data.amsResetHandler);\n\t\t\tif (callback !== undefined) {\n\t\t\t\tcallback.call(document, event, form, data.amsResetHandlerOptions);\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Set widget's invalid status\n\t *\n\t * @param form: parent form\n\t * @param input: input name\n\t * @param message: associated message\n\t */\n\tsetInvalid: (form, input, message) => {\n\t\tif (typeof input === 'string') {\n\t\t\tinput = $(`[name=\"${input}\"]`, form);\n\t\t}\n\t\tif (input.exists()) {\n\t\t\tconst widget = input.closest('.form-widget');\n\t\t\t$('.invalid-feedback', widget).remove();\n\t\t\t$('<span>')\n\t\t\t\t.text(message)\n\t\t\t\t.addClass('is-invalid invalid-feedback')\n\t\t\t\t.appendTo(widget);\n\t\t\tinput.removeClass('valid')\n\t\t\t\t.addClass('is-invalid');\n\t\t}\n\t},\n\n\t/**\n\t * Get all settings for given form\n\t *\n\t * @param form: submitted form\n\t * @param formData: form data\n\t * @param button: submit button\n\t * @param buttonData: submit button data\n\t * @param options: submit options\n\t */\n\tgetSettings: (form, formData, button, buttonData, options) => {\n\t\tconst\n\t\t\tdefaults = {\n\t\t\t\tsubmitWarning: showFormSubmitWarning,\n\t\t\t\tgetValidators: getFormValidators,\n\t\t\t\tcheckValidators: checkFormValidators,\n\t\t\t\tclearAlerts: MyAMS.form.clearAlerts,\n\t\t\t\tinitSubmitButton: initFormSubmitButton,\n\t\t\t\tresetSubmitButton: resetFormSubmitButton,\n\t\t\t\tgetData: getFormData,\n\t\t\t\tinitData: initFormData,\n\t\t\t\tinitDataCallback: null,\n\t\t\t\tgetTarget: getFormTarget,\n\t\t\t\tinitTarget: initFormTarget,\n\t\t\t\tgetAction: getFormAction,\n\t\t\t\tgetAjaxSettings: getFormAjaxSettings,\n\t\t\t\tgetProgressSettings: getFormProgressSettings,\n\t\t\t\tgetProgressState: getFormProgressState,\n\t\t\t\tsubmit: submitForm,\n\t\t\t\tdatatype: null,\n\t\t\t\tsubmitOptions: null,\n\t\t\t\tsubmitHandler: (form.attr('action') || '').replace(/#/, ''),\n\t\t\t\tsubmitTarget: form.attr('target') || null,\n\t\t\t\tsubmitMessage: null,\n\t\t\t\tsubmitCallback: formSubmitCallback,\n\t\t\t\tprogressHandler: null,\n\t\t\t\tprogressFieldName: 'progressId',\n\t\t\t\tprogressInterval: 1000,\n\t\t\t\tprogressTarget: null,\n\t\t\t\tprogressCallback: null,\n\t\t\t\tprogressEndCallback: null,\n\t\t\t\tresetBeforeSubmit: false,\n\t\t\t\tkeepModalOpen: false,\n\t\t\t\tresetAfterSubmit: resetFormAfterSubmit,\n\t\t\t\tresetTimeout: 1000,\n\t\t\t\tresetAfterError: resetFormAfterError,\n\t\t\t\tdownloadTarget: null,\n\t\t\t\tgetDownloadTarget: getFormDownloadTarget,\n\t\t\t\tinitDownloadTarget: initFormDownloadTarget,\n\t\t\t\tresetDownloadTarget: resetFormDownloadTarget\n\t\t\t},\n\t\t\tsettings = $.extend({}, defaults);\n\n\t\t// extend default values with form, button and options properties\n\t\t$.extendPrefix(settings, 'amsForm', (value) => {\n\t\t\treturn MyAMS.core.getFunctionByName(value) || value;\n\t\t}, formData, buttonData);\n\t\t$.extendOnly(settings, (value) => {\n\t\t\treturn MyAMS.core.getFunctionByName(value) || value;\n\t\t}, options);\n\n\t\treturn settings;\n\t},\n\n\t/**\n\t * Submit given form\n\t *\n\t * @param form: input form\n\t * @param handler: AJAX submit target\n\t * @param options: submit options\n\t */\n\tsubmit: (form, handler, options={}) => {\n\n\t\t// check arguments\n\t\tform = $(form);\n\t\tif (!form.exists()) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof handler === 'object') {\n\t\t\toptions = handler;\n\t\t\thandler = undefined;\n\t\t}\n\n\t\t// initialize default settings\n\t\tconst\n\t\t\tformData = form.data(),\n\t\t\tbutton = $(formData.amsSubmitButton),\n\t\t\tbuttonData = button.data() || {},\n\t\t\tsettings = MyAMS.form.getSettings(form, formData, button, buttonData, options);\n\n\t\t// prevent multiple submits\n\t\tif (formData.submitted) {\n\t\t\tsettings.submitWarning(form, settings);\n\t\t\treturn false;\n\t\t}\n\n\t\t// check custom submit validators\n\t\tsettings.checkValidators(form, settings).then((status) => {\n\n\t\t\t// check validation status\n\t\t\tif (status !== 'success') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// submit form\n\t\t\tMyAMS.require('ajax', 'i18n').then(() => {\n\t\t\t\tMyAMS.ajax.check($.fn.ajaxSubmit,\n\t\t\t\t\t`${MyAMS.env.baseURL}../ext/jquery-form${MyAMS.env.extext}.js`).then(() => {\n\n\t\t\t\t\t// clear alerts and initialize submit button\n\t\t\t\t\tsettings.clearAlerts(form, settings);\n\t\t\t\t\tsettings.initSubmitButton(form, settings, button);\n\n\t\t\t\t\t// extract and initialize custom submit data\n\t\t\t\t\tconst\n\t\t\t\t\t\tpostData = settings.getData(form, settings, formData, button, buttonData, options),\n\t\t\t\t\t\tveto = { veto: false };\n\t\t\t\t\tsettings.initData(form, settings, button, postData, options, veto);\n\t\t\t\t\tif (veto.veto) {\n\t\t\t\t\t\tsettings.resetSubmitButton(form, settings, button);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// get and initialize post target\n\t\t\t\t\tconst target = settings.getTarget(form, settings, formData, buttonData);\n\t\t\t\t\tif (target && target.exists()) {\n\t\t\t\t\t\tsettings.initTarget(form, settings, target);\n\t\t\t\t\t}\n\n\t\t\t\t\t// get form action and POST settings\n\t\t\t\t\tconst\n\t\t\t\t\t\taction = settings.getAction(form, settings, handler),\n\t\t\t\t\t\tajaxSettings = settings.getAjaxSettings(form, settings,\n\t\t\t\t\t\t\tbutton, postData, action, target);\n\n\t\t\t\t\t// get and initialize download target\n\t\t\t\t\tconst downloadTarget = settings.getDownloadTarget(form, settings);\n\t\t\t\t\tif (downloadTarget) {\n\t\t\t\t\t\tsettings.initDownloadTarget(form, settings, downloadTarget, ajaxSettings);\n\t\t\t\t\t}\n\n\t\t\t\t\t// get progress settings\n\t\t\t\t\tajaxSettings.progress = settings.getProgressSettings(form, settings,\n\t\t\t\t\t\tbutton, postData);\n\n\t\t\t\t\t// YESSSS!!!!\n\t\t\t\t\t// submit form!!\n\t\t\t\t\tsettings.submit(form, settings, button, postData, ajaxSettings, target);\n\t\t\t\t\tif (downloadTarget) {\n\t\t\t\t\t\tsettings.resetDownloadTarget(form, settings, button, downloadTarget, ajaxSettings);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t// disable standard submit\n\t\treturn false;\n\t},\n\n\t/**\n\t * Submit a form from a button click handler\n\t */\n\tsubmitForm: (evt) => {\n\t\tconst\n\t\t\tbutton = $(evt.currentTarget),\n\t\t\tform = button.parents('form');\n\t\tform.data('ams-submit-button', button);\n\t\tform.submit();\n\t}\n};\n\n\n/**\n * Show warning message if form was already submitted\n *\n * @param form: submitted form\n * @param settings: computed form settings\n */\nexport function showFormSubmitWarning(form /*, settings */) {\n\treturn new Promise((resolve, reject) => {\n\t\tif (!form.data('ams-form-hide-submitted')) {\n\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\tstatus: 'warning',\n\t\t\t\t\ttitle: MyAMS.i18n.WAIT,\n\t\t\t\t\tmessage: MyAMS.i18n.FORM_SUBMITTED,\n\t\t\t\t\ticon: 'fa-save',\n\t\t\t\t\ttimeout: form.data('ams-form-alert-timeout') || 5000\n\t\t\t\t});\n\t\t\t}).then(resolve, reject);\n\t\t} else {\n\t\t\tresolve();\n\t\t}\n\t});\n}\n\n\n/**\n * Extract custom validators from given form\n *\n * @param form: checked form\n * @param settings: computed form settings\n * @returns {Map<any, any>}\n */\nexport function getFormValidators(form /*, settings */) {\n\tconst\n\t\tresult = new Map(),\n\t\tformValidators = (form.data('ams-form-validator') || '').trim().split(/[\\s,;]+/);\n\tlet validators = [];\n\t$(formValidators).each((idx, elt) => {\n\t\tif (!elt) {\n\t\t\treturn;\n\t\t}\n\t\tvalidators.push(elt);\n\t});\n\tif (validators.length > 0) {\n\t\tresult.set(form, validators);\n\t}\n\t$('[data-ams-form-validator]', form).each((idx, elt) => {\n\t\tconst\n\t\t\telement = $(elt),\n\t\t\telementValidators = (element.data('ams-form-validator') || '').trim().split(/[\\s,;]+/);\n\t\tvalidators = [];\n\t\t$(elementValidators).each((innerIdx, innerElt) => {\n\t\t\tif (!innerElt) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvalidators.push(innerElt);\n\t\t})\n\t\tif (validators.length > 0) {\n\t\t\tresult.set(element, validators);\n\t\t}\n\t});\n\treturn result;\n}\n\n\n/**\n * Check custom form validators.\n * A form can handle several form validators which will be called before the form is submitted.\n *\n *\n * @param form: checked form\n * @param settings: computed form settings\n */\nexport function checkFormValidators(form, settings) {\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst validators = settings.getValidators(form, settings);\n\t\tif (!validators.size) {\n\t\t\tresolve('success');\n\t\t\treturn;\n\t\t}\n\t\tconst checks = [];\n\t\tfor (const [context, contextValidators] of validators.entries()) {\n\t\t\tfor (const validator of contextValidators) {\n\t\t\t\tchecks.push(MyAMS.core.executeFunctionByName(validator, document, form, context));\n\t\t\t}\n\t\t}\n\t\t$.when.apply($, checks).then((...results) => {\n\t\t\tlet status = 'success',\n\t\t\t\toutput = [];\n\t\t\tfor (const result of results) {\n\t\t\t\tif (result !== true) {\n\t\t\t\t\tstatus = 'error';\n\t\t\t\t\tif (typeof result === 'string') {\n\t\t\t\t\t\toutput.push(result);\n\t\t\t\t\t} else if ($.isArray(result) && (result.length > 0)) {\n\t\t\t\t\t\toutput = output.concat(result);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (output.length > 0) {\n\t\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\t\tconst header = output.length === 1 ? MyAMS.i18n.ERROR_OCCURED :\n\t\t\t\t\t\tMyAMS.i18n.ERRORS_OCCURED;\n\t\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\t\tparent: form,\n\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\theader: header,\n\t\t\t\t\t\tmessage: output\n\t\t\t\t\t});\n\t\t\t\t\tresolve(status);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tresolve(status);\n\t\t\t}\n\t\t}, () => {\n\t\t\treject('error');\n\t\t});\n\t});\n}\n\n\n/**\n * Initialize form submit button\n * Button is disabled and text is updated\n */\nexport function initFormSubmitButton(form, settings, button) {\n\tconst text = button.data('ams-loading-text') || button.text().trim();\n\tif (text) {\n\t\tbutton.data('original-text', button.text())\n\t\t\t.prop('disabled', true)\n\t\t\t.text(`${text}...`);\n\t\t$('<div>').addClass('progress')\n\t\t\t.appendTo(button);\n\t} else {  // button without text\n\t\tbutton.data('original-html', button.html())\n\t\t\t.prop('disabled', true)\n\t\t\t.html('<i class=\"fa fa-cog fa-spin\"></i>');\n\t}\n}\n\n\n// reset form submit button\nexport function resetFormSubmitButton(form, settings, button) {\n\t$('.progress', button).remove();\n\tconst text = button.data('original-text');\n\tif (text) {\n\t\tbutton.text(text);\n\t} else {\n\t\tconst html = button.data('original-html');\n\t\tif (html) {\n\t\t\tbutton.html(html);\n\t\t}\n\t}\n\tbutton.prop('disabled', false);\n}\n\n\n// get form data\nexport function getFormData(form, settings, formData, button, buttonData, options) {\n\tconst\n\t\tdata = $.extend({}, formData.amsFormData, buttonData.amsFormData, options.data),\n\t\tname = button.attr('name');\n\tif (name) {\n\t\tdata[name] = button.val();\n\t}\n\treturn data;\n}\n\n\n// initialize form data\nexport function initFormData(form, settings, button, postData, options, veto) {\n\tconst callback = settings.initDataCallback;\n\tif (callback) {\n\t\t$.extend(postData, callback(form, settings, button, postData, options, veto));\n\t}\n\tform.trigger('init-data.ams.form', [postData, veto]);\n}\n\n\n// get form target\nexport function getFormTarget(form, settings /*, formData, buttonData */) {\n\treturn $(settings.submitTarget);\n}\n\n\n// initialize form target\nconst TARGET_INIT_TEMPLATE_STRING = `\n\t<div class=\"row m-3\">\n\t\t<div class=\"text-center w-100\">\n\t\t\t<i class=\"fa fa-3x fa-cog fa-spin\"></i>\n\t\t\t{{if message}}\n\t\t\t<strong>{{:message}}</strong>\n\t\t\t{{/if}}\n\t\t</div>\n\t</div>`;\n\nconst TARGET_INIT_TEMPLATE = $.templates({\n\tmarkup: TARGET_INIT_TEMPLATE_STRING\n});\n\nexport function initFormTarget(form, settings, target) {\n\ttarget.html(TARGET_INIT_TEMPLATE.render({ message: settings.submitMessage }));\n\ttarget.parents('.hidden').removeClass('hidden');\n}\n\n\n// get form action\nexport function getFormAction(form, settings, handler) {\n\tlet url;\n\tconst formHandler = handler || settings.submitHandler;\n\tif (formHandler.startsWith(window.location.protocol)) {\n\t\turl = formHandler;\n\t} else {\n\t\turl = MyAMS.ajax.getAddr() + formHandler;\n\t}\n\treturn url;\n}\n\n\n// get AJAX POST submit settings\nexport function getFormAjaxSettings(form, settings, button, postData, action, target) {\n\tconst base = {\n\t\turl: action,\n\t\ttype: 'post',\n\t\tcache: false,\n\t\tdata: postData,\n\t\tdataType: settings.datatype,\n\t\tbeforeSerialize: (form /*, options */) => {\n\t\t\tconst veto = { veto: false };\n\t\t\tform.trigger('before-serialize.ams.form', [veto]);\n\t\t\tif (veto.veto) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (typeof window.tinyMCE !== 'undefined') {\n\t\t\t\ttinyMCE.triggerSave();\n\t\t\t}\n\t\t},\n\t\tbeforeSubmit: (data, form /*, options */) => {\n\t\t\tconst veto = { veto: false };\n\t\t\tform.trigger('before-submit.ams.form', [data, veto]);\n\t\t\tif (veto.veto) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tform.data('submitted', true);\n\t\t\tif (settings.resetBeforeSubmit) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tsettings.resetSubmitButton(form, settings, button);\n\t\t\t\t}, 250);\n\t\t\t}\n\t\t},\n\t\tuploadProgress: (evt, position, total, completed) => {\n\t\t\t$('.progress', button).css('background-image',\n\t\t\t\t`linear-gradient(to right, white -45%, green ${completed}%, red ${completed}%, red)`);\n\t\t},\n\t\tcomplete: (xhr) => {\n\t\t\tform.trigger('complete.ams.form', [xhr]);\n\t\t},\n\t\tsuccess: (result, status, request, form) => {\n\t\t\tconst veto = { veto: false };\n\t\t\tform.trigger('submit-success.ams.form', [result, status, request, veto]);\n\t\t\tif (veto.veto) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (result && result.status !== 'error' && result.closeForm !== false) {\n\t\t\t\tconst modal = form.closest('.modal-dialog');\n\t\t\t\tif (modal.exists() && !settings.keepModalOpen) {\n\t\t\t\t\tMyAMS.modal && MyAMS.modal.close(modal);\n\t\t\t\t}\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tsettings.submitCallback(form, settings, target, result, status, request);\n\t\t\t} finally {\n\t\t\t\tsettings.resetAfterSubmit(form, settings, button);\n\t\t\t\tMyAMS.form.resetChanged(form);\n\t\t\t}\n\t\t},\n\t\terror: (request, status, error, form) => {\n\t\t\tform.trigger('submit-error.ams.form', [request, status, error, target]);\n\t\t\tif (target) {\n\t\t\t\tsettings.resetAfterError(form, settings, button, target);\n\t\t\t}\n\t\t\tsettings.resetAfterSubmit(form, settings, button);\n\t\t},\n\t\tiframe: false\n\t}\n\treturn $.extend({}, base, settings.submitOptions);\n}\n\n\n// get form submit processing progress settings\nexport function getFormProgressSettings(form, settings, button, postData) {\n\tconst handler = settings.progressHandler;\n\tif (handler) {\n\t\t// check fieldname\n\t\tconst fieldname = settings.progressFieldName;\n\t\tpostData[fieldname] = MyAMS.core.generateUUID();\n\t\t// check progress target\n\t\tlet progressTarget = button;\n\t\tif (settings.progressTarget) {\n\t\t\tprogressTarget = $(settings.progressTarget);\n\t\t}\n\t\treturn {\n\t\t\thandler: handler,\n\t\t\tinterval: settings.progressInterval,\n\t\t\tfieldname: fieldname,\n\t\t\ttarget: progressTarget,\n\t\t\tcallback: settings.progressCallback,\n\t\t\tendCallback: settings.progressEndCallback\n\t\t}\n\t}\n}\n\n\n// get form submit progress state\nexport function getFormProgressState(form, settings, postData, progress, target) {\n\n\tlet timeout = setTimeout(_getProgressState, progress.interval);\n\n\tfunction _getProgressState() {\n\t\tconst data = {};\n\t\tdata[progress.fieldname] = postData[progress.fieldname];\n\t\tMyAMS.ajax.post(progress.handler, data)\n\t\t\t.then(MyAMS.core.getFunctionByName(progress.callback || function(result, status) {\n\t\t\t\tif ($.isArray(result)) {\n\t\t\t\t\tstatus = result[1];\n\t\t\t\t\tresult = result[0];\n\t\t\t\t}\n\t\t\t\tif (status === 'success') {\n\t\t\t\t\tif (result.status === 'running') {\n\t\t\t\t\t\tif (result.message) {\n\t\t\t\t\t\t\ttarget.text(result.message);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet text = result.progress || target.data('ams-progress-text') || MyAMS.i18n.PROGRESS;\n\t\t\t\t\t\t\tif (result.current) {\n\t\t\t\t\t\t\t\ttext += `: ${result.current} / ${result.length || 100}`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttext += '...';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttarget.text(text);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttimeout = setTimeout(_getProgressState, progress.interval);\n\t\t\t\t\t} else if (result.status === 'finished') {\n\t\t\t\t\t\t_clearProgressState();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t_clearProgressState();\n\t\t\t\t}\n\t\t\t}), _clearProgressState);\n\t}\n\n\tfunction _clearProgressState() {\n\t\tclearTimeout(timeout);\n\t\tsettings.resetSubmitButton(form, settings, target);\n\t\tMyAMS.core.executeFunctionByName(progress.endCallback, document, form, settings, target);\n\t\tMyAMS.form.resetChanged(form);\n\t}\n}\n\n\n// submit form\nexport function submitForm(form, settings, button, postData, ajaxSettings, target) {\n\tif (ajaxSettings.progress) {\n\t\tsettings.getProgressState(form, settings, postData, ajaxSettings.progress, target);\n\t}\n\tform.ajaxSubmit(ajaxSettings);\n}\n\n\n/**\n * Default form submit callback\n * \n * @param form\n * @param settings: computed form settings\n * @param target\n * @param result\n * @param status\n * @param request\n */\nexport function formSubmitCallback(form, settings, target, result, status, request) {\n\tlet dataType = settings.datatype;\n\tif (!dataType) {\n\t\tconst response = MyAMS.ajax.getResponse(request);\n\t\tif (response) {\n\t\t\tdataType = response.contentType;\n\t\t\tresult = response.data;\n\t\t}\n\t}\n\n\tswitch (dataType) {\n\t\tcase 'binary':\n\t\tcase 'script':\n\t\tcase 'xml':\n\t\t\tbreak;\n\t\tcase 'json':\n\t\t\tMyAMS.ajax.handleJSON(result, form, target);\n\t\t\tbreak;\n\t\tdefault:  // text or html\n\t\t\tMyAMS.form.resetChanged(form);\n\t\t\ttarget.css({ opacity: '0.0' });\n\t\t\ttarget.removeClass('hidden')\n\t\t\t\t.parents('.hidden')\n\t\t\t\t.removeClass('.hidden');\n\t\t\ttarget.html(result)\n\t\t\t\t.delay(50)\n\t\t\t\t.animate({ opacity: '1.0' }, 250);\n\t\t\tMyAMS.core.executeFunctionByName(MyAMS.config.initContent, document, target).then(() => {\n\t\t\t\tMyAMS.require('helpers').then(() => {\n\t\t\t\t\tMyAMS.helpers.scrollTo('#main', target, { offset: -15 });\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tconst callback = request.getResponseHeader('X-AMS-Callback');\n\tif (callback) {\n\t\tconst options = request.getResponseHeader('X-AMS-Callback-Options') || \"{}\";\n\t\tMyAMS.core.executeFunctionByName(callback, document, form, settings, options,\n\t\t\tresult, status, request);\n\t}\n\tform.trigger('after-submit.ams.form', [result]);\n}\n\n\n/**\n * Reset AJAX form after submit\n * \n * @param form: current form\n * @param settings: computed form settings\n * @param button: button used to submit the form, if any\n */\nexport function resetFormAfterSubmit(form, settings, button) {\n\tif (form.data('submitted')) {\n\t\tsettings.resetSubmitButton(form, settings, button);\n\t\tform.data('submitted', false);\n\t\tform.removeData('ams-submit-button');\n\t\tform.trigger('after-reset.ams.form');\n\t\tif (form.data('ams-reset-after-submit')) {\n\t\t\tform.get(0).reset();\n\t\t}\n\t}\n}\n\n\n/**\n * Reset form after submit error\n *\n * @param form: current form\n * @param settings: computed form settings\n * @param target: previous form target\n */\nexport function resetFormAfterError(form, settings, target) {\n\t$('i', target)\n\t\t.removeClass('fa-spin')\n\t\t.removeClass('fa-cog')\n\t\t.addClass('fa-ambulance');\n}\n\n\n// get form download target\nexport function getFormDownloadTarget(form, settings) {\n\treturn settings.downloadTarget;\n}\n\n\n// initialize download target\nexport function initFormDownloadTarget(form, settings, target, ajaxSettings) {\n\tlet iframe = $(`iframe[name=\"${target}\"]`);\n\tif (!iframe.exists()) {\n\t\tiframe = $('<iframe>').attr('name', target)\n\t\t\t.hide()\n\t\t\t.appendTo(MyAMS.dom.root);\n\t}\n\t$.extend(ajaxSettings, {\n\t\tiframe: true,\n\t\tiframeTarget: iframe\n\t});\n}\n\n\n// reset if download target\nexport function resetFormDownloadTarget(form, settings, button, target, ajaxSettings) {\n\tconst\n\t\tmodal = form.closest('.modal-dialog'),\n\t\tkeepModal = settings.keepModalOpen;\n\tif (modal.exists() && (keepModal !== true)) {\n\t\tMyAMS.require('modal').then(() => {\n\t\t\tMyAMS.modal.close(modal);\n\t\t});\n\t}\n\tif (!ajaxSettings.progress) {\n\t\tsetTimeout(() => {\n\t\t\tsettings.resetAfterSubmit(form, settings, button);\n\t\t\tMyAMS.ajax && MyAMS.ajax.stop();\n\t\t\tMyAMS.form.resetChanged(form);\n\t\t}, settings.resetTimeout);\n\t}\n}\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('form');\n\t} else {\n\t\tMyAMS.form = form;\n\t\tconsole.debug(\"MyAMS: form module loaded...\");\n\t}\n}\n"],"mappings":"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"}
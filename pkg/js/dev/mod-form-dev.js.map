{"version":3,"sources":["mod-form.js"],"names":["$","MyAMS","templates","jsrender","require","_initialized","form","init","document","on","evt","button","currentTarget","exists","closest","data","resetHandler","customResetHandler","keyCode","ctrlKey","metaKey","first","click","blur","target","length","stopImmediatePropagation","window","checkBeforeUnload","initElement","element","forms","config","warnOnFormChange","each","idx","elt","formData","callback","amsChangedCallback","formChangeCallback","input","inputData","amsIgnoreChange","event","amsChangedEvent","setChanged","core","executeFunctionByName","setFocus","focused","focus","i18n","FORM_CHANGED_WARNING","confirmChangedForm","Promise","resolve","reject","then","alert","bigBox","status","title","WARNING","icon","message","resetChanged","attr","clearAlerts","handleDefaultReset","not","remove","removeClassPrefix","removeClass","setTimeout","find","trigger","getFunctionByName","amsResetCallback","undefined","call","amsResetCallbackOptions","removeAttr","amsResetHandler","amsKeepDefault","amsResetKeepDefault","preventDefault","amsResetHandlerOptions","setInvalid","widget","text","addClass","appendTo","getSettings","buttonData","options","defaults","submitWarning","showFormSubmitWarning","getValidators","getFormValidators","checkValidators","checkFormValidators","initSubmitButton","initFormSubmitButton","resetSubmitButton","resetFormSubmitButton","getData","getFormData","initData","initFormData","initDataCallback","getTarget","getFormTarget","initTarget","initFormTarget","getAction","getFormAction","getAjaxSettings","getFormAjaxSettings","getProgressSettings","getFormProgressSettings","getProgressState","getFormProgressState","submit","submitForm","datatype","submitOptions","submitHandler","replace","submitTarget","submitMessage","submitCallback","formSubmitCallback","progressHandler","progressFieldName","progressInterval","progressTarget","progressCallback","progressEndCallback","resetBeforeSubmit","keepModalOpen","resetAfterSubmit","resetFormAfterSubmit","resetTimeout","resetAfterError","resetFormAfterError","downloadTarget","getDownloadTarget","getFormDownloadTarget","initDownloadTarget","initFormDownloadTarget","resetDownloadTarget","resetFormDownloadTarget","settings","extend","extendPrefix","value","extendOnly","handler","amsSubmitButton","submitted","ajax","check","fn","ajaxSubmit","env","baseURL","extext","postData","veto","action","ajaxSettings","progress","messageBox","WAIT","FORM_SUBMITTED","timeout","result","Map","formValidators","trim","split","validators","push","set","elementValidators","innerIdx","innerElt","size","checks","entries","context","contextValidators","validator","when","apply","output","results","isArray","concat","header","ERROR_OCCURED","ERRORS_OCCURED","parent","prop","html","amsFormData","name","val","TARGET_INIT_TEMPLATE_STRING","TARGET_INIT_TEMPLATE","markup","render","parents","url","formHandler","startsWith","location","protocol","getAddr","base","type","cache","dataType","beforeSerialize","tinyMCE","triggerSave","beforeSubmit","uploadProgress","position","total","completed","css","complete","xhr","success","request","closeForm","modal","close","error","iframe","fieldname","generateUUID","interval","endCallback","_getProgressState","post","PROGRESS","current","_clearProgressState","clearTimeout","response","getResponse","contentType","handleJSON","opacity","delay","animate","initContent","scrollTo","offset","getResponseHeader","removeData","hide","dom","root","iframeTarget","keepModal","stop","bundle","modules","console","debug"],"mappings":"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","sourcesContent":["/* global MyAMS, tinyMCE */\n/**\n * MyAMS forms support\n */\n\nconst $ = MyAMS.$;\n\nif (!$.templates) {\n\tconst jsrender = require('jsrender');\n\t$.templates = jsrender.templates;\n}\n\n\nlet _initialized = false;\n\n\n/**\n * MyAMS \"form\" module\n */\nexport const form = {\n\n\tinit: () => {\n\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\n\t\t// Add click listener on submit buttons\n\t\t$(document).on('click', '[type=\"submit\"], .submit', (evt) => {\n\t\t\tconst button = $(evt.currentTarget);\n\t\t\tif (button.exists()) {\n\t\t\t\t$(button).closest('form').data('ams-submit-button', button);\n\t\t\t}\n\t\t});\n\n\t\t// Cancel clicks on readonly checkbox\n\t\t$(document).on('click', 'input[type=\"checkbox\"][readonly]', () => {\n\t\t\treturn false;\n\t\t});\n\n\t\t// Initialize generic and custom reset handlers\n\t\t$(document).on('reset', MyAMS.form.resetHandler);\n\t\t$(document).on('reset', '[data-ams-reset-handler]', MyAMS.form.customResetHandler);\n\n\t\t// Submit form when CTRL+Enter key is pressed in textarea\n\t\t$(document).on('keydown', 'textarea', (evt) => {\n\t\t\tif ((evt.keyCode === 10 || evt.keyCode === 13) && (evt.ctrlKey || evt.metaKey)) {\n\t\t\t\tconst form = $(evt.currentTarget).closest('form');\n\t\t\t\t$('button[type=\"submit\"]', form).first().click();\n\t\t\t}\n\t\t});\n\n\t\t// Always blur readonly inputs\n\t\t$(document).on('focus', 'input[readonly]', (evt) => {\n\t\t\t$(evt.currentTarget).blur();\n\t\t});\n\n\t\t// Prevent bootstrap dialog from blocking TinyMCE focus\n\t\t$(document).on('focusin', (evt) => {\n\t\t\tif ($(evt.target).closest('.mce-window').length >= 0) {\n\t\t\t\tevt.stopImmediatePropagation();\n\t\t\t}\n\t\t});\n\n\t\t// Add unload event listener to check for modified forms\n\t\t$(window).on('beforeunload', MyAMS.form.checkBeforeUnload);\n\t},\n\n\tinitElement: (element) => {\n\n\t\tif (typeof element === 'string') {\n\t\t\telement = $(element);\n\t\t}\n\n\t\tlet forms;\n\t\tif (MyAMS.config.warnOnFormChange) {\n\t\t\tforms = $('form[data-ams-warn-on-change!=\"false\"]', element);\n\t\t} else {\n\t\t\tforms = $('form[data-ams-warn-on-change=\"true\"]', element);\n\t\t}\n\t\tforms.each((idx, elt) => {\n\t\t\tconst\n\t\t\t\tform = $(elt),\n\t\t\t\tformData = form.data(),\n\t\t\t\tcallback = formData.amsChangedCallback || MyAMS.config.formChangeCallback;\n\t\t\t$('input, select, textarea, [data-ams-changed-event]', form).each((idx, elt) => {\n\t\t\t\tconst\n\t\t\t\t\tinput = $(elt),\n\t\t\t\t\tinputData = input.data();\n\t\t\t\tif (inputData.amsIgnoreChange !== true) {\n\t\t\t\t\tconst event = inputData.amsChangedEvent || 'change';\n\t\t\t\t\tinput.on(event, () => {\n\t\t\t\t\t\tMyAMS.form.setChanged(form);\n\t\t\t\t\t\tMyAMS.core.executeFunctionByName(inputData.amsChangedCallback ||\n\t\t\t\t\t\t\tcallback, document, form, input);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tMyAMS.form.setFocus(element);\n\t},\n\n\tsetFocus: (element) => {\n\t\tlet focused = $('[data-ams-focus-target]', element).first();\n\t\tif (!focused.exists()) {\n\t\t\tfocused = $('input, select, textarea', element).first();\n\t\t}\n\t\tif (focused.exists()) {\n\t\t\tfocused.focus();\n\t\t}\n\t},\n\n\tcheckBeforeUnload: () => {\n\t\tif (MyAMS.i18n) {\n\t\t\tconst forms = $('form[data-ams-form-changed=\"true\"]');\n\t\t\tif (forms.exists()) {\n\t\t\t\treturn MyAMS.i18n.FORM_CHANGED_WARNING;\n\t\t\t}\n\t\t}\n\t},\n\n\tconfirmChangedForm: (element) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst forms = $('form[data-ams-form-changed=\"true\"]', element);\n\t\t\tif (forms.exists()) {\n\t\t\t\tMyAMS.require('alert').then(() => {\n\t\t\t\t\tMyAMS.alert.bigBox({\n\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\ttitle: MyAMS.i18n.WARNING,\n\t\t\t\t\t\ticon: 'text-danger fa-bell',\n\t\t\t\t\t\tmessage: MyAMS.i18n.FORM_CHANGED_WARNING\n\t\t\t\t\t}).then((button) => {\n\t\t\t\t\t\tif (button === 'success') {\n\t\t\t\t\t\t\tMyAMS.form.resetChanged(forms);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(button);\n\t\t\t\t\t});\n\t\t\t\t}, () => {\n\t\t\t\t\treject(\"Missing 'alert' module!\");\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tform.resetChanged(forms);\n\t\t\t\tresolve('success');\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Update form \"chenged\" status flag\n\t */\n\tsetChanged: (form) => {\n\t\tform.attr('data-ams-form-changed', true);\n\t},\n\n\t/**\n\t * Default form reset handler\n\t *\n\t * @param event: the original reset event\n\t */\n\tresetHandler: (event) => {\n\t\tconst form = $(event.target);\n\t\tMyAMS.form.clearAlerts(form);\n\t\tMyAMS.form.handleDefaultReset(form);\n\t},\n\n\t/**\n\t * Clear remaining form alerts before submitting form\n\t */\n\tclearAlerts: (form) => {\n\t\t$('.alert-danger, SPAN.state-error', form).not('.persistent').remove();\n\t\t$('.state-error', form).removeClassPrefix('state-');\n\t\t$('.invalid-feedback', form).remove();\n\t\t$('.is-invalid', form).removeClass('is-invalid');\n\t},\n\n\t/**\n\t * Call reset callbacks defined on a form\n\t */\n\thandleDefaultReset: (form) => {\n\t\tsetTimeout(() => {\n\t\t\tform.find('.select2').trigger('change');\n\t\t\t$('[data-ams-reset-callback]', form).each((idx, elt) => {\n\t\t\t\tconst\n\t\t\t\t\telement = $(elt),\n\t\t\t\t\tdata = element.data(),\n\t\t\t\t\tcallback = MyAMS.core.getFunctionByName(data.amsResetCallback);\n\t\t\t\tif (callback !== undefined) {\n\t\t\t\t\tcallback.call(document, form, element, data.amsResetCallbackOptions);\n\t\t\t\t}\n\t\t\t});\n\t\t\tMyAMS.form.resetChanged(form);\n\t\t}, 10);\n\t},\n\n\t/**\n\t * Reset form changed flag\n\t */\n\tresetChanged: (form) => {\n\t\tif (form !== undefined) {\n\t\t\t$(form).removeAttr('data-ams-form-changed');\n\t\t}\n\t},\n\n\t/**\n\t * Custom reset handler\n\t */\n\tcustomResetHandler: (event) => {\n\t\tconst\n\t\t\tform = $(event.target),\n\t\t\tdata = form.data();\n\t\tif (data.amsResetHandler) {\n\t\t\tif ((data.amsKeepDefault !== true) && (data.amsResetKeepDefault !== true)) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\tconst callback = MyAMS.core.getFunctionByName(data.amsResetHandler);\n\t\t\tif (callback !== undefined) {\n\t\t\t\tcallback.call(document, event, form, data.amsResetHandlerOptions);\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Set widget's invalid status\n\t *\n\t * @param form: parent form\n\t * @param input: input name\n\t * @param message: associated message\n\t */\n\tsetInvalid: (form, input, message) => {\n\t\tif (typeof input === 'string') {\n\t\t\tinput = $(`[name=\"${input}\"]`, form);\n\t\t}\n\t\tif (input.exists()) {\n\t\t\tconst widget = input.closest('.form-widget');\n\t\t\t$('.invalid-feedback', widget).remove();\n\t\t\t$('<span>')\n\t\t\t\t.text(message)\n\t\t\t\t.addClass('is-invalid invalid-feedback')\n\t\t\t\t.appendTo(widget);\n\t\t\tinput.removeClass('valid')\n\t\t\t\t.addClass('is-invalid');\n\t\t}\n\t},\n\n\t/**\n\t * Get all settings for given form\n\t *\n\t * @param form: submitted form\n\t * @param formData: form data\n\t * @param button: submit button\n\t * @param buttonData: submit button data\n\t * @param options: submit options\n\t */\n\tgetSettings: (form, formData, button, buttonData, options) => {\n\t\tconst\n\t\t\tdefaults = {\n\t\t\t\tsubmitWarning: showFormSubmitWarning,\n\t\t\t\tgetValidators: getFormValidators,\n\t\t\t\tcheckValidators: checkFormValidators,\n\t\t\t\tclearAlerts: MyAMS.form.clearAlerts,\n\t\t\t\tinitSubmitButton: initFormSubmitButton,\n\t\t\t\tresetSubmitButton: resetFormSubmitButton,\n\t\t\t\tgetData: getFormData,\n\t\t\t\tinitData: initFormData,\n\t\t\t\tinitDataCallback: null,\n\t\t\t\tgetTarget: getFormTarget,\n\t\t\t\tinitTarget: initFormTarget,\n\t\t\t\tgetAction: getFormAction,\n\t\t\t\tgetAjaxSettings: getFormAjaxSettings,\n\t\t\t\tgetProgressSettings: getFormProgressSettings,\n\t\t\t\tgetProgressState: getFormProgressState,\n\t\t\t\tsubmit: submitForm,\n\t\t\t\tdatatype: null,\n\t\t\t\tsubmitOptions: null,\n\t\t\t\tsubmitHandler: (form.attr('action') || '').replace(/#/, ''),\n\t\t\t\tsubmitTarget: form.attr('target') || null,\n\t\t\t\tsubmitMessage: null,\n\t\t\t\tsubmitCallback: formSubmitCallback,\n\t\t\t\tprogressHandler: null,\n\t\t\t\tprogressFieldName: 'progressId',\n\t\t\t\tprogressInterval: 1000,\n\t\t\t\tprogressTarget: null,\n\t\t\t\tprogressCallback: null,\n\t\t\t\tprogressEndCallback: null,\n\t\t\t\tresetBeforeSubmit: false,\n\t\t\t\tkeepModalOpen: false,\n\t\t\t\tresetAfterSubmit: resetFormAfterSubmit,\n\t\t\t\tresetTimeout: 1000,\n\t\t\t\tresetAfterError: resetFormAfterError,\n\t\t\t\tdownloadTarget: null,\n\t\t\t\tgetDownloadTarget: getFormDownloadTarget,\n\t\t\t\tinitDownloadTarget: initFormDownloadTarget,\n\t\t\t\tresetDownloadTarget: resetFormDownloadTarget\n\t\t\t},\n\t\t\tsettings = $.extend({}, defaults);\n\n\t\t// extend default values with form, button and options properties\n\t\t$.extendPrefix(settings, 'amsForm', (value) => {\n\t\t\treturn MyAMS.core.getFunctionByName(value) || value;\n\t\t}, formData, buttonData);\n\t\t$.extendOnly(settings, (value) => {\n\t\t\treturn MyAMS.core.getFunctionByName(value) || value;\n\t\t}, options);\n\n\t\treturn settings;\n\t},\n\n\t/**\n\t * Submit given form\n\t *\n\t * @param form: input form\n\t * @param handler: AJAX submit target\n\t * @param options: submit options\n\t */\n\tsubmit: (form, handler, options={}) => {\n\n\t\t// check arguments\n\t\tform = $(form);\n\t\tif (!form.exists()) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof handler === 'object') {\n\t\t\toptions = handler;\n\t\t\thandler = undefined;\n\t\t}\n\n\t\t// initialize default settings\n\t\tconst\n\t\t\tformData = form.data(),\n\t\t\tbutton = $(formData.amsSubmitButton),\n\t\t\tbuttonData = button.data() || {},\n\t\t\tsettings = MyAMS.form.getSettings(form, formData, button, buttonData, options);\n\n\t\t// prevent multiple submits\n\t\tif (formData.submitted) {\n\t\t\tsettings.submitWarning(form, settings);\n\t\t\treturn false;\n\t\t}\n\n\t\t// check custom submit validators\n\t\tsettings.checkValidators(form, settings).then((status) => {\n\n\t\t\t// check validation status\n\t\t\tif (status !== 'success') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// submit form\n\t\t\tMyAMS.require('ajax', 'i18n').then(() => {\n\t\t\t\tMyAMS.ajax.check($.fn.ajaxSubmit,\n\t\t\t\t\t`${MyAMS.env.baseURL}../ext/jquery-form${MyAMS.env.extext}.js`).then(() => {\n\n\t\t\t\t\t// clear alerts and initialize submit button\n\t\t\t\t\tsettings.clearAlerts(form, settings);\n\t\t\t\t\tsettings.initSubmitButton(form, settings, button);\n\n\t\t\t\t\t// extract and initialize custom submit data\n\t\t\t\t\tconst\n\t\t\t\t\t\tpostData = settings.getData(form, settings, formData, button, buttonData, options),\n\t\t\t\t\t\tveto = { veto: false };\n\t\t\t\t\tsettings.initData(form, settings, button, postData, options, veto);\n\t\t\t\t\tif (veto.veto) {\n\t\t\t\t\t\tsettings.resetSubmitButton(form, settings, button);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// get and initialize post target\n\t\t\t\t\tconst target = settings.getTarget(form, settings, formData, buttonData);\n\t\t\t\t\tif (target && target.exists()) {\n\t\t\t\t\t\tsettings.initTarget(form, settings, target);\n\t\t\t\t\t}\n\n\t\t\t\t\t// get form action and POST settings\n\t\t\t\t\tconst\n\t\t\t\t\t\taction = settings.getAction(form, settings, handler),\n\t\t\t\t\t\tajaxSettings = settings.getAjaxSettings(form, settings,\n\t\t\t\t\t\t\tbutton, postData, action, target);\n\n\t\t\t\t\t// get and initialize download target\n\t\t\t\t\tconst downloadTarget = settings.getDownloadTarget(form, settings);\n\t\t\t\t\tif (downloadTarget) {\n\t\t\t\t\t\tsettings.initDownloadTarget(form, settings, downloadTarget, ajaxSettings);\n\t\t\t\t\t}\n\n\t\t\t\t\t// get progress settings\n\t\t\t\t\tajaxSettings.progress = settings.getProgressSettings(form, settings,\n\t\t\t\t\t\tbutton, postData);\n\n\t\t\t\t\t// YESSSS!!!!\n\t\t\t\t\t// submit form!!\n\t\t\t\t\tsettings.submit(form, settings, button, postData, ajaxSettings, target);\n\t\t\t\t\tif (downloadTarget) {\n\t\t\t\t\t\tsettings.resetDownloadTarget(form, settings, button, downloadTarget, ajaxSettings);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t// disable standard submit\n\t\treturn false;\n\t}\n};\n\n\n/**\n * Show warning message if form was already submitted\n *\n * @param form: submitted form\n * @param settings: computed form settings\n */\nexport function showFormSubmitWarning(form /*, settings */) {\n\treturn new Promise((resolve, reject) => {\n\t\tif (!form.data('ams-form-hide-submitted')) {\n\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\tstatus: 'warning',\n\t\t\t\t\ttitle: MyAMS.i18n.WAIT,\n\t\t\t\t\tmessage: MyAMS.i18n.FORM_SUBMITTED,\n\t\t\t\t\ticon: 'fa-save',\n\t\t\t\t\ttimeout: form.data('ams-form-alert-timeout') || 5000\n\t\t\t\t});\n\t\t\t}).then(resolve, reject);\n\t\t} else {\n\t\t\tresolve();\n\t\t}\n\t});\n}\n\n\n/**\n * Extract custom validators from given form\n *\n * @param form: checked form\n * @param settings: computed form settings\n * @returns {Map<any, any>}\n */\nexport function getFormValidators(form /*, settings */) {\n\tconst\n\t\tresult = new Map(),\n\t\tformValidators = (form.data('ams-form-validator') || '').trim().split(/[\\s,;]+/);\n\tlet validators = [];\n\t$(formValidators).each((idx, elt) => {\n\t\tif (!elt) {\n\t\t\treturn;\n\t\t}\n\t\tvalidators.push(elt);\n\t});\n\tif (validators.length > 0) {\n\t\tresult.set(form, validators);\n\t}\n\t$('[data-ams-form-validator]', form).each((idx, elt) => {\n\t\tconst\n\t\t\telement = $(elt),\n\t\t\telementValidators = (element.data('ams-form-validator') || '').trim().split(/[\\s,;]+/);\n\t\tvalidators = [];\n\t\t$(elementValidators).each((innerIdx, innerElt) => {\n\t\t\tif (!innerElt) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvalidators.push(innerElt);\n\t\t})\n\t\tif (validators.length > 0) {\n\t\t\tresult.set(element, validators);\n\t\t}\n\t});\n\treturn result;\n}\n\n\n/**\n * Check custom form validators.\n * A form can handle several form validators which will be called before the form is submitted.\n *\n *\n * @param form: checked form\n * @param settings: computed form settings\n */\nexport function checkFormValidators(form, settings) {\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst validators = settings.getValidators(form, settings);\n\t\tif (!validators.size) {\n\t\t\tresolve('success');\n\t\t\treturn;\n\t\t}\n\t\tconst checks = [];\n\t\tfor (const [context, contextValidators] of validators.entries()) {\n\t\t\tfor (const validator of contextValidators) {\n\t\t\t\tchecks.push(MyAMS.core.executeFunctionByName(validator, document, form, context));\n\t\t\t}\n\t\t}\n\t\t$.when.apply($, checks).then((...results) => {\n\t\t\tlet status = 'success',\n\t\t\t\toutput = [];\n\t\t\tfor (const result of results) {\n\t\t\t\tif (result !== true) {\n\t\t\t\t\tstatus = 'error';\n\t\t\t\t\tif (typeof result === 'string') {\n\t\t\t\t\t\toutput.push(result);\n\t\t\t\t\t} else if ($.isArray(result) && (result.length > 0)) {\n\t\t\t\t\t\toutput = output.concat(result);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (output.length > 0) {\n\t\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\t\tconst header = output.length === 1 ? MyAMS.i18n.ERROR_OCCURED :\n\t\t\t\t\t\tMyAMS.i18n.ERRORS_OCCURED;\n\t\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\t\tparent: form,\n\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\theader: header,\n\t\t\t\t\t\tmessage: output\n\t\t\t\t\t});\n\t\t\t\t\tresolve(status);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tresolve(status);\n\t\t\t}\n\t\t}, () => {\n\t\t\treject('error');\n\t\t});\n\t});\n}\n\n\n/**\n * Initialize form submit button\n * Button is disabled and text is updated\n */\nexport function initFormSubmitButton(form, settings, button) {\n\tconst text = button.data('ams-loading-text') || button.text().trim();\n\tif (text) {\n\t\tbutton.data('original-text', button.text())\n\t\t\t.prop('disabled', true)\n\t\t\t.text(`${text}...`);\n\t\t$('<div>').addClass('progress')\n\t\t\t.appendTo(button);\n\t} else {  // button without text\n\t\tbutton.data('original-html', button.html())\n\t\t\t.prop('disabled', true)\n\t\t\t.html('<i class=\"fa fa-cog fa-spin\"></i>');\n\t}\n}\n\n\n// reset form submit button\nexport function resetFormSubmitButton(form, settings, button) {\n\t$('.progress', button).remove();\n\tconst text = button.data('original-text');\n\tif (text) {\n\t\tbutton.text(text);\n\t} else {\n\t\tconst html = button.data('original-html');\n\t\tif (html) {\n\t\t\tbutton.html(html);\n\t\t}\n\t}\n\tbutton.prop('disabled', false);\n}\n\n\n// get form data\nexport function getFormData(form, settings, formData, button, buttonData, options) {\n\tconst\n\t\tdata = $.extend({}, formData.amsFormData, buttonData.amsFormData, options.data),\n\t\tname = button.attr('name');\n\tif (name) {\n\t\tdata[name] = button.val();\n\t}\n\treturn data;\n}\n\n\n// initialize form data\nexport function initFormData(form, settings, button, postData, options, veto) {\n\tconst callback = settings.initDataCallback;\n\tif (callback) {\n\t\t$.extend(postData, callback(form, settings, button, postData, options, veto));\n\t}\n\tform.trigger('init-data.ams.form', [postData, veto]);\n}\n\n\n// get form target\nexport function getFormTarget(form, settings /*, formData, buttonData */) {\n\treturn $(settings.submitTarget);\n}\n\n\n// initialize form target\nconst TARGET_INIT_TEMPLATE_STRING = `\n\t<div class=\"row m-3\">\n\t\t<div class=\"text-center w-100\">\n\t\t\t<i class=\"fa fa-3x fa-cog fa-spin\"></i>\n\t\t\t{{if message}}\n\t\t\t<strong>{{:message}}</strong>\n\t\t\t{{/if}}\n\t\t</div>\n\t</div>`;\n\nconst TARGET_INIT_TEMPLATE = $.templates({\n\tmarkup: TARGET_INIT_TEMPLATE_STRING\n});\n\nexport function initFormTarget(form, settings, target) {\n\ttarget.html(TARGET_INIT_TEMPLATE.render({ message: settings.submitMessage }));\n\ttarget.parents('.hidden').removeClass('hidden');\n}\n\n\n// get form action\nexport function getFormAction(form, settings, handler) {\n\tlet url;\n\tconst formHandler = handler || settings.submitHandler;\n\tif (formHandler.startsWith(window.location.protocol)) {\n\t\turl = formHandler;\n\t} else {\n\t\turl = MyAMS.ajax.getAddr() + formHandler;\n\t}\n\treturn url;\n}\n\n\n// get AJAX POST submit settings\nexport function getFormAjaxSettings(form, settings, button, postData, action, target) {\n\tconst base = {\n\t\turl: action,\n\t\ttype: 'post',\n\t\tcache: false,\n\t\tdata: postData,\n\t\tdataType: settings.datatype,\n\t\tbeforeSerialize: (form /*, options */) => {\n\t\t\tconst veto = { veto: false };\n\t\t\tform.trigger('before-serialize.ams.form', [veto]);\n\t\t\tif (veto.veto) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (typeof window.tinyMCE !== 'undefined') {\n\t\t\t\ttinyMCE.triggerSave();\n\t\t\t}\n\t\t},\n\t\tbeforeSubmit: (data, form /*, options */) => {\n\t\t\tconst veto = { veto: false };\n\t\t\tform.trigger('before-submit.ams.form', [data, veto]);\n\t\t\tif (veto.veto) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tform.data('submitted', true);\n\t\t\tif (settings.resetBeforeSubmit) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tsettings.resetSubmitButton(form, settings, button);\n\t\t\t\t}, 250);\n\t\t\t}\n\t\t},\n\t\tuploadProgress: (evt, position, total, completed) => {\n\t\t\t$('.progress', button).css('background-image',\n\t\t\t\t`linear-gradient(to right, white -45%, green ${completed}%, red ${completed}%, red)`);\n\t\t},\n\t\tcomplete: (xhr) => {\n\t\t\tform.trigger('complete.ams.form', [xhr]);\n\t\t},\n\t\tsuccess: (result, status, request, form) => {\n\t\t\tconst veto = { veto: false };\n\t\t\tform.trigger('submit-success.ams.form', [result, status, request, veto]);\n\t\t\tif (veto.veto) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (result && result.status !== 'error' && result.closeForm !== false) {\n\t\t\t\tconst modal = form.closest('.modal-dialog');\n\t\t\t\tif (modal.exists() && !settings.keepModalOpen) {\n\t\t\t\t\tMyAMS.modal && MyAMS.modal.close(modal);\n\t\t\t\t}\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tsettings.submitCallback(form, settings, target, result, status, request);\n\t\t\t} finally {\n\t\t\t\tsettings.resetAfterSubmit(form, settings, button);\n\t\t\t\tMyAMS.form.resetChanged(form);\n\t\t\t}\n\t\t},\n\t\terror: (request, status, error, form) => {\n\t\t\tform.trigger('submit-error.ams.form', [request, status, error, target]);\n\t\t\tif (target) {\n\t\t\t\tsettings.resetAfterError(form, settings, button, target);\n\t\t\t}\n\t\t\tsettings.resetAfterSubmit(form, settings, button);\n\t\t},\n\t\tiframe: false\n\t}\n\treturn $.extend({}, base, settings.submitOptions);\n}\n\n\n// get form submit processing progress settings\nexport function getFormProgressSettings(form, settings, button, postData) {\n\tconst handler = settings.progressHandler;\n\tif (handler) {\n\t\t// check fieldname\n\t\tconst fieldname = settings.progressFieldName;\n\t\tpostData[fieldname] = MyAMS.core.generateUUID();\n\t\t// check progress target\n\t\tlet progressTarget = button;\n\t\tif (settings.progressTarget) {\n\t\t\tprogressTarget = $(settings.progressTarget);\n\t\t}\n\t\treturn {\n\t\t\thandler: handler,\n\t\t\tinterval: settings.progressInterval,\n\t\t\tfieldname: fieldname,\n\t\t\ttarget: progressTarget,\n\t\t\tcallback: settings.progressCallback,\n\t\t\tendCallback: settings.progressEndCallback\n\t\t}\n\t}\n}\n\n\n// get form submit progress state\nexport function getFormProgressState(form, settings, postData, progress, target) {\n\n\tlet timeout = setTimeout(_getProgressState, progress.interval);\n\n\tfunction _getProgressState() {\n\t\tconst data = {};\n\t\tdata[progress.fieldname] = postData[progress.fieldname];\n\t\tMyAMS.ajax.post(progress.handler, data)\n\t\t\t.then(MyAMS.core.getFunctionByName(progress.callback || function(result, status) {\n\t\t\t\tif ($.isArray(result)) {\n\t\t\t\t\tstatus = result[1];\n\t\t\t\t\tresult = result[0];\n\t\t\t\t}\n\t\t\t\tif (status === 'success') {\n\t\t\t\t\tif (result.status === 'running') {\n\t\t\t\t\t\tif (result.message) {\n\t\t\t\t\t\t\ttarget.text(result.message);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet text = result.progress || target.data('ams-progress-text') || MyAMS.i18n.PROGRESS;\n\t\t\t\t\t\t\tif (result.current) {\n\t\t\t\t\t\t\t\ttext += `: ${result.current} / ${result.length || 100}`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttext += '...';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttarget.text(text);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttimeout = setTimeout(_getProgressState, progress.interval);\n\t\t\t\t\t} else if (result.status === 'finished') {\n\t\t\t\t\t\t_clearProgressState();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t_clearProgressState();\n\t\t\t\t}\n\t\t\t}), _clearProgressState);\n\t}\n\n\tfunction _clearProgressState() {\n\t\tclearTimeout(timeout);\n\t\tsettings.resetSubmitButton(form, settings, target);\n\t\tMyAMS.core.executeFunctionByName(progress.endCallback, document, form, settings, target);\n\t\tMyAMS.form.resetChanged(form);\n\t}\n}\n\n\n// submit form\nexport function submitForm(form, settings, button, postData, ajaxSettings, target) {\n\tif (ajaxSettings.progress) {\n\t\tsettings.getProgressState(form, settings, postData, ajaxSettings.progress, target);\n\t}\n\tform.ajaxSubmit(ajaxSettings);\n}\n\n\n/**\n * Default form submit callback\n * \n * @param form\n * @param settings: computed form settings\n * @param target\n * @param result\n * @param status\n * @param request\n */\nexport function formSubmitCallback(form, settings, target, result, status, request) {\n\tlet dataType = settings.datatype;\n\tif (!dataType) {\n\t\tconst response = MyAMS.ajax.getResponse(request);\n\t\tif (response) {\n\t\t\tdataType = response.contentType;\n\t\t\tresult = response.data;\n\t\t}\n\t}\n\n\tswitch (dataType) {\n\t\tcase 'binary':\n\t\tcase 'script':\n\t\tcase 'xml':\n\t\t\tbreak;\n\t\tcase 'json':\n\t\t\tMyAMS.ajax.handleJSON(result, form, target);\n\t\t\tbreak;\n\t\tdefault:  // text or html\n\t\t\tMyAMS.form.resetChanged(form);\n\t\t\ttarget.css({ opacity: '0.0' });\n\t\t\ttarget.removeClass('hidden')\n\t\t\t\t.parents('.hidden')\n\t\t\t\t.removeClass('.hidden');\n\t\t\ttarget.html(result)\n\t\t\t\t.delay(50)\n\t\t\t\t.animate({ opacity: '1.0' }, 250);\n\t\t\tMyAMS.core.executeFunctionByName(MyAMS.config.initContent, document, target).then(() => {\n\t\t\t\tMyAMS.require('ajax').then(() => {\n\t\t\t\t\tMyAMS.ajax.check($.fn.scrollTo,\n\t\t\t\t\t\t`${MyAMS.env.baseURL}../ext/jquery-scrollto${MyAMS.env.extext}.js`).then(() => {\n\t\t\t\t\t\t$('#main').scrollTo(target, { offset: -15 });\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tconst callback = request.getResponseHeader('X-AMS-Callback');\n\tif (callback) {\n\t\tconst options = request.getResponseHeader('X-AMS-Callback-Options') || \"{}\";\n\t\tMyAMS.core.executeFunctionByName(callback, document, form, settings, options,\n\t\t\tresult, status, request);\n\t}\n\tform.trigger('after-submit.ams.form', [result]);\n}\n\n\n/**\n * Reset AJAX form after submit\n * \n * @param form: current form\n * @param settings: computed form settings\n * @param button: button used to submit the form, if any\n */\nexport function resetFormAfterSubmit(form, settings, button) {\n\tif (form.data('submitted')) {\n\t\tsettings.resetSubmitButton(form, settings, button);\n\t\tform.data('submitted', false);\n\t\tform.removeData('ams-submit-button');\n\t\tform.trigger('after-reset.ams.form');\n\t}\n}\n\n\n/**\n * Reset form after submit error\n *\n * @param form: current form\n * @param settings: computed form settings\n * @param target: previous form target\n */\nexport function resetFormAfterError(form, settings, target) {\n\t$('i', target)\n\t\t.removeClass('fa-spin')\n\t\t.removeClass('fa-cog')\n\t\t.addClass('fa-ambulance');\n}\n\n\n// get form download target\nexport function getFormDownloadTarget(form, settings) {\n\treturn settings.downloadTarget;\n}\n\n\n// initialize download target\nexport function initFormDownloadTarget(form, settings, target, ajaxSettings) {\n\tlet iframe = $(`iframe[name=\"${target}\"]`);\n\tif (!iframe.exists()) {\n\t\tiframe = $('<iframe>').attr('name', target)\n\t\t\t.hide()\n\t\t\t.appendTo(MyAMS.dom.root);\n\t}\n\t$.extend(ajaxSettings, {\n\t\tiframe: true,\n\t\tiframeTarget: iframe\n\t});\n}\n\n\n// reset if download target\nexport function resetFormDownloadTarget(form, settings, button, target, ajaxSettings) {\n\tconst\n\t\tmodal = form.closest('.modal-dialog'),\n\t\tkeepModal = settings.keepModalOpen;\n\tif (modal.exists() && (keepModal !== true)) {\n\t\tMyAMS.require('modal').then(() => {\n\t\t\tMyAMS.modal.close(modal);\n\t\t});\n\t}\n\tif (!ajaxSettings.progress) {\n\t\tsetTimeout(() => {\n\t\t\tsettings.resetAfterSubmit(form, settings, button);\n\t\t\tMyAMS.ajax && MyAMS.ajax.stop();\n\t\t\tMyAMS.form.resetChanged(form);\n\t\t}, settings.resetTimeout);\n\t}\n}\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('form');\n\t} else {\n\t\tMyAMS.form = form;\n\t\tconsole.debug(\"MyAMS: form module loaded...\");\n\t}\n}\n"],"file":"mod-form-dev.js"}
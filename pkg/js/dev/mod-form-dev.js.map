{"version":3,"file":"mod-form-dev.js","names":["$","MyAMS","templates","jsrender","require","_initialized","form","init","document","on","evt","button","currentTarget","exists","closest","data","resetHandler","customResetHandler","keyCode","ctrlKey","metaKey","first","click","blur","target","length","stopImmediatePropagation","window","checkBeforeUnload","initElement","element","forms","config","warnOnFormChange","each","idx","elt","formData","callback","amsChangedCallback","formChangeCallback","input","inputData","amsIgnoreChange","event","amsChangedEvent","setChanged","core","executeFunctionByName","setFocus","Promise","resolve","reject","setTimeout","focused","process","env","NODE_ENV","get","focus","i18n","FORM_CHANGED_WARNING","confirmChangedForm","then","alert","bigBox","status","title","WARNING","icon","message","resetChanged","attr","clearAlerts","handleDefaultReset","not","remove","removeClassPrefix","removeClass","find","trigger","getFunctionByName","amsResetCallback","undefined","call","amsResetCallbackOptions","removeAttr","amsResetHandler","amsKeepDefault","amsResetKeepDefault","preventDefault","amsResetHandlerOptions","setInvalid","widget","text","addClass","appendTo","getSettings","buttonData","options","defaults","submitWarning","showFormSubmitWarning","getValidators","getFormValidators","checkValidators","checkFormValidators","initSubmitButton","initFormSubmitButton","resetSubmitButton","resetFormSubmitButton","getData","getFormData","initData","initFormData","initDataCallback","getTarget","getFormTarget","initTarget","initFormTarget","getAction","getFormAction","getAjaxSettings","getFormAjaxSettings","getProgressSettings","getFormProgressSettings","getProgressState","getFormProgressState","submit","submitForm","datatype","submitOptions","submitHandler","replace","submitTarget","submitMessage","submitCallback","formSubmitCallback","progressHandler","progressFieldName","progressInterval","progressTarget","progressCallback","progressEndCallback","resetBeforeSubmit","keepModalOpen","resetAfterSubmit","resetFormAfterSubmit","resetTimeout","resetAfterError","resetFormAfterError","downloadTarget","getDownloadTarget","getFormDownloadTarget","initDownloadTarget","initFormDownloadTarget","resetDownloadTarget","resetFormDownloadTarget","settings","extend","extendPrefix","value","extendOnly","handler","amsSubmitButton","submitted","ajax","check","fn","ajaxSubmit","baseURL","extext","postData","veto","action","ajaxSettings","progress","parents","messageBox","WAIT","FORM_SUBMITTED","timeout","result","Map","formValidators","trim","split","validators","push","set","elementValidators","innerIdx","innerElt","size","checks","context","contextValidators","entries","validator","when","apply","output","results","isArray","concat","header","ERROR_OCCURED","ERRORS_OCCURED","parent","prop","html","amsFormData","name","val","TARGET_INIT_TEMPLATE_STRING","TARGET_INIT_TEMPLATE","markup","render","url","formHandler","startsWith","location","protocol","getAddr","base","type","cache","dataType","beforeSerialize","tinyMCE","triggerSave","beforeSubmit","uploadProgress","position","total","completed","css","complete","xhr","success","request","closeForm","modal","close","error","iframe","fieldname","generateUUID","interval","endCallback","_getProgressState","post","PROGRESS","current","_clearProgressState","clearTimeout","response","getResponse","contentType","handleJSON","opacity","delay","animate","initContent","helpers","scrollTo","offset","getResponseHeader","removeData","reset","hide","dom","root","iframeTarget","keepModal","stop","bundle","modules","console","debug"],"sources":["mod-form.js"],"sourcesContent":["/* global MyAMS, tinyMCE */\n/**\n * MyAMS forms support\n */\n\nconst $ = MyAMS.$;\n\nif (!$.templates) {\n\tconst jsrender = require('jsrender');\n\t$.templates = jsrender.templates;\n}\n\n\nlet _initialized = false;\n\n\n/**\n * MyAMS \"form\" module\n */\nexport const form = {\n\n\tinit: () => {\n\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\n\t\t// Add click listener on submit buttons\n\t\t$(document).on('click', '[type=\"submit\"], .submit', (evt) => {\n\t\t\tconst button = $(evt.currentTarget);\n\t\t\tif (button.exists()) {\n\t\t\t\t$(button).closest('form').data('ams-submit-button', button);\n\t\t\t}\n\t\t});\n\n\t\t// Cancel clicks on readonly checkbox\n\t\t$(document).on('click', 'input[type=\"checkbox\"][readonly]', () => {\n\t\t\treturn false;\n\t\t});\n\n\t\t// Initialize generic and custom reset handlers\n\t\t$(document).on('reset', MyAMS.form.resetHandler);\n\t\t$(document).on('reset', '[data-ams-reset-handler]', MyAMS.form.customResetHandler);\n\n\t\t// Submit form when CTRL+Enter key is pressed in textarea\n\t\t$(document).on('keydown', 'textarea', (evt) => {\n\t\t\tif ((evt.keyCode === 10 || evt.keyCode === 13) && (evt.ctrlKey || evt.metaKey)) {\n\t\t\t\tconst form = $(evt.currentTarget).closest('form');\n\t\t\t\t$('button[type=\"submit\"]', form).first().click();\n\t\t\t}\n\t\t});\n\n\t\t// Always blur readonly inputs\n\t\t$(document).on('focus', 'input[readonly]', (evt) => {\n\t\t\t$(evt.currentTarget).blur();\n\t\t});\n\n\t\t// Prevent bootstrap dialog from blocking TinyMCE focus\n\t\t$(document).on('focusin', (evt) => {\n\t\t\tif ($(evt.target).closest('.mce-window').length >= 0) {\n\t\t\t\tevt.stopImmediatePropagation();\n\t\t\t}\n\t\t});\n\n\t\t// Add unload event listener to check for modified forms\n\t\t$(window).on('beforeunload', MyAMS.form.checkBeforeUnload);\n\t},\n\n\tinitElement: (element) => {\n\n\t\tif (typeof element === 'string') {\n\t\t\telement = $(element);\n\t\t}\n\n\t\tlet forms;\n\t\tif (MyAMS.config.warnOnFormChange) {\n\t\t\tforms = $('form[data-ams-warn-on-change!=\"false\"]', element);\n\t\t} else {\n\t\t\tforms = $('form[data-ams-warn-on-change=\"true\"]', element);\n\t\t}\n\t\tforms.each((idx, elt) => {\n\t\t\tconst\n\t\t\t\tform = $(elt),\n\t\t\t\tformData = form.data(),\n\t\t\t\tcallback = formData.amsChangedCallback || MyAMS.config.formChangeCallback;\n\t\t\t$('input, select, textarea, [data-ams-changed-event]', form).each((idx, elt) => {\n\t\t\t\tconst\n\t\t\t\t\tinput = $(elt),\n\t\t\t\t\tinputData = input.data();\n\t\t\t\tif (inputData.amsIgnoreChange !== true) {\n\t\t\t\t\tconst event = inputData.amsChangedEvent || 'change';\n\t\t\t\t\tinput.on(event, () => {\n\t\t\t\t\t\tMyAMS.form.setChanged(form);\n\t\t\t\t\t\tMyAMS.core.executeFunctionByName(inputData.amsChangedCallback ||\n\t\t\t\t\t\t\tcallback, document, form, input);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tMyAMS.form.setFocus(element);\n\t},\n\n\tsetFocus: (element) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tlet focused = $('[data-ams-focus-target]', element).first();\n\t\t\t\tif (!focused.exists()) {\n\t\t\t\t\tif (window?.process?.env?.NODE_ENV === 'test') {\n\t\t\t\t\t\tfocused = $('input, select, textarea', element).first();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfocused = $('input:enabled:visible, ' +\n\t\t\t\t\t\t\t'select:enabled:visible, ' +\n\t\t\t\t\t\t\t'textarea:enabled:visible', element).first();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (focused.exists()) {\n\t\t\t\t\tfocused.get(0).focus();\n\t\t\t\t}\n\t\t\t\tresolve(focused);\n\t\t\t}, 100);\n\t\t});\n\t},\n\n\tcheckBeforeUnload: () => {\n\t\tif (MyAMS.i18n) {\n\t\t\tconst forms = $('form[data-ams-form-changed=\"true\"]');\n\t\t\tif (forms.exists()) {\n\t\t\t\treturn MyAMS.i18n.FORM_CHANGED_WARNING;\n\t\t\t}\n\t\t}\n\t},\n\n\tconfirmChangedForm: (element) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst forms = $('form[data-ams-form-changed=\"true\"]', element);\n\t\t\tif (forms.exists()) {\n\t\t\t\tMyAMS.require('alert').then(() => {\n\t\t\t\t\tMyAMS.alert.bigBox({\n\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\ttitle: MyAMS.i18n.WARNING,\n\t\t\t\t\t\ticon: 'text-danger fa-bell',\n\t\t\t\t\t\tmessage: MyAMS.i18n.FORM_CHANGED_WARNING\n\t\t\t\t\t}).then((button) => {\n\t\t\t\t\t\tif (button === 'success') {\n\t\t\t\t\t\t\tMyAMS.form.resetChanged(forms);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(button);\n\t\t\t\t\t});\n\t\t\t\t}, () => {\n\t\t\t\t\treject(\"Missing 'alert' module!\");\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tform.resetChanged(forms);\n\t\t\t\tresolve('success');\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Update form \"chenged\" status flag\n\t */\n\tsetChanged: (form) => {\n\t\tform.attr('data-ams-form-changed', true);\n\t},\n\n\t/**\n\t * Default form reset handler\n\t *\n\t * @param event: the original reset event\n\t */\n\tresetHandler: (event) => {\n\t\tconst form = $(event.target);\n\t\tMyAMS.form.clearAlerts(form);\n\t\tMyAMS.form.handleDefaultReset(form);\n\t},\n\n\t/**\n\t * Clear remaining form alerts before submitting form\n\t */\n\tclearAlerts: (form) => {\n\t\t$('.alert-danger, SPAN.state-error', form).not('.persistent').remove();\n\t\t$('.state-error', form).removeClassPrefix('state-');\n\t\t$('.invalid-feedback', form).remove();\n\t\t$('.is-invalid', form).removeClass('is-invalid');\n\t},\n\n\t/**\n\t * Call reset callbacks defined on a form\n\t */\n\thandleDefaultReset: (form) => {\n\t\tsetTimeout(() => {\n\t\t\tform.find('.select2').trigger('change');\n\t\t\t$('[data-ams-reset-callback]', form).each((idx, elt) => {\n\t\t\t\tconst\n\t\t\t\t\telement = $(elt),\n\t\t\t\t\tdata = element.data(),\n\t\t\t\t\tcallback = MyAMS.core.getFunctionByName(data.amsResetCallback);\n\t\t\t\tif (callback !== undefined) {\n\t\t\t\t\tcallback.call(document, form, element, data.amsResetCallbackOptions);\n\t\t\t\t}\n\t\t\t});\n\t\t\tMyAMS.form.resetChanged(form);\n\t\t}, 10);\n\t},\n\n\t/**\n\t * Reset form changed flag\n\t */\n\tresetChanged: (form) => {\n\t\tif (form !== undefined) {\n\t\t\t$(form).removeAttr('data-ams-form-changed');\n\t\t}\n\t},\n\n\t/**\n\t * Custom reset handler\n\t */\n\tcustomResetHandler: (event) => {\n\t\tconst\n\t\t\tform = $(event.target),\n\t\t\tdata = form.data();\n\t\tif (data.amsResetHandler) {\n\t\t\tif ((data.amsKeepDefault !== true) && (data.amsResetKeepDefault !== true)) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\tconst callback = MyAMS.core.getFunctionByName(data.amsResetHandler);\n\t\t\tif (callback !== undefined) {\n\t\t\t\tcallback.call(document, event, form, data.amsResetHandlerOptions);\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Set widget's invalid status\n\t *\n\t * @param form: parent form\n\t * @param input: input name\n\t * @param message: associated message\n\t */\n\tsetInvalid: (form, input, message) => {\n\t\tif (typeof input === 'string') {\n\t\t\tinput = $(`[name=\"${input}\"]`, form);\n\t\t}\n\t\tif (input.exists()) {\n\t\t\tconst widget = input.closest('.form-widget');\n\t\t\t$('.invalid-feedback', widget).remove();\n\t\t\t$('<span>')\n\t\t\t\t.text(message)\n\t\t\t\t.addClass('is-invalid invalid-feedback')\n\t\t\t\t.appendTo(widget);\n\t\t\tinput.removeClass('valid')\n\t\t\t\t.addClass('is-invalid');\n\t\t}\n\t},\n\n\t/**\n\t * Get all settings for given form\n\t *\n\t * @param form: submitted form\n\t * @param formData: form data\n\t * @param button: submit button\n\t * @param buttonData: submit button data\n\t * @param options: submit options\n\t */\n\tgetSettings: (form, formData, button, buttonData, options) => {\n\t\tconst\n\t\t\tdefaults = {\n\t\t\t\tsubmitWarning: showFormSubmitWarning,\n\t\t\t\tgetValidators: getFormValidators,\n\t\t\t\tcheckValidators: checkFormValidators,\n\t\t\t\tclearAlerts: MyAMS.form.clearAlerts,\n\t\t\t\tinitSubmitButton: initFormSubmitButton,\n\t\t\t\tresetSubmitButton: resetFormSubmitButton,\n\t\t\t\tgetData: getFormData,\n\t\t\t\tinitData: initFormData,\n\t\t\t\tinitDataCallback: null,\n\t\t\t\tgetTarget: getFormTarget,\n\t\t\t\tinitTarget: initFormTarget,\n\t\t\t\tgetAction: getFormAction,\n\t\t\t\tgetAjaxSettings: getFormAjaxSettings,\n\t\t\t\tgetProgressSettings: getFormProgressSettings,\n\t\t\t\tgetProgressState: getFormProgressState,\n\t\t\t\tsubmit: submitForm,\n\t\t\t\tdatatype: null,\n\t\t\t\tsubmitOptions: null,\n\t\t\t\tsubmitHandler: (form.attr('action') || '').replace(/#/, ''),\n\t\t\t\tsubmitTarget: form.attr('target') || null,\n\t\t\t\tsubmitMessage: null,\n\t\t\t\tsubmitCallback: formSubmitCallback,\n\t\t\t\tprogressHandler: null,\n\t\t\t\tprogressFieldName: 'progressId',\n\t\t\t\tprogressInterval: 1000,\n\t\t\t\tprogressTarget: null,\n\t\t\t\tprogressCallback: null,\n\t\t\t\tprogressEndCallback: null,\n\t\t\t\tresetBeforeSubmit: false,\n\t\t\t\tkeepModalOpen: false,\n\t\t\t\tresetAfterSubmit: resetFormAfterSubmit,\n\t\t\t\tresetTimeout: 1000,\n\t\t\t\tresetAfterError: resetFormAfterError,\n\t\t\t\tdownloadTarget: null,\n\t\t\t\tgetDownloadTarget: getFormDownloadTarget,\n\t\t\t\tinitDownloadTarget: initFormDownloadTarget,\n\t\t\t\tresetDownloadTarget: resetFormDownloadTarget\n\t\t\t},\n\t\t\tsettings = $.extend({}, defaults);\n\n\t\t// extend default values with form, button and options properties\n\t\t$.extendPrefix(settings, 'amsForm', (value) => {\n\t\t\treturn MyAMS.core.getFunctionByName(value) || value;\n\t\t}, formData, buttonData);\n\t\t$.extendOnly(settings, (value) => {\n\t\t\treturn MyAMS.core.getFunctionByName(value) || value;\n\t\t}, options);\n\n\t\treturn settings;\n\t},\n\n\t/**\n\t * Submit given form\n\t *\n\t * @param form: input form\n\t * @param handler: AJAX submit target\n\t * @param options: submit options\n\t */\n\tsubmit: (form, handler, options={}) => {\n\n\t\t// check arguments\n\t\tform = $(form);\n\t\tif (!form.exists()) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof handler === 'object') {\n\t\t\toptions = handler;\n\t\t\thandler = undefined;\n\t\t}\n\n\t\t// initialize default settings\n\t\tconst\n\t\t\tformData = form.data(),\n\t\t\tbutton = $(formData.amsSubmitButton),\n\t\t\tbuttonData = button.data() || {},\n\t\t\tsettings = MyAMS.form.getSettings(form, formData, button, buttonData, options);\n\n\t\t// prevent multiple submits\n\t\tif (formData.submitted) {\n\t\t\tsettings.submitWarning(form, settings);\n\t\t\treturn false;\n\t\t}\n\n\t\t// check custom submit validators\n\t\tsettings.checkValidators(form, settings).then((status) => {\n\n\t\t\t// check validation status\n\t\t\tif (status !== 'success') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// submit form\n\t\t\tMyAMS.require('ajax', 'i18n').then(() => {\n\t\t\t\tMyAMS.ajax.check($.fn.ajaxSubmit,\n\t\t\t\t\t`${MyAMS.env.baseURL}../ext/jquery-form${MyAMS.env.extext}.js`).then(() => {\n\n\t\t\t\t\t// clear alerts and initialize submit button\n\t\t\t\t\tsettings.clearAlerts(form, settings);\n\t\t\t\t\tsettings.initSubmitButton(form, settings, button);\n\n\t\t\t\t\t// extract and initialize custom submit data\n\t\t\t\t\tconst\n\t\t\t\t\t\tpostData = settings.getData(form, settings, formData, button, buttonData, options),\n\t\t\t\t\t\tveto = { veto: false };\n\t\t\t\t\tsettings.initData(form, settings, button, postData, options, veto);\n\t\t\t\t\tif (veto.veto) {\n\t\t\t\t\t\tsettings.resetSubmitButton(form, settings, button);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// get and initialize post target\n\t\t\t\t\tconst target = settings.getTarget(form, settings, formData, buttonData);\n\t\t\t\t\tif (target && target.exists()) {\n\t\t\t\t\t\tsettings.initTarget(form, settings, target);\n\t\t\t\t\t}\n\n\t\t\t\t\t// get form action and POST settings\n\t\t\t\t\tconst\n\t\t\t\t\t\taction = settings.getAction(form, settings, handler),\n\t\t\t\t\t\tajaxSettings = settings.getAjaxSettings(form, settings,\n\t\t\t\t\t\t\tbutton, postData, action, target);\n\n\t\t\t\t\t// get and initialize download target\n\t\t\t\t\tconst downloadTarget = settings.getDownloadTarget(form, settings);\n\t\t\t\t\tif (downloadTarget) {\n\t\t\t\t\t\tsettings.initDownloadTarget(form, settings, downloadTarget, ajaxSettings);\n\t\t\t\t\t}\n\n\t\t\t\t\t// get progress settings\n\t\t\t\t\tajaxSettings.progress = settings.getProgressSettings(form, settings,\n\t\t\t\t\t\tbutton, postData);\n\n\t\t\t\t\t// YESSSS!!!!\n\t\t\t\t\t// submit form!!\n\t\t\t\t\tsettings.submit(form, settings, button, postData, ajaxSettings, target);\n\t\t\t\t\tif (downloadTarget) {\n\t\t\t\t\t\tsettings.resetDownloadTarget(form, settings, button, downloadTarget, ajaxSettings);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t// disable standard submit\n\t\treturn false;\n\t},\n\n\t/**\n\t * Submit a form from a button click handler\n\t */\n\tsubmitForm: (evt) => {\n\t\tconst\n\t\t\tbutton = $(evt.currentTarget),\n\t\t\tform = button.parents('form');\n\t\tform.data('ams-submit-button', button);\n\t\tform.submit();\n\t}\n};\n\n\n/**\n * Show warning message if form was already submitted\n *\n * @param form: submitted form\n * @param settings: computed form settings\n */\nexport function showFormSubmitWarning(form /*, settings */) {\n\treturn new Promise((resolve, reject) => {\n\t\tif (!form.data('ams-form-hide-submitted')) {\n\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\tstatus: 'warning',\n\t\t\t\t\ttitle: MyAMS.i18n.WAIT,\n\t\t\t\t\tmessage: MyAMS.i18n.FORM_SUBMITTED,\n\t\t\t\t\ticon: 'fa-save',\n\t\t\t\t\ttimeout: form.data('ams-form-alert-timeout') || 5000\n\t\t\t\t});\n\t\t\t}).then(resolve, reject);\n\t\t} else {\n\t\t\tresolve();\n\t\t}\n\t});\n}\n\n\n/**\n * Extract custom validators from given form\n *\n * @param form: checked form\n * @param settings: computed form settings\n * @returns {Map<any, any>}\n */\nexport function getFormValidators(form /*, settings */) {\n\tconst\n\t\tresult = new Map(),\n\t\tformValidators = (form.data('ams-form-validator') || '').trim().split(/[\\s,;]+/);\n\tlet validators = [];\n\t$(formValidators).each((idx, elt) => {\n\t\tif (!elt) {\n\t\t\treturn;\n\t\t}\n\t\tvalidators.push(elt);\n\t});\n\tif (validators.length > 0) {\n\t\tresult.set(form, validators);\n\t}\n\t$('[data-ams-form-validator]', form).each((idx, elt) => {\n\t\tconst\n\t\t\telement = $(elt),\n\t\t\telementValidators = (element.data('ams-form-validator') || '').trim().split(/[\\s,;]+/);\n\t\tvalidators = [];\n\t\t$(elementValidators).each((innerIdx, innerElt) => {\n\t\t\tif (!innerElt) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvalidators.push(innerElt);\n\t\t})\n\t\tif (validators.length > 0) {\n\t\t\tresult.set(element, validators);\n\t\t}\n\t});\n\treturn result;\n}\n\n\n/**\n * Check custom form validators.\n * A form can handle several form validators which will be called before the form is submitted.\n *\n *\n * @param form: checked form\n * @param settings: computed form settings\n */\nexport function checkFormValidators(form, settings) {\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst validators = settings.getValidators(form, settings);\n\t\tif (!validators.size) {\n\t\t\tresolve('success');\n\t\t\treturn;\n\t\t}\n\t\tconst checks = [];\n\t\tfor (const [context, contextValidators] of validators.entries()) {\n\t\t\tfor (const validator of contextValidators) {\n\t\t\t\tchecks.push(MyAMS.core.executeFunctionByName(validator, document, form, context));\n\t\t\t}\n\t\t}\n\t\t$.when.apply($, checks).then((...results) => {\n\t\t\tlet status = 'success',\n\t\t\t\toutput = [];\n\t\t\tfor (const result of results) {\n\t\t\t\tif (result !== true) {\n\t\t\t\t\tstatus = 'error';\n\t\t\t\t\tif (typeof result === 'string') {\n\t\t\t\t\t\toutput.push(result);\n\t\t\t\t\t} else if ($.isArray(result) && (result.length > 0)) {\n\t\t\t\t\t\toutput = output.concat(result);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (output.length > 0) {\n\t\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\t\tconst header = output.length === 1 ? MyAMS.i18n.ERROR_OCCURED :\n\t\t\t\t\t\tMyAMS.i18n.ERRORS_OCCURED;\n\t\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\t\tparent: form,\n\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\theader: header,\n\t\t\t\t\t\tmessage: output\n\t\t\t\t\t});\n\t\t\t\t\tresolve(status);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tresolve(status);\n\t\t\t}\n\t\t}, () => {\n\t\t\treject('error');\n\t\t});\n\t});\n}\n\n\n/**\n * Initialize form submit button\n * Button is disabled and text is updated\n */\nexport function initFormSubmitButton(form, settings, button) {\n\tconst text = button.data('ams-loading-text') || button.text().trim();\n\tif (text) {\n\t\tbutton.data('original-text', button.text())\n\t\t\t.prop('disabled', true)\n\t\t\t.text(`${text}...`);\n\t\t$('<div>').addClass('progress')\n\t\t\t.appendTo(button);\n\t} else {  // button without text\n\t\tbutton.data('original-html', button.html())\n\t\t\t.prop('disabled', true)\n\t\t\t.html('<i class=\"fa fa-cog fa-spin\"></i>');\n\t}\n}\n\n\n// reset form submit button\nexport function resetFormSubmitButton(form, settings, button) {\n\t$('.progress', button).remove();\n\tconst text = button.data('original-text');\n\tif (text) {\n\t\tbutton.text(text);\n\t} else {\n\t\tconst html = button.data('original-html');\n\t\tif (html) {\n\t\t\tbutton.html(html);\n\t\t}\n\t}\n\tbutton.prop('disabled', false);\n}\n\n\n// get form data\nexport function getFormData(form, settings, formData, button, buttonData, options) {\n\tconst\n\t\tdata = $.extend({}, formData.amsFormData, buttonData.amsFormData, options.data),\n\t\tname = button.attr('name');\n\tif (name) {\n\t\tdata[name] = button.val();\n\t}\n\treturn data;\n}\n\n\n// initialize form data\nexport function initFormData(form, settings, button, postData, options, veto) {\n\tconst callback = settings.initDataCallback;\n\tif (callback) {\n\t\t$.extend(postData, callback(form, settings, button, postData, options, veto));\n\t}\n\tform.trigger('init-data.ams.form', [postData, veto]);\n}\n\n\n// get form target\nexport function getFormTarget(form, settings /*, formData, buttonData */) {\n\treturn $(settings.submitTarget);\n}\n\n\n// initialize form target\nconst TARGET_INIT_TEMPLATE_STRING = `\n\t<div class=\"row m-3\">\n\t\t<div class=\"text-center w-100\">\n\t\t\t<i class=\"fa fa-3x fa-cog fa-spin\"></i>\n\t\t\t{{if message}}\n\t\t\t<strong>{{:message}}</strong>\n\t\t\t{{/if}}\n\t\t</div>\n\t</div>`;\n\nconst TARGET_INIT_TEMPLATE = $.templates({\n\tmarkup: TARGET_INIT_TEMPLATE_STRING\n});\n\nexport function initFormTarget(form, settings, target) {\n\ttarget.html(TARGET_INIT_TEMPLATE.render({ message: settings.submitMessage }));\n\ttarget.parents('.hidden').removeClass('hidden');\n}\n\n\n// get form action\nexport function getFormAction(form, settings, handler) {\n\tlet url;\n\tconst formHandler = handler || settings.submitHandler;\n\tif (formHandler.startsWith(window.location.protocol)) {\n\t\turl = formHandler;\n\t} else {\n\t\turl = MyAMS.ajax.getAddr() + formHandler;\n\t}\n\treturn url;\n}\n\n\n// get AJAX POST submit settings\nexport function getFormAjaxSettings(form, settings, button, postData, action, target) {\n\tconst base = {\n\t\turl: action,\n\t\ttype: 'post',\n\t\tcache: false,\n\t\tdata: postData,\n\t\tdataType: settings.datatype,\n\t\tbeforeSerialize: (form /*, options */) => {\n\t\t\tconst veto = { veto: false };\n\t\t\tform.trigger('before-serialize.ams.form', [veto]);\n\t\t\tif (veto.veto) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (typeof window.tinyMCE !== 'undefined') {\n\t\t\t\ttinyMCE.triggerSave();\n\t\t\t}\n\t\t},\n\t\tbeforeSubmit: (data, form /*, options */) => {\n\t\t\tconst veto = { veto: false };\n\t\t\tform.trigger('before-submit.ams.form', [data, veto]);\n\t\t\tif (veto.veto) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tform.data('submitted', true);\n\t\t\tif (settings.resetBeforeSubmit) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tsettings.resetSubmitButton(form, settings, button);\n\t\t\t\t}, 250);\n\t\t\t}\n\t\t},\n\t\tuploadProgress: (evt, position, total, completed) => {\n\t\t\t$('.progress', button).css('background-image',\n\t\t\t\t`linear-gradient(to right, white -45%, green ${completed}%, red ${completed}%, red)`);\n\t\t},\n\t\tcomplete: (xhr) => {\n\t\t\tform.trigger('complete.ams.form', [xhr]);\n\t\t},\n\t\tsuccess: (result, status, request, form) => {\n\t\t\tconst veto = { veto: false };\n\t\t\tform.trigger('submit-success.ams.form', [result, status, request, veto]);\n\t\t\tif (veto.veto) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (result && result.status !== 'error' && result.closeForm !== false) {\n\t\t\t\tconst modal = form.closest('.modal-dialog');\n\t\t\t\tif (modal.exists() && !settings.keepModalOpen) {\n\t\t\t\t\tMyAMS.modal && MyAMS.modal.close(modal);\n\t\t\t\t}\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tsettings.submitCallback(form, settings, target, result, status, request);\n\t\t\t} finally {\n\t\t\t\tsettings.resetAfterSubmit(form, settings, button);\n\t\t\t\tMyAMS.form.resetChanged(form);\n\t\t\t}\n\t\t},\n\t\terror: (request, status, error, form) => {\n\t\t\tform.trigger('submit-error.ams.form', [request, status, error, target]);\n\t\t\tif (target) {\n\t\t\t\tsettings.resetAfterError(form, settings, button, target);\n\t\t\t}\n\t\t\tsettings.resetAfterSubmit(form, settings, button);\n\t\t},\n\t\tiframe: false\n\t}\n\treturn $.extend({}, base, settings.submitOptions);\n}\n\n\n// get form submit processing progress settings\nexport function getFormProgressSettings(form, settings, button, postData) {\n\tconst handler = settings.progressHandler;\n\tif (handler) {\n\t\t// check fieldname\n\t\tconst fieldname = settings.progressFieldName;\n\t\tpostData[fieldname] = MyAMS.core.generateUUID();\n\t\t// check progress target\n\t\tlet progressTarget = button;\n\t\tif (settings.progressTarget) {\n\t\t\tprogressTarget = $(settings.progressTarget);\n\t\t}\n\t\treturn {\n\t\t\thandler: handler,\n\t\t\tinterval: settings.progressInterval,\n\t\t\tfieldname: fieldname,\n\t\t\ttarget: progressTarget,\n\t\t\tcallback: settings.progressCallback,\n\t\t\tendCallback: settings.progressEndCallback\n\t\t}\n\t}\n}\n\n\n// get form submit progress state\nexport function getFormProgressState(form, settings, postData, progress, target) {\n\n\tlet timeout = setTimeout(_getProgressState, progress.interval);\n\n\tfunction _getProgressState() {\n\t\tconst data = {};\n\t\tdata[progress.fieldname] = postData[progress.fieldname];\n\t\tMyAMS.ajax.post(progress.handler, data)\n\t\t\t.then(MyAMS.core.getFunctionByName(progress.callback || function(result, status) {\n\t\t\t\tif ($.isArray(result)) {\n\t\t\t\t\tstatus = result[1];\n\t\t\t\t\tresult = result[0];\n\t\t\t\t}\n\t\t\t\tif (status === 'success') {\n\t\t\t\t\tif (result.status === 'running') {\n\t\t\t\t\t\tif (result.message) {\n\t\t\t\t\t\t\ttarget.text(result.message);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet text = result.progress || target.data('ams-progress-text') || MyAMS.i18n.PROGRESS;\n\t\t\t\t\t\t\tif (result.current) {\n\t\t\t\t\t\t\t\ttext += `: ${result.current} / ${result.length || 100}`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttext += '...';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttarget.text(text);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttimeout = setTimeout(_getProgressState, progress.interval);\n\t\t\t\t\t} else if (result.status === 'finished') {\n\t\t\t\t\t\t_clearProgressState();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t_clearProgressState();\n\t\t\t\t}\n\t\t\t}), _clearProgressState);\n\t}\n\n\tfunction _clearProgressState() {\n\t\tclearTimeout(timeout);\n\t\tsettings.resetSubmitButton(form, settings, target);\n\t\tMyAMS.core.executeFunctionByName(progress.endCallback, document, form, settings, target);\n\t\tMyAMS.form.resetChanged(form);\n\t}\n}\n\n\n// submit form\nexport function submitForm(form, settings, button, postData, ajaxSettings, target) {\n\tif (ajaxSettings.progress) {\n\t\tsettings.getProgressState(form, settings, postData, ajaxSettings.progress, target);\n\t}\n\tform.ajaxSubmit(ajaxSettings);\n}\n\n\n/**\n * Default form submit callback\n * \n * @param form\n * @param settings: computed form settings\n * @param target\n * @param result\n * @param status\n * @param request\n */\nexport function formSubmitCallback(form, settings, target, result, status, request) {\n\tlet dataType = settings.datatype;\n\tif (!dataType) {\n\t\tconst response = MyAMS.ajax.getResponse(request);\n\t\tif (response) {\n\t\t\tdataType = response.contentType;\n\t\t\tresult = response.data;\n\t\t}\n\t}\n\n\tswitch (dataType) {\n\t\tcase 'binary':\n\t\tcase 'script':\n\t\tcase 'xml':\n\t\t\tbreak;\n\t\tcase 'json':\n\t\t\tMyAMS.ajax.handleJSON(result, form, target);\n\t\t\tbreak;\n\t\tdefault:  // text or html\n\t\t\tMyAMS.form.resetChanged(form);\n\t\t\ttarget.css({ opacity: '0.0' });\n\t\t\ttarget.removeClass('hidden')\n\t\t\t\t.parents('.hidden')\n\t\t\t\t.removeClass('.hidden');\n\t\t\ttarget.html(result)\n\t\t\t\t.delay(50)\n\t\t\t\t.animate({ opacity: '1.0' }, 250);\n\t\t\tMyAMS.core.executeFunctionByName(MyAMS.config.initContent, document, target).then(() => {\n\t\t\t\tMyAMS.require('helpers').then(() => {\n\t\t\t\t\tMyAMS.helpers.scrollTo('#main', target, { offset: -15 });\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tconst callback = request.getResponseHeader('X-AMS-Callback');\n\tif (callback) {\n\t\tconst options = request.getResponseHeader('X-AMS-Callback-Options') || \"{}\";\n\t\tMyAMS.core.executeFunctionByName(callback, document, form, settings, options,\n\t\t\tresult, status, request);\n\t}\n\tform.trigger('after-submit.ams.form', [result]);\n}\n\n\n/**\n * Reset AJAX form after submit\n * \n * @param form: current form\n * @param settings: computed form settings\n * @param button: button used to submit the form, if any\n */\nexport function resetFormAfterSubmit(form, settings, button) {\n\tif (form.data('submitted')) {\n\t\tsettings.resetSubmitButton(form, settings, button);\n\t\tform.data('submitted', false);\n\t\tform.removeData('ams-submit-button');\n\t\tform.trigger('after-reset.ams.form');\n\t\tif (form.data('ams-reset-after-submit')) {\n\t\t\tform.get(0).reset();\n\t\t}\n\t}\n}\n\n\n/**\n * Reset form after submit error\n *\n * @param form: current form\n * @param settings: computed form settings\n * @param target: previous form target\n */\nexport function resetFormAfterError(form, settings, target) {\n\t$('i', target)\n\t\t.removeClass('fa-spin')\n\t\t.removeClass('fa-cog')\n\t\t.addClass('fa-ambulance');\n}\n\n\n// get form download target\nexport function getFormDownloadTarget(form, settings) {\n\treturn settings.downloadTarget;\n}\n\n\n// initialize download target\nexport function initFormDownloadTarget(form, settings, target, ajaxSettings) {\n\tlet iframe = $(`iframe[name=\"${target}\"]`);\n\tif (!iframe.exists()) {\n\t\tiframe = $('<iframe>').attr('name', target)\n\t\t\t.hide()\n\t\t\t.appendTo(MyAMS.dom.root);\n\t}\n\t$.extend(ajaxSettings, {\n\t\tiframe: true,\n\t\tiframeTarget: iframe\n\t});\n}\n\n\n// reset if download target\nexport function resetFormDownloadTarget(form, settings, button, target, ajaxSettings) {\n\tconst\n\t\tmodal = form.closest('.modal-dialog'),\n\t\tkeepModal = settings.keepModalOpen;\n\tif (modal.exists() && (keepModal !== true)) {\n\t\tMyAMS.require('modal').then(() => {\n\t\t\tMyAMS.modal.close(modal);\n\t\t});\n\t}\n\tif (!ajaxSettings.progress) {\n\t\tsetTimeout(() => {\n\t\t\tsettings.resetAfterSubmit(form, settings, button);\n\t\t\tMyAMS.ajax && MyAMS.ajax.stop();\n\t\t\tMyAMS.form.resetChanged(form);\n\t\t}, settings.resetTimeout);\n\t}\n}\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('form');\n\t} else {\n\t\tMyAMS.form = form;\n\t\tconsole.debug(\"MyAMS: form module loaded...\");\n\t}\n}\n"],"mappings":"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"}
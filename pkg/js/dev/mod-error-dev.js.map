{"version":3,"sources":["mod-error.js"],"names":["$","MyAMS","ERRORS_TEMPLATE_STRING","ERROR_TEMPLATE","templates","markup","allowCode","error","showErrors","parent","errors","require","then","alert","status","header","i18n","ERROR_OCCURED","message","isArray","ERRORS_OCCURED","form","clearAlerts","messages","push","widgets","widget","label","length","props","render","prependTo","input","id","name","exists","setInvalid","window","env","bundle","config","modules","console","debug"],"mappings":"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","sourcesContent":["/**\n * MyAMS errors management\n */\n\nimport 'jsrender';\n\nconst $ = MyAMS.$;\n\n\nconst ERRORS_TEMPLATE_STRING = `\n\t<div class=\"alert alert-{{:status}}\" role=\"alert\">\n\t\t<button type=\"button\" class=\"close\" data-dismiss=\"alert\" \n\t\t\t\taria-label=\"{{*: MyAMS.i18n.BTN_CLODE }}\">\n\t\t\t<i class=\"fa fa-times\" aria-hidden=\"true\"></i>\t\n\t\t</button>\n\t\t{{if header}}\n\t\t<h5 class=\"alert-heading\">{{:header}}</h5>\n\t\t{{/if}}\n\t\t{{if message}}\n\t\t<p>{{:message}}</p>\n\t\t{{/if}}\n\t\t{{if messages}}\n\t\t<ul>\n\t\t{{for messages}}\n\t\t\t<li>\n\t\t\t\t{{if header}}<strong>{{:header}} :</strong>{{/if}}\n\t\t\t\t{{:message}}\n\t\t\t</li>\n\t\t{{/for}}\n\t\t</ul>\n\t\t{{/if}}\n\t\t{{if widgets}}\n\t\t<ul>\n\t\t{{for widgets}}\n\t\t\t<li>\n\t\t\t\t{{if header}}<strong>{{:header}} :</strong>{{/if}}\n\t\t\t\t{{:message}}\n\t\t\t</li>\n\t\t{{/for}}\n\t\t</ul>\n\t\t{{/if}}\n\t</div>`;\n\nconst ERROR_TEMPLATE = $.templates({\n\tmarkup: ERRORS_TEMPLATE_STRING,\n\tallowCode: true\n});\n\n\nexport const error = {\n\n\t/**\n\t * Show errors as alert in given parent\n\t *\n\t * @param parent: alert parent element\n\t * @param errors: errors properties\n\t */\n\tshowErrors: (parent, errors) => {\n\t\tif (typeof errors === 'string') {  // simple error message\n\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\tparent: parent,\n\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\theader: MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\tmessage: errors\n\t\t\t\t});\n\t\t\t});\n\t\t} else if ($.isArray(errors)) {  // array of messages\n\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\tparent: parent,\n\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\theader: MyAMS.i18n.ERRORS_OCCURED,\n\t\t\t\t\tmessage: errors\n\t\t\t\t});\n\t\t\t});\n\t\t} else {  // full errors with widgets\n\t\t\tMyAMS.require('i18n', 'alert', 'form').then(() => {\n\t\t\t\t// clear previous alerts\n\t\t\t\tMyAMS.form.clearAlerts(parent);\n\t\t\t\t// create new alert\n\t\t\t\tconst messages= [];\n\t\t\t\tfor (const message of errors.messages || []) {\n\t\t\t\t\tif (typeof message === 'string') {\n\t\t\t\t\t\tmessages.push({\n\t\t\t\t\t\t\theader: null,\n\t\t\t\t\t\t\tmessage: message\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmessages.push(message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (const widget of errors.widgets || []) {\n\t\t\t\t\tmessages.push({\n\t\t\t\t\t\theader: widget.label,\n\t\t\t\t\t\tmessage: widget.message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst\n\t\t\t\t\theader = errors.header ||\n\t\t\t\t\t\t(messages.length > 1 ? MyAMS.i18n.ERRORS_OCCURED : MyAMS.i18n.ERROR_OCCURED),\n\t\t\t\t\tprops = {\n\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\theader: header,\n\t\t\t\t\t\tmessage: errors.error || null,\n\t\t\t\t\t\tmessages: messages\n\t\t\t\t\t};\n\t\t\t\t$(ERROR_TEMPLATE.render(props)).prependTo(parent);\n\t\t\t\t// update status of invalid widgets\n\t\t\t\tfor (const widget of errors.widgets || []) {\n\t\t\t\t\tlet input;\n\t\t\t\t\tif (widget.id) {\n\t\t\t\t\t\tinput = $(`#${widget.id}`, parent);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinput = $(`[name=\"${widget.name}\"]`, parent);\n\t\t\t\t\t}\n\t\t\t\t\tif (input.exists()) {\n\t\t\t\t\t\tMyAMS.form.setInvalid(parent, input, widget.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('error');\n\t} else {\n\t\tMyAMS.error = error;\n\t\tconsole.debug(\"MyAMS: error module loaded...\");\n\t}\n}\n"],"file":"mod-error-dev.js"}
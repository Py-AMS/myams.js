{"version":3,"sources":["mod-error.js"],"names":["$","MyAMS","ERRORS_TEMPLATE_STRING","ERROR_TEMPLATE","templates","markup","allowCode","error","showErrors","parent","errors","Promise","resolve","reject","require","then","alert","status","header","i18n","ERROR_OCCURED","message","isArray","ERRORS_OCCURED","form","clearAlerts","messages","push","widgets","widget","label","length","props","render","prependTo","input","id","name","exists","setInvalid","window","env","bundle","config","modules","console","debug"],"mappings":"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","sourcesContent":["/* global MyAMS */\n/**\n * MyAMS errors management\n */\n\nimport 'jsrender';\n\nconst $ = MyAMS.$;\n\n\nconst ERRORS_TEMPLATE_STRING = `\n\t<div class=\"alert alert-{{:status}}\" role=\"alert\">\n\t\t<button type=\"button\" class=\"close\" data-dismiss=\"alert\" \n\t\t\t\taria-label=\"{{*: MyAMS.i18n.BTN_CLODE }}\">\n\t\t\t<i class=\"fa fa-times\" aria-hidden=\"true\"></i>\t\n\t\t</button>\n\t\t{{if header}}\n\t\t<h5 class=\"alert-heading\">{{:header}}</h5>\n\t\t{{/if}}\n\t\t{{if message}}\n\t\t<p>{{:message}}</p>\n\t\t{{/if}}\n\t\t{{if messages}}\n\t\t<ul>\n\t\t{{for messages}}\n\t\t\t<li>\n\t\t\t\t{{if header}}<strong>{{:header}} :</strong>{{/if}}\n\t\t\t\t{{:message}}\n\t\t\t</li>\n\t\t{{/for}}\n\t\t</ul>\n\t\t{{/if}}\n\t\t{{if widgets}}\n\t\t<ul>\n\t\t{{for widgets}}\n\t\t\t<li>\n\t\t\t\t{{if header}}<strong>{{:header}} :</strong>{{/if}}\n\t\t\t\t{{:message}}\n\t\t\t</li>\n\t\t{{/for}}\n\t\t</ul>\n\t\t{{/if}}\n\t</div>`;\n\nconst ERROR_TEMPLATE = $.templates({\n\tmarkup: ERRORS_TEMPLATE_STRING,\n\tallowCode: true\n});\n\n\nexport const error = {\n\n\t/**\n\t * Show errors as alert in given parent\n\t *\n\t * @param parent: alert parent element\n\t * @param errors: errors properties\n\t */\n\tshowErrors: (parent, errors) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (typeof errors === 'string') {  // simple error message\n\t\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\t\tparent: parent,\n\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\theader: MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\tmessage: errors\n\t\t\t\t\t});\n\t\t\t\t}).then(resolve, reject);\n\t\t\t} else if ($.isArray(errors)) {  // array of messages\n\t\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\t\tparent: parent,\n\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\theader: MyAMS.i18n.ERRORS_OCCURED,\n\t\t\t\t\t\tmessage: errors\n\t\t\t\t\t});\n\t\t\t\t}).then(resolve, reject);\n\t\t\t} else {  // full errors with widgets\n\t\t\t\tMyAMS.require('i18n', 'alert', 'form').then(() => {\n\t\t\t\t\t// clear previous alerts\n\t\t\t\t\tMyAMS.form.clearAlerts(parent);\n\t\t\t\t\t// create new alert\n\t\t\t\t\tconst messages = [];\n\t\t\t\t\tfor (const message of errors.messages || []) {\n\t\t\t\t\t\tif (typeof message === 'string') {\n\t\t\t\t\t\t\tmessages.push({\n\t\t\t\t\t\t\t\theader: null,\n\t\t\t\t\t\t\t\tmessage: message\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmessages.push(message);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (const widget of errors.widgets || []) {\n\t\t\t\t\t\tmessages.push({\n\t\t\t\t\t\t\theader: widget.label,\n\t\t\t\t\t\t\tmessage: widget.message\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst\n\t\t\t\t\t\theader = errors.header ||\n\t\t\t\t\t\t\t(messages.length > 1 ? MyAMS.i18n.ERRORS_OCCURED : MyAMS.i18n.ERROR_OCCURED),\n\t\t\t\t\t\tprops = {\n\t\t\t\t\t\t\tstatus: 'danger',\n\t\t\t\t\t\t\theader: header,\n\t\t\t\t\t\t\tmessage: errors.error || null,\n\t\t\t\t\t\t\tmessages: messages\n\t\t\t\t\t\t};\n\t\t\t\t\t$(ERROR_TEMPLATE.render(props)).prependTo(parent);\n\t\t\t\t\t// update status of invalid widgets\n\t\t\t\t\tfor (const widget of errors.widgets || []) {\n\t\t\t\t\t\tlet input;\n\t\t\t\t\t\tif (widget.id) {\n\t\t\t\t\t\t\tinput = $(`#${widget.id}`, parent);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinput = $(`[name=\"${widget.name}\"]`, parent);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (input.exists()) {\n\t\t\t\t\t\t\tMyAMS.form.setInvalid(parent, input, widget.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(resolve, reject);\n\t\t\t}\n\t\t});\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('error');\n\t} else {\n\t\tMyAMS.error = error;\n\t\tconsole.debug(\"MyAMS: error module loaded...\");\n\t}\n}\n"],"file":"mod-error-dev.js"}
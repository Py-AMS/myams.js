!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var o={};t(o),e.modAjax=o}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ajax=void 0;var C=MyAMS.$;function i(e){if(window.Cookies){var t=Cookies.get(MyAMS.config.csrfCookieName);t&&e.setRequestHeader(MyAMS.config.csrfHeaderName,t)}}var o={check:function(u,f){return new Promise(function(e,t){var o=[];if(void 0===u){f instanceof Array||(f=[f]);var n=!0,a=!1,r=void 0;try{for(var s,i=f[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var c=s.value;o.push(MyAMS.core.getScript(c))}}catch(e){a=!0,r=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw r}}}else{u instanceof Array||(u=[u]);for(var l=0;l<u.length;l++)void 0===u[l]&&o.push(MyAMS.core.getScript(f[l]))}C.when.apply(C,o).then(function(){e(0<o.length)},t)})},getAddr:function(e){var t=e||C("html head base").attr("href")||window.location.href;return t.substr(0,t.lastIndexOf("/")+1)},start:function(){C("#ajax-gear").show()},stop:function(){C("#ajax-gear").hide()},progress:function(e){e.lengthComputable&&(e.loaded>=e.total||console&&console.debug&&console.debug("".concat(Math.round(e.loaded/e.total*100),"%")))},get:function(o,r,s){return new Promise(function(n,a){var e={url:o.startsWith(window.location.protocol)?o:MyAMS.ajax.getAddr()+o,type:"get",cache:!1,data:C.param(r),dataType:"json",beforeSend:i},t=C.extend({},e,s);C.ajax(t).then(function(e,t,o){n(e,t,o)},function(e,t,o){a(o)})})},post:function(o,r,s){return new Promise(function(n,a){var e={url:o.startsWith(window.location.protocol)?o:MyAMS.ajax.getAddr()+o,type:"post",cache:!1,data:C.param(r),dataType:"json",beforeSend:i},t=C.extend({},e,s);C.ajax(t).then(function(e,t,o){n(e,t,o)},function(e,t,o){a(o)})})},getJSON:function(){return function(e){var t=e.url;return delete e.url,MyAMS.ajax.post(t,e).then(MyAMS.ajax.handleJSON)}},getResponse:function(t){var o,n="unknown";if(t){var e=t.getResponseHeader("content-type");if(e)if(e.startsWith("application/javascript"))o=t.responseText,n="script";else if(e.startsWith("text/html"))o=t.responseText,n="html";else if(e.startsWith("text/xml"))o=t.responseText,n="xml";else if(o=t.responseJSON)n="json";else try{o=JSON.parse(t.responseText),n="json"}catch(e){o=t.responseText,n="text"}else o={status:"alert",alert:{title:MyAMS.i18n.ERROR_OCCURED,content:MyAMS.i18n.NO_SERVER_RESPONSE}},n="json"}return{contentType:n,data:o}},handleJSON:function(o,n,e){function t(){return new Promise(function(e,t){void 0!==n?MyAMS.require("form").then(function(){MyAMS.form.resetChanged(n)}).then(function(){!1!==o.closeForm?MyAMS.require("modal").then(function(){MyAMS.modal.close(n)}).then(e,t):e()}):e()})}var a=null,r=null,s=o.status,i=[];switch(s){case"alert":if(window.alert){var c=o.alert;window.alert("".concat(c.title,"\n\n").concat(c.content))}break;case"error":i.push(MyAMS.require("error").then(function(){MyAMS.error.showErrors(n,o)}));break;case"message":case"messagebox":case"smallbox":break;case"info":case"success":case"notify":case"callback":case"callbacks":i.push(t());break;case"modal":i.push(MyAMS.require("modal").then(function(){MyAMS.modal.open(o.location)}));break;case"reload":t(),(a=o.location||window.location.hash).startsWith("#")&&(a=a.substr(1)),r=C(o.target||e||"#content"),i.push(MyAMS.require("skin").then(function(){MyAMS.skin.loadURL(a,r,{preLoadCallback:MyAMS.core.getFunctionByName(o.preReload||function(){C("[data-ams-pre-reload]",r).each(function(e,t){MyAMS.core.executeFunctionByName(C(t).data("ams-pre-reload"))})}),preLoadCallbackOptions:o.preReloadOptions,afterLoadCallback:MyAMS.core.getFunctionByName(o.postReload||function(){C("[data-ams-post-reload]",r).each(function(e,t){MyAMS.core.executeFunctionByName(C(t).data("ams-post-reload"))})}),afterLoadCallbackOptions:o.postReloadOptions})}));break;case"redirect":t(),(a=o.location||window.location.href).endsWith("##")&&(a=a.replace(/##/,window.location.hash)),o.window?window.open(a,o.window,o.options):window.location.href===a?window.location.reload():window.location.href=a;break;default:window.console&&console.warn&&console.warn("Unhandled JSON response status: ".concat(s))}if(o.content){var l=o.content,u=C(l.target||e||"#content");"string"==typeof l?u.html(l):(l.text?u.text(l.text):u.html(l.html),i.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,u).then(function(){l.keepHidden||u.removeClass("hidden")})))}if(o.contents){var f=!0,d=!1,M=void 0;try{for(var p,y=function(){var e=p.value,t=C(e.target);e.text?t.text(e.text):t.html(e.html),i.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,t).then(function(){e.keepHidden||t.removeClass("hidden")}))},m=o.contents[Symbol.iterator]();!(f=(p=m.next()).done);f=!0)y()}catch(e){d=!0,M=e}finally{try{f||null==m.return||m.return()}finally{if(d)throw M}}}if(o.message&&i.push(MyAMS.require("alert").then(function(){if("string"==typeof o.message)MyAMS.alert.smallBox({status:s,message:o.message,icon:"fa-info-circle",timeout:3e3});else{var e=o.message;MyAMS.alert.alert({parent:n,status:e.status||s,header:e.header,subtitle:e.subtitle,message:e.message})}})),o.messagebox&&i.push(MyAMS.require("alert").then(function(){if("string"==typeof o.messagebox)MyAMS.alert.messageBox({status:s,title:MyAMS.i18n.ERROR_OCCURED,icon:"fa-info-circle",message:o.messagebox,timeout:1e4});else{var e=o.messagebox;MyAMS.alert.messageBox({status:e.status||s,title:e.title||MyAMS.i18n.ERROR_OCCURED,icon:e.icon||"fa-info-circle",message:e.message,content:e.content,timeout:0===e.timeout?0:e.timeout||1e4})}})),o.smallbox&&i.push(MyAMS.require("alert").then(function(){if("string"==typeof o.smallbox)MyAMS.alert.smallBox({status:s,message:o.smallbox,icon:"fa-info-circle",timeout:3e3});else{var e=o.smallbox;MyAMS.alert.smallBox({status:e.status||s,message:e.message,content:e.content,icon:e.icon||"fa-info-circle",timeout:e.timeout})}})),o.event&&n.trigger(o.event,o.eventOptions),o.events){var h=!0,g=!1,x=void 0;try{for(var S,A=o.events[Symbol.iterator]();!(h=(S=A.next()).done);h=!0){var v=S.value;"string"==typeof v?n.trigger(v,o.eventOptions):n.trigger(v.event,v.options)}}catch(e){g=!0,x=e}finally{try{h||null==A.return||A.return()}finally{if(g)throw x}}}if(o.callback&&i.push(MyAMS.core.executeFunctionByName(o.callback,document,n,o.options)),o.callbacks){var w=!0,b=!1,k=void 0;try{for(var R,j=o.callbacks[Symbol.iterator]();!(w=(R=j.next()).done);w=!0){var O=R.value;"string"==typeof O?i.push(MyAMS.core.executeFunctionByName(O,document,n,o.options)):i.push(MyAMS.core.executeFunctionByName(O.callback,document,n,O.options))}}catch(e){b=!0,k=e}finally{try{w||null==j.return||j.return()}finally{if(b)throw k}}}return Promise.all(i)},error:function(o,e,t,n){if(!("abort"===n||e&&e.statusText&&"OK"===e.statusText.toUpperCase())){var a=MyAMS.ajax.getResponse(e);a?"json"===a.contentType?MyAMS.ajax.handleJSON(a.data):MyAMS.require("i18n","alert").then(function(){var e=n||o.statusText||o.type,t=a.responseText;MyAMS.alert.messageBox({status:"error",title:MyAMS.i18n.ERROR_OCCURED,content:"<h4>".concat(e,"</h4><p>").concat(t||"","</p>"),icon:"fa-exclamation-triangle",timeout:5e3})},function(){window.console&&(console.error&&console.error(o),console.debug&&console.debug(a))}):window.console&&(console.error&&console.error("ERROR: Can't parse response!"),console.debug&&console.debug(e))}}};(e.ajax=o).check(window.Cookies,"".concat(MyAMS.env.baseURL,"../ext/js-cookie").concat(MyAMS.env.extext,".js")).then(function(){var t=C.ajaxSettings.xhr;C.ajaxSetup({beforeSend:function(e,t){if(MyAMS.config.safeMethods.indexOf(t.type)<0&&void 0!==window.Cookies){var o=Cookies.get(MyAMS.config.csrfCookieName);o&&e.setRequestHeader(MyAMS.config.csrfHeaderName,o)}},progress:o.progress,progressUpload:o.progress,xhr:function(){var e=t();return e&&"function"==typeof e.addEventListener&&o.progress&&e.addEventListener("progress",function(e){MyAMS.ajax.progress(e)},!1),e}})}),C(document).ajaxStart(o.start),C(document).ajaxStop(o.stop),C(document).ajaxError(o.error),MyAMS.env.bundle?MyAMS.config.modules.push("ajax"):(MyAMS.ajax=o,console.debug("MyAMS: AJAX module loaded..."))});
!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var o={};t(o),e.modAjax=o}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ajax=void 0;var C=MyAMS.$;function i(e,t){if(window.Cookies){var o=Cookies.get(MyAMS.config.csrfCookieName);o&&e.setRequestHeader(MyAMS.config.csrfHeaderName,o)}}var o={check:function(u,d){return new Promise(function(e,t){var o=[];if(void 0===u){d instanceof Array||(d=[d]);var n=!0,a=!1,r=void 0;try{for(var s,i=d[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var c=s.value;o.push(MyAMS.core.getScript(c))}}catch(e){a=!0,r=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw r}}}else{u instanceof Array||(u=[u]);for(var l=0;l<u.length;l++)void 0===u[l]&&o.push(MyAMS.core.getScript(d[l]))}C.when.apply(C,o).then(function(){e(0<o.length)},t)})},getAddr:function(e){var t=e||C("html head base").attr("href")||window.location.href;return t.substr(0,t.lastIndexOf("/")+1)},start:function(){C("#ajax-gear").show()},stop:function(){C("#ajax-gear").hide()},progress:function(e){e.lengthComputable&&(e.loaded>=e.total||console&&console.debug&&console.debug("".concat(Math.round(e.loaded/e.total*100),"%")))},get:function(o,r,s){return new Promise(function(n,a){var e={url:o.startsWith(window.location.protocol)?o:MyAMS.ajax.getAddr()+o,type:"get",cache:!1,data:C.param(r),dataType:"json",beforeSend:i},t=C.extend({},e,s);C.ajax(t).then(function(e,t,o){n(e,t,o)},function(e,t,o){a(o)})})},post:function(o,r,s){return new Promise(function(n,a){var e={url:o.startsWith(window.location.protocol)?o:MyAMS.ajax.getAddr()+o,type:"post",cache:!1,data:C.param(r),dataType:"json",beforeSend:i},t=C.extend({},e,s);C.ajax(t).then(function(e,t,o){n(e,t,o)},function(e,t,o){a(o)})})},getJSON:function(){return function(e){var t=e.url;return delete e.url,MyAMS.ajax.post(t,e).then(MyAMS.ajax.handleJSON)}},getResponse:function(t){var o,n,e=t.getResponseHeader("content-type");if(e)if(e.startsWith("application/javascript"))n=t.responseText,o="script";else if(e.startsWith("text/html"))n=t.responseText,o="html";else if(e.startsWith("text/xml"))n=t.responseText,o="xml";else if(n=t.responseJSON)o="json";else try{n=JSON.parse(t.responseText),o="json"}catch(e){n=t.responseText,o="text"}else n={status:"alert",alert:{title:MyAMS.i18n.ERROR_OCCURED,content:MyAMS.i18n.NO_SERVER_RESPONSE}},o="json";return{contentType:o,data:n}},handleJSON:function(t,o,e){function n(){void 0!==o&&(MyAMS.require("form",function(){MyAMS.form.resetChanged(o)}),!1!==t.closeForm&&MyAMS.require("modal",function(){MyAMS.modal.close(o)}))}var a=null,r=t.status;switch(r){case"alert":if(window.alert){var s=t.alert;window.alert("".concat(s.title,"\n\n").concat(s.content))}break;case"error":MyAMS.require("error").then(function(){MyAMS.error.showErrors(o,t)});break;case"message":case"messagebox":case"smallbox":break;case"info":case"success":case"notify":case"callback":case"callbacks":n();break;case"modal":MyAMS.require("modal").then(function(){MyAMS.modal.open(t.location)});break;case"reload":n(),(a=t.location||window.location.hash).startsWith("#")&&(a=a.substr(1));var i=C(t.target||e||"#content");MyAMS.require("skin").then(function(){MyAMS.skin.loadURL(a,i,{preLoadCallback:MyAMS.core.getFunctionByName(t.preReload||function(){C("[data-ams-pre-reload]",i).each(function(e,t){MyAMS.core.executeFunctionByName(C(t).data("ams-pre-reload"))})}),preLoadCallbackOptions:t.preReloadOptions,afterLoadCallback:MyAMS.core.getFunctionByName(t.postReload||function(){C("[data-ams-post-reload]",i).each(function(e,t){MyAMS.core.executeFunctionByName(C(t).data("ams-post-reload"))})}),afterLoadCallbackOptions:t.postReloadOptions})});break;case"redirect":n(),(a=t.location||window.location.href).endsWith("##")&&(a=a.replace(/##/,window.location.hash)),t.window?window.open(a,t.window,t.options):window.location.href===a?window.location.reload():window.location.href=a;break;default:window.console&&console.warn&&console.warn("Unhandled JSON response status: ".concat(r))}if(t.content){var c=t.content,l=C(c.target||e||"#content");"string"==typeof c?l.html(c):(c.text?l.text(c.text):l.html(c.html),MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,l),c.keepHidden||l.removeClass("hidden"))}if(t.contents){var u=!0,d=!1,f=void 0;try{for(var M,y=t.contents[Symbol.iterator]();!(u=(M=y.next()).done);u=!0){var m=M.value,p=C(m.target);m.text?p.text(m.text):p.html(m.html),MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,p),m.keepHidden||p.removeClass("hidden")}}catch(e){d=!0,f=e}finally{try{u||null==y.return||y.return()}finally{if(d)throw f}}}if(t.message&&MyAMS.require("alert").then(function(){if("string"==typeof t.message)MyAMS.alert.smallBox({status:r,message:t.message,icon:"fa-info-circle",timeout:3e3});else{var e=t.message;MyAMS.alert.alert({parent:o,status:e.status||r,header:e.header,subtitle:e.subtitle,message:e.message})}}),t.messagebox&&MyAMS.require("alert").then(function(){if("string"==typeof t.messagebox)MyAMS.alert.messageBox({status:r,title:MyAMS.i18n.ERROR_OCCURED,icon:"fa-info-circle",message:t.messagebox,timeout:1e4});else{var e=t.messagebox;MyAMS.alert.messageBox({status:e.status||r,title:e.title||MyAMS.i18n.ERROR_OCCURED,icon:e.icon||"fa-info-circle",message:e.message,content:e.content,timeout:0===e.timeout?0:e.timeout||1e4})}}),t.smallbox&&MyAMS.require("alert").then(function(){if("string"==typeof t.smallbox)MyAMS.alert.smallBox({status:r,message:t.smallbox,icon:"fa-info-circle",timeout:3e3});else{var e=t.smallbox;MyAMS.alert.smallBox({status:e.status||r,message:e.message,content:e.content,icon:e.icon||"fa-info-circle",timeout:e.timeout})}}),t.event&&o.trigger(t.event,t.eventOptions),t.events){var g=!0,h=!1,S=void 0;try{for(var x,A=t.events[Symbol.iterator]();!(g=(x=A.next()).done);g=!0){var v=x.value;"string"==typeof v?o.trigger(v,t.eventOptions):o.trigger(v.event,v.options)}}catch(e){h=!0,S=e}finally{try{g||null==A.return||A.return()}finally{if(h)throw S}}}if(t.callback&&MyAMS.core.executeFunctionByName(t.callback,document,o,t.options),t.callbacks){var b=!0,w=!1,R=void 0;try{for(var k,j=t.callbacks[Symbol.iterator]();!(b=(k=j.next()).done);b=!0){var O=k.value;"string"==typeof O?MyAMS.core.executeFunctionByName(O,document,o,t.options):MyAMS.core.executeFunctionByName(O.callback,document,o,O.options)}}catch(e){w=!0,R=e}finally{try{b||null==j.return||j.return()}finally{if(w)throw R}}}},error:function(o,e,t,n){if(!("abort"===n||e&&e.statusText&&"OK"===e.statusText.toUpperCase())){var a=MyAMS.ajax.getResponse(e);a?"json"===a.contentType?MyAMS.ajax.handleJSON(a.data):MyAMS.require("i18n","alert").then(function(){var e=n||o.statusText||o.type,t=a.responseText;MyAMS.alert.messageBox({status:"error",title:MyAMS.i18n.ERROR_OCCURED,content:"<h4>".concat(e,"</h4><p>").concat(t||"","</p>"),icon:"fa-exclamation-triangle",timeout:5e3})},function(){window.console&&(console.error&&console.error(o),console.debug&&console.debug(a))}):window.console&&(console.error&&console.error("ERROR: Can't parse response!"),console.debug&&console.debug(e))}}};(e.ajax=o).check(window.Cookies,"".concat(MyAMS.env.baseURL,"../ext/js-cookie").concat(MyAMS.env.devmode?".min":"",".js")).then(function(){var t=C.ajaxSettings.xhr;C.ajaxSetup({beforeSend:function(e,t){if(MyAMS.config.safeMethods.indexOf(t.type)<0&&void 0!==window.Cookies){var o=Cookies.get(MyAMS.config.csrfCookieName);o&&e.setRequestHeader(MyAMS.config.csrfHeaderName,o)}},progress:o.progress,progressUpload:o.progress,xhr:function(){var e=t();return e&&"function"==typeof e.addEventListener&&o.progress&&e.addEventListener("progress",function(e){MyAMS.ajax.progress(e)},!1),e}})}),C(document).ajaxStart(o.start),C(document).ajaxStop(o.stop),C(document).ajaxError(o.error),MyAMS.env.bundle?MyAMS.config.modules.push("ajax"):(MyAMS.ajax=o,console.debug("MyAMS: AJAX module loaded..."))});
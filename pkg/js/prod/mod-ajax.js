!function(e,t){var n;"function"==typeof define&&define.amd?define(["exports"],t):"undefined"!=typeof exports?t(exports):(t(n={}),e.modAjax=n)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e){"use strict";function S(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw r}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(e,"__esModule",{value:!0}),e.ajax=void 0;var x=MyAMS.$;function l(e){var t;!window.Cookies||(t=Cookies.get(MyAMS.config.csrfCookieName))&&e.setRequestHeader(MyAMS.config.csrfHeaderName,t)}var n={check:function(i,c){return new Promise(function(e,t){var n=[];if(void 0===i){c instanceof Array||(c=[c]);var o,a=S(c);try{for(a.s();!(o=a.n()).done;){var r=o.value;n.push(MyAMS.core.getScript(r))}}catch(e){a.e(e)}finally{a.f()}}else{i instanceof Array||(i=[i]);for(var s=0;s<i.length;s++)void 0===i[s]&&n.push(MyAMS.core.getScript(c[s]))}x.when.apply(x,n).then(function(){e(0<n.length)},t)})},getAddr:function(e){var t=e||x("html head base").attr("href")||window.location.href;return t.substr(0,t.lastIndexOf("/")+1)},start:function(){x("#ajax-gear").show()},stop:function(){x("#ajax-gear").hide()},progress:function(e){e.lengthComputable&&(e.loaded>=e.total||console&&console.debug&&console.debug("".concat(Math.round(e.loaded/e.total*100),"%")))},get:function(r,s,i){return new Promise(function(o,a){var e=r.startsWith(window.location.protocol)?r:MyAMS.ajax.getAddr()+r,t={url:e,type:"get",cache:!1,data:x.param(s),dataType:"json",beforeSend:l},n=x.extend({},t,i);x.ajax(n).then(function(e,t,n){o(e,t,n)},function(e,t,n){a(n)})})},post:function(r,s,i){return new Promise(function(o,a){var e=r.startsWith(window.location.protocol)?r:MyAMS.ajax.getAddr()+r,t={url:e,type:"post",cache:!1,data:x.param(s),dataType:"json",beforeSend:l},n=x.extend({},t,i);x.ajax(n).then(function(e,t,n){o(e,t,n)},function(e,t,n){a(n)})})},getJSON:function(){return function(e){var t=e.url;return delete e.url,MyAMS.ajax.post(t,e).then(MyAMS.ajax.handleJSON)}},getResponse:function(t){var n,o="unknown";if(t){var e=t.getResponseHeader("content-type");if(e)if(e.startsWith("application/javascript"))n=t.responseText,o="script";else if(e.startsWith("text/html"))n=t.responseText,o="html";else if(e.startsWith("text/xml"))n=t.responseText,o="xml";else if(n=t.responseJSON)o="json";else try{n=JSON.parse(t.responseText),o="json"}catch(e){n=t.responseText,o="text"}else n={status:"alert",alert:{title:MyAMS.i18n.ERROR_OCCURED,content:MyAMS.i18n.NO_SERVER_RESPONSE}},o="json"}return{contentType:o,data:n}},handleJSON:function(n,o,e){function t(){return new Promise(function(e,t){void 0!==o?MyAMS.require("form").then(function(){MyAMS.form.resetChanged(o)}).then(function(){!1!==n.closeForm?MyAMS.require("modal").then(function(){MyAMS.modal.close(o)}).then(e,t):e()}):e()})}var a,r,s,i,c=null,l=n.status,u=[];switch(l){case"alert":window.alert&&(r=n.alert,window.alert("".concat(r.title,"\n\n").concat(r.content)));break;case"error":u.push(MyAMS.require("error").then(function(){MyAMS.error.showErrors(o,n)}));break;case"message":case"messagebox":case"smallbox":break;case"info":case"success":case"notify":case"callback":case"callbacks":u.push(t());break;case"modal":u.push(MyAMS.require("modal").then(function(){MyAMS.modal.open(n.location)}));break;case"reload":t(),(c=n.location||window.location.hash).startsWith("#")&&(c=c.substr(1)),a=x(n.target||e||"#content"),u.push(MyAMS.require("skin").then(function(){MyAMS.skin.loadURL(c,a,{preLoadCallback:MyAMS.core.getFunctionByName(n.preReload||function(){x("[data-ams-pre-reload]",a).each(function(e,t){MyAMS.core.executeFunctionByName(x(t).data("ams-pre-reload"))})}),preLoadCallbackOptions:n.preReloadOptions,afterLoadCallback:MyAMS.core.getFunctionByName(n.postReload||function(){x("[data-ams-post-reload]",a).each(function(e,t){MyAMS.core.executeFunctionByName(x(t).data("ams-post-reload"))})}),afterLoadCallbackOptions:n.postReloadOptions})}));break;case"redirect":t(),(c=n.location||window.location.href).endsWith("##")&&(c=c.replace(/##/,window.location.hash)),n.window?window.open(c,n.window,n.options):window.location.href===c?window.location.reload():window.location.href=c;break;default:window.console&&console.warn&&console.warn("Unhandled JSON response status: ".concat(l))}if(n.content&&(s=n.content,i=x(s.target||e||"#content"),"string"==typeof s?i.html(s):(s.text?i.text(s.text):i.html(s.html),u.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,i).then(function(){s.keepHidden||i.removeClass("hidden")})))),n.contents){var f,d=S(n.contents);try{for(d.s();!(f=d.n()).done;)!function(){var e=f.value,t=x(e.target);e.text?t.text(e.text):t.html(e.html),u.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,t).then(function(){e.keepHidden||t.removeClass("hidden")}))}()}catch(e){d.e(e)}finally{d.f()}}if(n.message&&u.push(MyAMS.require("alert").then(function(){var e;"string"==typeof n.message?MyAMS.alert.smallBox({status:l,message:n.message,icon:"fa-info-circle",timeout:3e3}):(e=n.message,MyAMS.alert.alert({parent:o,status:e.status||l,header:e.header,subtitle:e.subtitle,message:e.message}))})),n.messagebox&&u.push(MyAMS.require("alert").then(function(){var e;"string"==typeof n.messagebox?MyAMS.alert.messageBox({status:l,title:MyAMS.i18n.ERROR_OCCURED,icon:"fa-info-circle",message:n.messagebox,timeout:1e4}):(e=n.messagebox,MyAMS.alert.messageBox({status:e.status||l,title:e.title||MyAMS.i18n.ERROR_OCCURED,icon:e.icon||"fa-info-circle",message:e.message,content:e.content,timeout:0===e.timeout?0:e.timeout||1e4}))})),n.smallbox&&u.push(MyAMS.require("alert").then(function(){var e;"string"==typeof n.smallbox?MyAMS.alert.smallBox({status:l,message:n.smallbox,icon:"fa-info-circle",timeout:3e3}):(e=n.smallbox,MyAMS.alert.smallBox({status:e.status||l,message:e.message,content:e.content,icon:e.icon||"fa-info-circle",timeout:e.timeout}))})),n.event&&o.trigger(n.event,n.eventOptions),n.events){var p,M=S(n.events);try{for(M.s();!(p=M.n()).done;){var y=p.value;"string"==typeof y?o.trigger(y,n.eventOptions):o.trigger(y.event,y.options)}}catch(e){M.e(e)}finally{M.f()}}if(n.callback&&u.push(MyAMS.core.executeFunctionByName(n.callback,document,o,n.options)),n.callbacks){var m,h=S(n.callbacks);try{for(h.s();!(m=h.n()).done;){var g=m.value;"string"==typeof g?u.push(MyAMS.core.executeFunctionByName(g,document,o,n.options)):u.push(MyAMS.core.executeFunctionByName(g.callback,document,o,g.options))}}catch(e){h.e(e)}finally{h.f()}}return Promise.all(u)},error:function(n,e,t,o){var a;"abort"!==o&&(e&&e.statusText&&"OK"===e.statusText.toUpperCase()||((a=MyAMS.ajax.getResponse(e))?"json"===a.contentType?MyAMS.ajax.handleJSON(a.data):MyAMS.require("i18n","alert").then(function(){var e=o||n.statusText||n.type,t=a.responseText;MyAMS.alert.messageBox({status:"error",title:MyAMS.i18n.ERROR_OCCURED,content:"<h4>".concat(e,"</h4><p>").concat(t||"","</p>"),icon:"fa-exclamation-triangle",timeout:5e3})},function(){window.console&&(console.error&&console.error(n),console.debug&&console.debug(a))}):window.console&&(console.error&&console.error("ERROR: Can't parse response!"),console.debug&&console.debug(e))))}};(e.ajax=n).check(window.Cookies,"".concat(MyAMS.env.baseURL,"../ext/js-cookie").concat(MyAMS.env.extext,".js")).then(function(){var t=x.ajaxSettings.xhr;x.ajaxSetup({beforeSend:function(e,t){var n;MyAMS.config.safeMethods.indexOf(t.type)<0&&(void 0===window.Cookies||(n=Cookies.get(MyAMS.config.csrfCookieName))&&e.setRequestHeader(MyAMS.config.csrfHeaderName,n))},progress:n.progress,progressUpload:n.progress,xhr:function(){var e=t();return e&&"function"==typeof e.addEventListener&&n.progress&&e.addEventListener("progress",function(e){MyAMS.ajax.progress(e)},!1),e}})}),x(document).ajaxStart(n.start),x(document).ajaxStop(n.stop),x(document).ajaxError(n.error),MyAMS.env.bundle?MyAMS.config.modules.push("ajax"):(MyAMS.ajax=n,console.debug("MyAMS: AJAX module loaded..."))});
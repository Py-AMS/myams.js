!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var r={};t(r),e.modForm=r}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e){"use strict";function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],a=!0,n=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);a=!0);}catch(e){n=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(n)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.showFormSubmitWarning=s,e.getFormValidators=c,e.checkFormValidators=u,e.initFormSubmitButton=l,e.resetFormSubmitButton=m,e.getFormData=f,e.initFormData=d,e.getFormTarget=g,e.initFormTarget=y,e.getFormAction=M,e.getFormAjaxSettings=v,e.getFormProgressSettings=p,e.getFormProgressState=S,e.submitForm=A,e.formSubmitCallback=x,e.resetFormAfterSubmit=C,e.resetFormAfterError=T,e.getFormDownloadTarget=w,e.initFormDownloadTarget=F,e.resetFormDownloadTarget=k,e.form=void 0;var h=MyAMS.$;if(!h.templates){var r=require("jsrender");h.templates=r.templates}var a=!1,n={init:function(){a||(a=!0,h(document).on("click",'[type="submit"], .submit',function(e){var t=h(e.currentTarget);t.exists()&&h(t).closest("form").data("ams-submit-button",t)}),h(window).on("beforeunload",MyAMS.form.checkBeforeUnload))},initElement:function(e){"string"==typeof e&&(e=h(e)),e.on("keydown","textarea",function(e){10!==e.keyCode&&13!==e.keyCode||!e.ctrlKey&&!e.metaKey||h(e.currentTarget).closest("form").submit()}),e.on("focus",'input[readonly="readonly"]',function(e){h(e.currentTarget).blur()}),e.on("focusin",function(e){0<=h(e.target).closest(".mce-window").length&&e.stopImmediatePropagation()}),(MyAMS.config.warnOnFormChange?h('form[data-ams-warn-on-change!="false"]',e):h('form[data-ams-warn-on-change="true"]',e)).each(function(e,t){var o=h(t),i=o.data().amsChangedCallback||MyAMS.config.formChangeCallback;h("input, select, textarea, [data-ams-changed-event]",o).each(function(e,t){var r=h(t),a=r.data();if(!0!==a.amsIgnoreChange){var n=a.amsChangedEvent||"change";r.on(n,function(){MyAMS.form.setChanged(o),MyAMS.core.executeFunctionByName(a.amsChangedCallback||i,document,o,r)})}}),o.on("reset",function(e){var t=h(e.currentTarget);MyAMS.form.clearAlerts(t),MyAMS.form.resetChanged(t)})}),MyAMS.form.setFocus(e)},setFocus:function(e){var t=h("[data-ams-focus-target]",e).first();t.exists()||(t=h("input, select, textarea",e).first()),t.exists()&&t.focus()},checkBeforeUnload:function(){if(MyAMS.i18n&&h('form[data-ams-form-changed="true"]').exists())return MyAMS.i18n.FORM_CHANGED_WARNING},confirmChangedForm:function(a){return new Promise(function(t,e){var r=h('form[data-ams-form-changed="true"]',a);r.exists()?MyAMS.require("alert").then(function(){MyAMS.alert.bigBox({status:"danger",title:MyAMS.i18n.WARNING,icon:"text-danger fa-bell",message:MyAMS.i18n.FORM_CHANGED_WARNING}).then(function(e){"success"===e&&n.resetChanged(r),t(e)})},function(){e("Missing 'alert' module!")}):(n.resetChanged(r),t("success"))})},setChanged:function(e){e.attr("data-ams-form-changed",!0)},resetChanged:function(e){void 0!==e&&h(e).removeAttr("data-ams-form-changed")},setInvalid:function(e,t,r){if("string"==typeof t&&(t=h('[name="'.concat(t,'"]'),e)),t.exists()){var a=t.closest(".form-widget");h(".invalid-feedback",a).remove(),h("<span>").text(r).addClass("is-invalid invalid-feedback").appendTo(a),t.removeClass("valid").addClass("is-invalid")}},clearAlerts:function(e){h(".alert-danger, SPAN.state-error",e).not(".persistent").remove(),h(".state-error",e).removeClassPrefix("state-"),h(".invalid-feedback",e).remove(),h(".is-invalid",e).removeClass("is-invalid")},getSettings:function(e,t,r,a,n){var o={submitWarning:s,getValidators:c,checkValidators:u,clearAlerts:MyAMS.form.clearAlerts,initSubmitButton:l,resetSubmitButton:m,getData:f,initData:d,initDataCallback:null,getTarget:g,initTarget:y,getAction:M,getAjaxSettings:v,getProgressSettings:p,getProgressState:S,submit:A,datatype:null,submitOptions:null,submitHandler:(e.attr("action")||"").replace(/#/,""),submitTarget:e.attr("target")||null,submitMessage:null,submitCallback:x,progressHandler:null,progressFieldName:"progressId",progressInterval:1e3,progressTarget:null,progressCallback:null,progressEndCallback:null,resetBeforeSubmit:!1,keepModalOpen:!1,resetAfterSubmit:C,resetTimeout:1e3,resetAfterError:T,downloadTarget:null,getDownloadTarget:w,initDownloadTarget:F,resetDownloadTarget:k},i=h.extend({},o);return h.extendPrefix(i,"amsForm",function(e){return MyAMS.core.getFunctionByName(e)||e},t,a),h.extendOnly(i,function(e){return MyAMS.core.getFunctionByName(e)||e},n),i},submit:function(i,s,e){var c=2<arguments.length&&void 0!==e?e:{};if(!(i=h(i)).exists())return!1;"object"===t(s)&&(c=s,s=void 0);var u=i.data(),l=h(u.amsSubmitButton),m=l.data()||{},f=MyAMS.form.getSettings(i,u,l,m,c);return u.submitted?f.submitWarning(i,f):f.checkValidators(i,f).then(function(e){"success"===e&&MyAMS.require("ajax","i18n").then(function(){MyAMS.ajax.check(h.fn.ajaxSubmit,"".concat(MyAMS.env.baseURL,"../ext/jquery-form").concat(MyAMS.env.extext,".js")).then(function(){f.clearAlerts(i,f),f.initSubmitButton(i,f,l);var e=f.getData(i,f,u,l,m,c),t={veto:!1};if(f.initData(i,f,l,e,c,t),t.veto)f.resetSubmitButton(i,f,l);else{var r=f.getTarget(i,f,u,m);r&&r.exists()&&f.initTarget(i,f,r);var a=f.getAction(i,f,s),n=f.getAjaxSettings(i,f,l,e,a,r),o=f.getDownloadTarget(i,f);o&&f.initDownloadTarget(i,f,o,n),n.progress=f.getProgressSettings(i,f,l,e),f.submit(i,f,l,e,n,r),o&&f.resetDownloadTarget(i,f,l,o,n)}})})}),!1}};function s(r){return new Promise(function(e,t){r.data("ams-form-hide-submitted")?e():MyAMS.require("i18n","alert").then(function(){MyAMS.alert.messageBox({status:"warning",title:MyAMS.i18n.WAIT,message:MyAMS.i18n.FORM_SUBMITTED,icon:"fa-save",timeout:r.data("ams-form-alert-timeout")||5e3})}).then(e,t)})}function c(e){var n=new Map,t=(e.data("ams-form-validator")||"").trim().split(/[\s,;]+/),o=[];return h(t).each(function(e,t){t&&o.push(t)}),0<o.length&&n.set(e,o),h("[data-ams-form-validator]",e).each(function(e,t){var r=h(t),a=(r.data("ams-form-validator")||"").trim().split(/[\s,;]+/);o=[],h(a).each(function(e,t){t&&o.push(t)}),0<o.length&&n.set(r,o)}),n}function u(p,S){return new Promise(function(c,e){var t=S.getValidators(p,S);if(t.size){var r=[],a=!0,n=!1,o=void 0;try{for(var i,s=t.entries()[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var u=b(i.value,2),l=u[0],m=u[1],f=!0,d=!1,g=void 0;try{for(var y,M=m[Symbol.iterator]();!(f=(y=M.next()).done);f=!0){var v=y.value;r.push(MyAMS.core.executeFunctionByName(v,document,p,l))}}catch(e){d=!0,g=e}finally{try{f||null==M.return||M.return()}finally{if(d)throw g}}}}catch(e){n=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(n)throw o}}h.when.apply(h,r).then(function(){for(var t="success",r=[],e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];for(var o=0,i=a;o<i.length;o++){var s=i[o];!0!==s&&(t="error","string"==typeof s?r.push(s):h.isArray(s)&&0<s.length&&(r=r.concat(s)))}0<r.length?MyAMS.require("i18n","alert").then(function(){var e=1===r.length?MyAMS.i18n.ERROR_OCCURED:MyAMS.i18n.ERRORS_OCCURED;MyAMS.alert.alert({parent:p,status:"danger",header:e,message:r}),c(t)}):c(t)},function(){e("error")})}else c("success")})}function l(e,t,r){var a=r.data("ams-loading-text")||r.text().trim();a?(r.data("original-text",r.text()).prop("disabled",!0).text("".concat(a,"...")),h("<div>").addClass("progress").appendTo(r)):r.data("original-html",r.html()).prop("disabled",!0).html('<i class="fa fa-cog fa-spin"></i>')}function m(e,t,r){h(".progress",r).remove();var a=r.data("original-text");if(a)r.text(a);else{var n=r.data("original-html");n&&r.html(n)}r.prop("disabled",!1)}function f(e,t,r,a,n,o){var i=h.extend({},r.amsFormData,n.amsFormData,o.data),s=a.attr("name");return s&&(i[s]=a.val()),i}function d(e,t,r,a,n,o){var i=t.initDataCallback;i&&h.extend(a,i(e,t,r,a,n,o)),e.trigger("init-data.ams.form",[a,o])}function g(e,t){return h(t.submitTarget)}e.form=n;var o=h.templates({markup:'\n\t<div class="row m-3">\n\t\t<div class="text-center w-100">\n\t\t\t<i class="fa fa-3x fa-cog fa-spin"></i>\n\t\t\t{{if message}}\n\t\t\t<strong>{{:message}}</strong>\n\t\t\t{{/if}}\n\t\t</div>\n\t</div>'});function y(e,t,r){r.html(o.render({message:t.submitMessage})),r.parents(".hidden").removeClass("hidden")}function M(e,t,r){var a=r||t.submitHandler;return a.startsWith(window.location.protocol)?a:MyAMS.ajax.getAddr()+a}function v(t,i,s,e,r,c){var a={url:r,type:"post",cache:!1,data:e,dataType:i.datatype,beforeSerialize:function(e){var t={veto:!1};if(e.trigger("before-serialize.ams.form",[t]),t.veto)return!1;void 0!==window.tinyMCE&&tinyMCE.triggerSave()},beforeSubmit:function(e,t){var r={veto:!1};if(t.trigger("before-submit.ams.form",[e,r]),r.veto)return!1;t.data("submitted",!0),i.resetBeforeSubmit&&setTimeout(function(){i.resetSubmitButton(t,i,s)},250)},uploadProgress:function(e,t,r,a){h(".progress",s).css("background-image","linear-gradient(to right, white -45%, green ".concat(a,"%, red ").concat(a,"%, red)"))},complete:function(e){t.trigger("complete.ams.form",[e])},success:function(e,t,r,a){var n={veto:!1};if(a.trigger("submit-success.ams.form",[e,t,r,n]),!n.veto){var o=a.closest(".modal-dialog");o.exists()&&!i.keepModalOpen&&MyAMS.modal&&MyAMS.modal.close(o);try{i.submitCallback(a,i,c,e,t,r)}finally{i.resetAfterSubmit(a,i,s),MyAMS.form.resetChanged(a)}}},error:function(e,t,r,a){a.trigger("submit-error.ams.form",[e,t,r,c]),c&&i.resetAfterError(a,i,s,c),i.resetAfterSubmit(a,i,s)},iframe:!1};return h.extend({},a,i.submitOptions)}function p(e,t,r,a){var n=t.progressHandler;if(n){var o=t.progressFieldName;a[o]=MyAMS.core.generateUUID();var i=r;return t.progressTarget&&(i=h(t.progressTarget)),{handler:n,interval:t.progressInterval,fieldname:o,target:i,callback:t.progressCallback,endCallback:t.progressEndCallback}}}function S(e,t,r,n,o){var i=setTimeout(function a(){var e={};e[n.fieldname]=r[n.fieldname];MyAMS.ajax.post(n.handler,e).then(MyAMS.core.getFunctionByName(n.callback||function(e,t){if(h.isArray(e)&&(t=e[1],e=e[0]),"success"===t)if("running"===e.status){if(e.message)o.text(e.message);else{var r=e.progress||o.data("ams-progress-text")||MyAMS.i18n.PROGRESS;e.current?r+=": ".concat(e.current," / ").concat(e.length||100):r+="...",o.text(r)}i=setTimeout(a,n.interval)}else"finished"===e.status&&s();else s()}),s)},n.interval);function s(){clearTimeout(i),t.resetSubmitButton(e,t,o),MyAMS.core.executeFunctionByName(n.endCallback,document,e,t,o),MyAMS.form.resetChanged(e)}}function A(e,t,r,a,n,o){n.progress&&t.getProgressState(e,t,a,n.progress,o),e.ajaxSubmit(n)}function x(e,t,r,a,n,o){var i=t.datatype;if(!i){var s=MyAMS.ajax.getResponse(o);s&&(i=s.contentType,a=s.data)}switch(i){case"json":MyAMS.ajax.handleJSON(a,e,r);break;case"script":case"xml":break;default:MyAMS.form.resetChanged(e),r.css({opacity:"0.0"}),r.removeClass("hidden").parents(".hidden").removeClass(".hidden"),r.html(a).delay(50).animate({opacity:"1.0"},250),MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,r).then(function(){MyAMS.require("ajax").then(function(){MyAMS.ajax.check(h.fn.scrollTo,"".concat(MyAMS.env.baseURL,"../ext/jquery-scrollto").concat(MyAMS.env.extext,".js")).then(function(){h("#main").scrollTo(r,{offset:-15})})})})}var c=o.getResponseHeader("X-AMS-Callback");if(c){var u=o.getResponseHeader("X-AMS-Callback-Options")||"{}";MyAMS.core.executeFunctionByName(c,document,e,t,u,a,n,o)}e.trigger("after-submit.ams.form",[a])}function C(e,t,r){e.data("submitted")&&(t.resetSubmitButton(e,t,r),e.data("submitted",!1),e.removeData("ams-submit-button"),e.trigger("after-reset.ams.form"))}function T(e,t,r){h("i",r).removeClass("fa-spin").removeClass("fa-cog").addClass("fa-ambulance")}function w(e,t){return t.downloadTarget}function F(e,t,r,a){var n=h('iframe[name="'.concat(r,'"]'));n.exists()||(n=h("<iframe>").attr("name",r).hide().appendTo(MyAMS.dom.root)),h.extend(a,{iframe:!0,iframeTarget:n})}function k(e,t,r,a,n){var o=e.closest(".modal-dialog"),i=t.keepModalOpen;o.exists()&&!0!==i&&MyAMS.require("modal").then(function(){MyAMS.modal.close(o)}),n.progress||setTimeout(function(){t.resetAfterSubmit(e,t,r),MyAMS.form.resetChanged(e)},t.resetTimeout)}window.MyAMS&&(MyAMS.env.bundle?MyAMS.config.modules.push("form"):(MyAMS.form=n,console.debug("MyAMS: form module loaded...")))});
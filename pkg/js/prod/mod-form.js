!function(e,t){if("function"==typeof define&&define.amd)define(["exports","jsrender"],t);else if("undefined"!=typeof exports)t(exports,require("jsrender"));else{var a={};t(a,e.jsrender),e.modForm=a}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e,t){"use strict";function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.form=void 0;var h=MyAMS.$,r=!1,n={init:function(){r||(r=!0,h(document).on("click",'[type="submit"], .submit',function(e){var t=h(e.currentTarget);t.exists()&&h(t).closest("form").data("ams-submit-button",t)}),h(window).on("beforeunload",MyAMS.form.checkBeforeUnload))},initElement:function(e){h(e).on("click",'button[type="submit"], button.submit',function(e){var t=h(e.currentTarget);h(t.get(0).form).data("ams-submit-button",t)}),h(e).on("keydown","textarea",function(e){10!==e.keyCode&&13!==e.keyCode||!e.ctrlKey&&!e.metaKey||h(e.currentTarget).closest("form").submit()}),h(e).on("focus",'input[readonly="readonly"]',function(e){h(e.currentTarget).blur()}),h(e).on("focusin",function(e){0<=h(e.target).closest(".mce-window").length&&e.stopImmediatePropagation()}),(MyAMS.config.warnOnFormChange?h('form[data-ams-warn-on-change!="false"]',e):h('form[data-ams-warn-on-change="true"]',e)).each(function(e,t){var o=h(t),i=o.data().amsChangedCallback||MyAMS.config.formChangeCallback;h("input, select, textarea, [data-ams-changed-event]",o).each(function(e,t){var a=h(t),r=a.data();if(!0!==r.amsIgnoreChange){var n=r.amsChangedEvent||"change";a.on(n,function(){MyAMS.form.setChanged(o),MyAMS.core.executeFunctionByName(r.amsChangedCallback||i,o,a)})}}),o.on("reset",function(e){var t=h(e.currentTarget);MyAMS.form.clearAlerts(t),MyAMS.form.resetChanged(t)})}),MyAMS.form.setFocus(e)},setFocus:function(e){var t=h("[data-ams-focus-target]",e).first();t.exists()||(t=h("input, select, textarea",e).first()),t.exists()&&t.focus()},checkBeforeUnload:function(){if(MyAMS.i18n&&h('form[data-ams-form-changed="true"]').exists())return MyAMS.i18n.FORM_CHANGED_WARNING},confirmChangedForm:function(r){return new Promise(function(t,e){var a=h('form[data-ams-form-changed="true"]',r);a.exists()?MyAMS.require("alert").then(function(){MyAMS.alert.bigBox({status:"danger",title:MyAMS.i18n.WARNING,icon:"text-danger fa-bell",message:MyAMS.i18n.FORM_CHANGED_WARNING}).then(function(e){"success"===e&&n.resetChanged(a),t(e)})},function(){e("Missing 'alert' module!")}):(n.resetChanged(a),t("success"))})},setChanged:function(e){e.attr("data-ams-form-changed",!0)},resetChanged:function(e){void 0!==e&&h(e).removeAttr("data-ams-form-changed")},setInvalid:function(e,t,a){if("string"==typeof t&&(t=h('[name="'.concat(t,'"]'),e)),t.exists()){var r=t.closest(".form-widget");h(".invalid-feedback",r).remove(),h("<span>").text(a).addClass("is-invalid invalid-feedback").appendTo(r),t.removeClass("valid").addClass("is-invalid")}},clearAlerts:function(e){h(".alert-danger, SPAN.state-error",e).not(".persistent").remove(),h(".state-error",e).removeClassPrefix("state-"),h(".invalid-feedback",e).remove(),h(".is-invalid",e).removeClass("is-invalid")},submit:function(i,s,e){var u=2<arguments.length&&void 0!==e?e:{};if(!(i=h(i)).exists())return!1;"object"===a(s)&&(u=s,s=void 0);var c=i.data(),l=h(c.amsSubmitButton),m=l.data()||{},t={submitWarning:o,getValidators:d,checkValidators:g,clearAlerts:MyAMS.form.clearAlerts,initSubmitButton:y,resetSubmitButton:M,getData:v,initData:b,initDataCallback:null,getTarget:p,initTarget:A,getAction:x,getAjaxSettings:C,getProgressSettings:w,getProgressState:T,submit:k,datatype:null,submitOptions:null,submitHandler:i.attr("action").replace(/#/,""),submitTarget:i.attr("target"),submitMessage:null,submitCallback:B,progressHandler:null,progressFieldName:"progressId",progressInterval:1e3,progressCallback:null,progressEndCallback:null,resetBeforeSubmit:!1,keepModalOpen:!1,resetAfterSubmit:j,resetTimeout:1e3,resetAfterError:D,downloadTarget:null,getDownloadTarget:F,initDownloadTarget:O,resetDownloadTarget:R},f=h.extend({},t);return h.extendPrefix(f,"amsForm",function(e){return MyAMS.core.getFunctionByName(e)||e},c,m),h.extendOnly(f,u),c.submitted?f.submitWarning(i,f):f.checkValidators(i,f).then(function(e){"success"===e&&MyAMS.require("ajax","i18n").then(function(){MyAMS.ajax.check(h.fn.ajaxSubmit,"".concat(MyAMS.env.baseURL,"../ext/jquery-form").concat(MyAMS.env.extext,".js")).then(function(){f.clearAlerts(i,f),f.initSubmitButton(i,f,l);var e=f.getData(i,f,c,l,m,u),t={veto:!1};if(f.initData(i,f,l,e,u,t),t.veto)f.resetSubmitButton(i,f,l);else{var a=f.getTarget(i,f,c,m);a&&a.exists()&&f.initTarget(i,f,a);var r=f.getAction(i,f,s),n=f.getAjaxSettings(i,f,l,e,r,a),o=f.getDownloadTarget(i,f);o&&f.initDownloadTarget(i,f,o,n),n.progress=f.getProgressSettings(i,f,e),f.submit(i,f,l,e,n),o&&f.resetDownloadTarget(i,f,o,n)}})})}),!1}};function o(e,t){e.data("ams-form-hide-submitted")||MyAMS.require("i18n","alert").then(function(){MyAMS.alert.messageBox({status:"warning",title:MyAMS.i18n.WAIT,message:MyAMS.i18n.FORM_SUBMITTED,icon:"fa-save",timeout:e.data("ams-form-alert-timeout")||5e3})})}function d(e,t){var n=new Map,a=(e.data("ams-form-validator")||"").trim().split(/[\s,;]+/),o=[];return h(a).each(function(e,t){t&&o.push(t)}),0<o.length&&n.set(e,o),h("[data-ams-form-validator]",e).each(function(e,t){var a=h(t),r=(a.data("ams-form-validator")||"").trim().split(/[\s,;]+/);o=[],h(r).each(function(e,t){t&&o.push(t)}),0<o.length&&n.set(a,o)}),n}function g(b,p){return new Promise(function(u,e){var t=p.getValidators(b,p);if(t.size){var a=[],r=!0,n=!1,o=void 0;try{for(var i,s=t.entries()[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=S(i.value,2),l=c[0],m=c[1],f=!0,d=!1,g=void 0;try{for(var y,M=m[Symbol.iterator]();!(f=(y=M.next()).done);f=!0){var v=y.value;a.push(MyAMS.core.executeFunctionByName(v,document,b,l))}}catch(e){d=!0,g=e}finally{try{f||null==M.return||M.return()}finally{if(d)throw g}}}}catch(e){n=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}h.when.apply(h,a).then(function(){for(var e="success",t=[],a=arguments.length,r=new Array(a),n=0;n<a;n++)r[n]=arguments[n];for(var o=0,i=r;o<i.length;o++){var s=i[o];!0!==s&&(e="error","string"==typeof s?t.push(s):h.isArray(s)&&0<s.length&&(t=t.concat(s)))}0<t.length&&MyAMS.require("i18n","alert").then(function(){var e=1===t.length?MyAMS.i18n.ERROR_OCCURED:MyAMS.i18n.ERRORS_OCCURED;MyAMS.alert.alert({parent:b,status:"danger",header:e,message:t})}),u(e)},function(){e("error")})}else u("success")})}function y(e,t,a){var r=a.data("ams-loading-text")||a.text().trim();r?(a.data("original-text",a.text()).prop("disabled",!0).text("".concat(r,"...")),h("<div>").addClass("progress").appendTo(a)):a.data("original-html",a.html()).prop("disabled",!0).html('<i class="fa fa-cog fa-spin"></i>')}function M(e,t,a){h(".progress",a).remove();var r=a.data("original-text");if(r)a.text(r);else{var n=a.data("original-html");n&&a.html(n)}a.prop("disabled",!1)}function v(e,t,a,r,n,o){var i=h.extend({},a.amsFormData,n.amsFormData,o.data),s=r.attr("name");return s&&(i[s]=r.val()),i}function b(e,t,a,r,n,o){var i=t.initDataCallback;i&&h.extend(r,i(e,t,a,r,n,o)),e.trigger("init-data.myams.form",[r,o])}function p(e,t,a,r){return h(t.submitTarget)}e.form=n;var i=h.templates({markup:'\n\t<div class="row m-3">\n\t\t<div class="text-center w-100">\n\t\t\t<i class="fa fa-3x fa-cog fa-spin"></i>\n\t\t\t{{if message}}\n\t\t\t<strong>{{:message}}</strong>\n\t\t\t{{/if}}\n\t\t</div>\n\t</div>'});function A(e,t,a){a.html(i.render({message:t.submitMessage})),a.parents(".hidden").removeClass("hidden")}function x(e,t,a){var r=a||t.submitHandler;return r.startsWith(window.location.protocol)?r:MyAMS.ajax.getAddr()+r}function C(t,i,s,e,a,u){var r={url:a,type:"post",cache:!1,data:e,dataType:i.datatype,beforeSerialize:function(){var e={veto:!1};if(t.trigger("before-serialize.myams.form",[e]),e.veto)return!1;void 0!==window.tinyMCE&&tinyMCE.triggerSave()},beforeSubmit:function(e,t){var a={veto:!1};if(t.trigger("before-submit.myams.form",[e,a]),a.veto)return!1;t.data("submitted",!0),i.resetBeforeSubmit&&setTimeout(function(){i.resetSubmitButton(t,i,s)},250)},uploadProgress:function(e,t,a,r){h(".progress",s).css("background-image","linear-gradient(to right, white -45%, green ".concat(r,"%, red ").concat(r,"%, red)"))},complete:function(e){t.trigger("complete.myams.form",[e])},success:function(e,t,a,r){var n={veto:!1};if(r.trigger("submit-success.myams.form",[e,t,a,n]),!n.veto){var o=r.closest(".modal-dialog");o.exists()&&!i.keepModalOpen&&MyAMS.modal&&MyAMS.modal.close(o);try{i.submitCallback(r,i,u,e,t,a)}finally{i.resetAfterSubmit(r,i,s),MyAMS.form.resetChanged(r)}}},error:function(e,t,a,r){r.trigger("submit-error.myams.form",[e,t,a,u]),u&&i.resetAfterError(r,i,s,u),i.resetAfterSubmit(r,i,s)},iframe:!1};return h.extend({},r,i.submitOptions)}function w(e,t,a){var r=t.progressHandler;if(r){var n=t.progressFieldName;return a[n]=MyAMS.core.generateUUID(),{handler:r,interval:t.progressInterval,fieldname:n,callback:t.progressCallback,endCallback:t.progressEndCallback}}}function T(e,t,a,n){var o=setTimeout(function r(){var e={};e[n.fieldname]=a[n.fieldname];MyAMS.ajax.post(n.handler,e).then(MyAMS.core.getFunctionByName(n.callback||function(e,t){if("success"===t)if("running"===e.status){if(e.message)target.text(e.message);else{var a=e.progress||target.data("ams-progress-text")||MyAMS.i18n.PROGRESS;e.current?a+=": ".concat(e.current," / ").concat(e.length||100):a+="...",target.text(a)}o=setTimeout(r,n.interval)}else"finished"===e.status&&i();else i()}),i)},n.interval);function i(){clearTimeout(o),t.resetSubmitButton(e,t,target),MyAMS.core.executeFunctionByName(n.endCallback,document,e,t,target),MyAMS.form.resetChanged(e)}}function k(e,t,a,r,n){n.progress&&t.getProgressState(e,t,r,n.progress),e.ajaxSubmit(n)}function B(e,t,a,r,n,o){var i=t.datatype;if(!i){var s=MyAMS.ajax.getResponse(o);s&&(i=s.contentType,r=s.data)}switch(i){case"json":MyAMS.ajax.handleJSON(r,e,a);break;case"script":case"xml":break;default:MyAMS.form.resetChanged(e),a.css({opacity:"0.0"}),a.removeClass("hidden").parents(".hidden").removeClass(".hidden"),a.html(r).delay(50).animate({opacity:"1.0"},250),MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,a)}var u=o.getResponseHeader("X-AMS-Callback");if(u){var c=o.getResponseHeader("X-AMS-Callback-Options")||"{}";MyAMS.core.executeFunctionByName(u,document,e,t,c,r,n,o)}e.trigger("after-submit.myams.form",[r])}function j(e,t,a){e.data("submitted")&&(t.resetSubmitButton(e,t,a),e.data("submitted",!1),e.removeData("ams-submit-button"),e.trigger("after-reset.myams.form"))}function D(e,t,a){h("i",a).removeClass("fa-spin").removeClass("fa-cog").addClass("fa-ambulance")}function F(e,t){return t.downloadTarget}function O(e,t,a,r){var n=h('iframe[name="'.concat(a,'"]'));n.exists()||(n=h("<iframe>").attr("name",a).hide().appendTo(MyAMS.core.root)),h.extend(r,{iframe:!0,iframeTarget:n})}function R(e,t,a,r){var n=e.closest(".modal-dialog"),o=t.keepModalOpen;n.exists()&&!0!==o&&MyAMS.require("modal").then(function(){MyAMS.modal.close(n)}),r.progress||setTimeout(function(){t.resetAfterSubmit(e,t,button),MyAMS.form.resetChanged(e)},t.resetTimeout)}window.MyAMS&&(MyAMS.env.bundle?MyAMS.config.modules.push("form"):(MyAMS.form=n,console.debug("MyAMS: form module loaded...")))});
!function(e,t){var r;"function"==typeof define&&define.amd?define(["exports"],t):"undefined"!=typeof exports?t(exports):(t(r={}),e.modForm=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e){"use strict";function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}return r}(e,t)||c(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=c(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw o}}}}function c(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.showFormSubmitWarning=s,e.getFormValidators=u,e.checkFormValidators=l,e.initFormSubmitButton=m,e.resetFormSubmitButton=f,e.getFormData=M,e.initFormData=p,e.getFormTarget=b,e.initFormTarget=v,e.getFormAction=S,e.getFormAjaxSettings=h,e.getFormProgressSettings=A,e.getFormProgressState=x,e.submitForm=C,e.formSubmitCallback=T,e.resetFormAfterSubmit=w,e.resetFormAfterError=k,e.getFormDownloadTarget=F,e.initFormDownloadTarget=D,e.resetFormDownloadTarget=R,e.form=void 0;var r,y=MyAMS.$;y.templates||(r=require("jsrender"),y.templates=r.templates);var a=!1,o={init:function(){a||(a=!0,y(document).on("click",'[type="submit"], .submit',function(e){var t=y(e.currentTarget);t.exists()&&y(t).closest("form").data("ams-submit-button",t)}),y(document).on("click",'input[type="checkbox"][readonly]',function(){return!1}),y(document).on("reset",MyAMS.form.resetHandler),y(document).on("reset","[data-ams-reset-handler]",MyAMS.form.customResetHandler),y(window).on("beforeunload",MyAMS.form.checkBeforeUnload))},initElement:function(e){"string"==typeof e&&(e=y(e)),e.on("keydown","textarea",function(e){10!==e.keyCode&&13!==e.keyCode||!e.ctrlKey&&!e.metaKey||y(e.currentTarget).closest("form").submit()}),e.on("focus","input[readonly]",function(e){y(e.currentTarget).blur()}),e.on("focusin",function(e){0<=y(e.target).closest(".mce-window").length&&e.stopImmediatePropagation()}),(MyAMS.config.warnOnFormChange?y('form[data-ams-warn-on-change!="false"]',e):y('form[data-ams-warn-on-change="true"]',e)).each(function(e,t){var o=y(t),i=o.data().amsChangedCallback||MyAMS.config.formChangeCallback;y("input, select, textarea, [data-ams-changed-event]",o).each(function(e,t){var r,n=y(t),a=n.data();!0!==a.amsIgnoreChange&&(r=a.amsChangedEvent||"change",n.on(r,function(){MyAMS.form.setChanged(o),MyAMS.core.executeFunctionByName(a.amsChangedCallback||i,document,o,n)}))})}),MyAMS.form.setFocus(e)},setFocus:function(e){var t=y("[data-ams-focus-target]",e).first();t.exists()||(t=y("input, select, textarea",e).first()),t.exists()&&t.focus()},checkBeforeUnload:function(){if(MyAMS.i18n&&y('form[data-ams-form-changed="true"]').exists())return MyAMS.i18n.FORM_CHANGED_WARNING},confirmChangedForm:function(n){return new Promise(function(t,e){var r=y('form[data-ams-form-changed="true"]',n);r.exists()?MyAMS.require("alert").then(function(){MyAMS.alert.bigBox({status:"danger",title:MyAMS.i18n.WARNING,icon:"text-danger fa-bell",message:MyAMS.i18n.FORM_CHANGED_WARNING}).then(function(e){"success"===e&&MyAMS.form.resetChanged(r),t(e)})},function(){e("Missing 'alert' module!")}):(o.resetChanged(r),t("success"))})},setChanged:function(e){e.attr("data-ams-form-changed",!0)},resetHandler:function(e){var t=y(e.target);MyAMS.form.clearAlerts(t),MyAMS.form.handleDefaultReset(t)},clearAlerts:function(e){y(".alert-danger, SPAN.state-error",e).not(".persistent").remove(),y(".state-error",e).removeClassPrefix("state-"),y(".invalid-feedback",e).remove(),y(".is-invalid",e).removeClass("is-invalid")},handleDefaultReset:function(o){setTimeout(function(){o.find(".select2").trigger("change"),y("[data-ams-reset-callback]",o).each(function(e,t){var r=y(t),n=r.data(),a=MyAMS.core.getFunctionByName(n.amsResetCallback);void 0!==a&&a.call(document,o,r,n.amsResetCallbackOptions)}),MyAMS.form.resetChanged(o)},10)},resetChanged:function(e){void 0!==e&&y(e).removeAttr("data-ams-form-changed")},customResetHandler:function(e){var t,r=y(e.target),n=r.data();n.amsResetHandler&&(!0!==n.amsKeepDefault&&!0!==n.amsResetKeepDefault&&e.preventDefault(),void 0!==(t=MyAMS.core.getFunctionByName(n.amsResetHandler))&&t.call(document,e,r,n.amsResetHandlerOptions))},setInvalid:function(e,t,r){var n;"string"==typeof t&&(t=y('[name="'.concat(t,'"]'),e)),t.exists()&&(n=t.closest(".form-widget"),y(".invalid-feedback",n).remove(),y("<span>").text(r).addClass("is-invalid invalid-feedback").appendTo(n),t.removeClass("valid").addClass("is-invalid"))},getSettings:function(e,t,r,n,a){var o={submitWarning:s,getValidators:u,checkValidators:l,clearAlerts:MyAMS.form.clearAlerts,initSubmitButton:m,resetSubmitButton:f,getData:M,initData:p,initDataCallback:null,getTarget:b,initTarget:v,getAction:S,getAjaxSettings:h,getProgressSettings:A,getProgressState:x,submit:C,datatype:null,submitOptions:null,submitHandler:(e.attr("action")||"").replace(/#/,""),submitTarget:e.attr("target")||null,submitMessage:null,submitCallback:T,progressHandler:null,progressFieldName:"progressId",progressInterval:1e3,progressTarget:null,progressCallback:null,progressEndCallback:null,resetBeforeSubmit:!1,keepModalOpen:!1,resetAfterSubmit:w,resetTimeout:1e3,resetAfterError:k,downloadTarget:null,getDownloadTarget:F,initDownloadTarget:D,resetDownloadTarget:R},i=y.extend({},o);return y.extendPrefix(i,"amsForm",function(e){return MyAMS.core.getFunctionByName(e)||e},t,n),y.extendOnly(i,function(e){return MyAMS.core.getFunctionByName(e)||e},a),i},submit:function(i,s,e){var c=2<arguments.length&&void 0!==e?e:{};if(!(i=y(i)).exists())return!1;"object"===t(s)&&(c=s,s=void 0);var u=i.data(),l=y(u.amsSubmitButton),m=l.data()||{},f=MyAMS.form.getSettings(i,u,l,m,c);return u.submitted?f.submitWarning(i,f):f.checkValidators(i,f).then(function(e){"success"===e&&MyAMS.require("ajax","i18n").then(function(){MyAMS.ajax.check(y.fn.ajaxSubmit,"".concat(MyAMS.env.baseURL,"../ext/jquery-form").concat(MyAMS.env.extext,".js")).then(function(){f.clearAlerts(i,f),f.initSubmitButton(i,f,l);var e,t,r,n,a=f.getData(i,f,u,l,m,c),o={veto:!1};f.initData(i,f,l,a,c,o),o.veto?f.resetSubmitButton(i,f,l):((e=f.getTarget(i,f,u,m))&&e.exists()&&f.initTarget(i,f,e),t=f.getAction(i,f,s),r=f.getAjaxSettings(i,f,l,a,t,e),(n=f.getDownloadTarget(i,f))&&f.initDownloadTarget(i,f,n,r),r.progress=f.getProgressSettings(i,f,l,a),f.submit(i,f,l,a,r,e),n&&f.resetDownloadTarget(i,f,l,n,r))})})}),!1}};function s(r){return new Promise(function(e,t){r.data("ams-form-hide-submitted")?e():MyAMS.require("i18n","alert").then(function(){MyAMS.alert.messageBox({status:"warning",title:MyAMS.i18n.WAIT,message:MyAMS.i18n.FORM_SUBMITTED,icon:"fa-save",timeout:r.data("ams-form-alert-timeout")||5e3})}).then(e,t)})}function u(e){var a=new Map,t=(e.data("ams-form-validator")||"").trim().split(/[\s,;]+/),o=[];return y(t).each(function(e,t){t&&o.push(t)}),0<o.length&&a.set(e,o),y("[data-ams-form-validator]",e).each(function(e,t){var r=y(t),n=(r.data("ams-form-validator")||"").trim().split(/[\s,;]+/);o=[],y(n).each(function(e,t){t&&o.push(t)}),0<o.length&&a.set(r,o)}),a}function l(m,f){return new Promise(function(c,e){var t=f.getValidators(m,f);if(t.size){var r,n=[],a=g(t.entries());try{for(a.s();!(r=a.n()).done;){var o,i=d(r.value,2),s=i[0],u=g(i[1]);try{for(u.s();!(o=u.n()).done;){var l=o.value;n.push(MyAMS.core.executeFunctionByName(l,document,m,s))}}catch(e){u.e(e)}finally{u.f()}}}catch(e){a.e(e)}finally{a.f()}y.when.apply(y,n).then(function(){for(var t="success",r=[],e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];for(var o=0,i=n;o<i.length;o++){var s=i[o];!0!==s&&(t="error","string"==typeof s?r.push(s):y.isArray(s)&&0<s.length&&(r=r.concat(s)))}0<r.length?MyAMS.require("i18n","alert").then(function(){var e=1===r.length?MyAMS.i18n.ERROR_OCCURED:MyAMS.i18n.ERRORS_OCCURED;MyAMS.alert.alert({parent:m,status:"danger",header:e,message:r}),c(t)}):c(t)},function(){e("error")})}else c("success")})}function m(e,t,r){var n=r.data("ams-loading-text")||r.text().trim();n?(r.data("original-text",r.text()).prop("disabled",!0).text("".concat(n,"...")),y("<div>").addClass("progress").appendTo(r)):r.data("original-html",r.html()).prop("disabled",!0).html('<i class="fa fa-cog fa-spin"></i>')}function f(e,t,r){y(".progress",r).remove();var n,a=r.data("original-text");a?r.text(a):(n=r.data("original-html"))&&r.html(n),r.prop("disabled",!1)}function M(e,t,r,n,a,o){var i=y.extend({},r.amsFormData,a.amsFormData,o.data),s=n.attr("name");return s&&(i[s]=n.val()),i}function p(e,t,r,n,a,o){var i=t.initDataCallback;i&&y.extend(n,i(e,t,r,n,a,o)),e.trigger("init-data.ams.form",[n,o])}function b(e,t){return y(t.submitTarget)}e.form=o;var i=y.templates({markup:'\n\t<div class="row m-3">\n\t\t<div class="text-center w-100">\n\t\t\t<i class="fa fa-3x fa-cog fa-spin"></i>\n\t\t\t{{if message}}\n\t\t\t<strong>{{:message}}</strong>\n\t\t\t{{/if}}\n\t\t</div>\n\t</div>'});function v(e,t,r){r.html(i.render({message:t.submitMessage})),r.parents(".hidden").removeClass("hidden")}function S(e,t,r){var n=r||t.submitHandler,a=n.startsWith(window.location.protocol)?n:MyAMS.ajax.getAddr()+n;return a}function h(t,i,s,e,r,c){var n={url:r,type:"post",cache:!1,data:e,dataType:i.datatype,beforeSerialize:function(e){var t={veto:!1};if(e.trigger("before-serialize.ams.form",[t]),t.veto)return!1;void 0!==window.tinyMCE&&tinyMCE.triggerSave()},beforeSubmit:function(e,t){var r={veto:!1};if(t.trigger("before-submit.ams.form",[e,r]),r.veto)return!1;t.data("submitted",!0),i.resetBeforeSubmit&&setTimeout(function(){i.resetSubmitButton(t,i,s)},250)},uploadProgress:function(e,t,r,n){y(".progress",s).css("background-image","linear-gradient(to right, white -45%, green ".concat(n,"%, red ").concat(n,"%, red)"))},complete:function(e){t.trigger("complete.ams.form",[e])},success:function(e,t,r,n){var a={veto:!1};if(n.trigger("submit-success.ams.form",[e,t,r,a]),!a.veto){var o=n.closest(".modal-dialog");o.exists()&&!i.keepModalOpen&&MyAMS.modal&&MyAMS.modal.close(o);try{i.submitCallback(n,i,c,e,t,r)}finally{i.resetAfterSubmit(n,i,s),MyAMS.form.resetChanged(n)}}},error:function(e,t,r,n){n.trigger("submit-error.ams.form",[e,t,r,c]),c&&i.resetAfterError(n,i,s,c),i.resetAfterSubmit(n,i,s)},iframe:!1};return y.extend({},n,i.submitOptions)}function A(e,t,r,n){var a=t.progressHandler;if(a){var o=t.progressFieldName;n[o]=MyAMS.core.generateUUID();var i=r;return t.progressTarget&&(i=y(t.progressTarget)),{handler:a,interval:t.progressInterval,fieldname:o,target:i,callback:t.progressCallback,endCallback:t.progressEndCallback}}}function x(e,t,r,a,o){var i=setTimeout(function n(){var e={};e[a.fieldname]=r[a.fieldname];MyAMS.ajax.post(a.handler,e).then(MyAMS.core.getFunctionByName(a.callback||function(e,t){var r;y.isArray(e)&&(t=e[1],e=e[0]),"success"===t?"running"===e.status?(e.message?o.text(e.message):(r=e.progress||o.data("ams-progress-text")||MyAMS.i18n.PROGRESS,e.current?r+=": ".concat(e.current," / ").concat(e.length||100):r+="...",o.text(r)),i=setTimeout(n,a.interval)):"finished"===e.status&&s():s()}),s)},a.interval);function s(){clearTimeout(i),t.resetSubmitButton(e,t,o),MyAMS.core.executeFunctionByName(a.endCallback,document,e,t,o),MyAMS.form.resetChanged(e)}}function C(e,t,r,n,a,o){a.progress&&t.getProgressState(e,t,n,a.progress,o),e.ajaxSubmit(a)}function T(e,t,r,n,a,o){var i,s=t.datatype;switch(s||(i=MyAMS.ajax.getResponse(o))&&(s=i.contentType,n=i.data),s){case"binary":case"script":case"xml":break;case"json":MyAMS.ajax.handleJSON(n,e,r);break;default:MyAMS.form.resetChanged(e),r.css({opacity:"0.0"}),r.removeClass("hidden").parents(".hidden").removeClass(".hidden"),r.html(n).delay(50).animate({opacity:"1.0"},250),MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,r).then(function(){MyAMS.require("ajax").then(function(){MyAMS.ajax.check(y.fn.scrollTo,"".concat(MyAMS.env.baseURL,"../ext/jquery-scrollto").concat(MyAMS.env.extext,".js")).then(function(){y("#main").scrollTo(r,{offset:-15})})})})}var c,u=o.getResponseHeader("X-AMS-Callback");u&&(c=o.getResponseHeader("X-AMS-Callback-Options")||"{}",MyAMS.core.executeFunctionByName(u,document,e,t,c,n,a,o)),e.trigger("after-submit.ams.form",[n])}function w(e,t,r){e.data("submitted")&&(t.resetSubmitButton(e,t,r),e.data("submitted",!1),e.removeData("ams-submit-button"),e.trigger("after-reset.ams.form"))}function k(e,t,r){y("i",r).removeClass("fa-spin").removeClass("fa-cog").addClass("fa-ambulance")}function F(e,t){return t.downloadTarget}function D(e,t,r,n){var a=y('iframe[name="'.concat(r,'"]'));a.exists()||(a=y("<iframe>").attr("name",r).hide().appendTo(MyAMS.dom.root)),y.extend(n,{iframe:!0,iframeTarget:a})}function R(e,t,r,n,a){var o=e.closest(".modal-dialog"),i=t.keepModalOpen;o.exists()&&!0!==i&&MyAMS.require("modal").then(function(){MyAMS.modal.close(o)}),a.progress||setTimeout(function(){t.resetAfterSubmit(e,t,r),MyAMS.ajax&&MyAMS.ajax.stop(),MyAMS.form.resetChanged(e)},t.resetTimeout)}window.MyAMS&&(MyAMS.env.bundle?MyAMS.config.modules.push("form"):(MyAMS.form=o,console.debug("MyAMS: form module loaded...")))});
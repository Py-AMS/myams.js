!function(e,t){"function"==typeof define&&define.amd?define(["exports"],t):"undefined"!=typeof exports?t(exports):(t(t={}),e.modForm=t)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e){"use strict";function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=s(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,t=function(){};return{s:t,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw a}}}}function s(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.showFormSubmitWarning=i,e.getFormValidators=c,e.checkFormValidators=u,e.initFormSubmitButton=l,e.resetFormSubmitButton=g,e.getFormData=y,e.initFormData=M,e.getFormTarget=p,e.initFormTarget=S,e.getFormAction=h,e.getFormAjaxSettings=v,e.getFormProgressSettings=A,e.getFormProgressState=x,e.submitForm=C,e.formSubmitCallback=T,e.resetFormAfterSubmit=w,e.resetFormAfterError=k,e.getFormDownloadTarget=F,e.initFormDownloadTarget=D,e.resetFormDownloadTarget=R,e.form=void 0;var n,d=MyAMS.$;d.templates||(n=require("jsrender"),d.templates=n.templates);var a=!1,o={init:function(){a||(a=!0,d(document).on("click",'[type="submit"], .submit',function(e){e=d(e.currentTarget);e.exists()&&d(e).closest("form").data("ams-submit-button",e)}),d(document).on("click",'input[type="checkbox"][readonly]',function(){return!1}),d(document).on("reset",MyAMS.form.resetHandler),d(document).on("reset","[data-ams-reset-handler]",MyAMS.form.customResetHandler),d(window).on("beforeunload",MyAMS.form.checkBeforeUnload))},initElement:function(e){"string"==typeof e&&(e=d(e)),e.on("keydown","textarea",function(e){10!==e.keyCode&&13!==e.keyCode||!e.ctrlKey&&!e.metaKey||d(e.currentTarget).closest("form").submit()}),e.on("focus","input[readonly]",function(e){d(e.currentTarget).blur()}),e.on("focusin",function(e){0<=d(e.target).closest(".mce-window").length&&e.stopImmediatePropagation()}),(MyAMS.config.warnOnFormChange?d('form[data-ams-warn-on-change!="false"]',e):d('form[data-ams-warn-on-change="true"]',e)).each(function(e,t){var a=d(t),o=a.data().amsChangedCallback||MyAMS.config.formChangeCallback;d("input, select, textarea, [data-ams-changed-event]",a).each(function(e,t){var n=d(t),r=n.data();!0!==r.amsIgnoreChange&&(t=r.amsChangedEvent||"change",n.on(t,function(){MyAMS.form.setChanged(a),MyAMS.core.executeFunctionByName(r.amsChangedCallback||o,document,a,n)}))})}),MyAMS.form.setFocus(e)},setFocus:function(e){var t=d("[data-ams-focus-target]",e).first();t.exists()||(t=d("input, select, textarea",e).first()),t.exists()&&t.focus()},checkBeforeUnload:function(){if(MyAMS.i18n&&d('form[data-ams-form-changed="true"]').exists())return MyAMS.i18n.FORM_CHANGED_WARNING},confirmChangedForm:function(r){return new Promise(function(t,e){var n=d('form[data-ams-form-changed="true"]',r);n.exists()?MyAMS.require("alert").then(function(){MyAMS.alert.bigBox({status:"danger",title:MyAMS.i18n.WARNING,icon:"text-danger fa-bell",message:MyAMS.i18n.FORM_CHANGED_WARNING}).then(function(e){"success"===e&&MyAMS.form.resetChanged(n),t(e)})},function(){e("Missing 'alert' module!")}):(o.resetChanged(n),t("success"))})},setChanged:function(e){e.attr("data-ams-form-changed",!0)},resetHandler:function(e){e=d(e.target);MyAMS.form.clearAlerts(e),MyAMS.form.handleDefaultReset(e)},clearAlerts:function(e){d(".alert-danger, SPAN.state-error",e).not(".persistent").remove(),d(".state-error",e).removeClassPrefix("state-"),d(".invalid-feedback",e).remove(),d(".is-invalid",e).removeClass("is-invalid")},handleDefaultReset:function(a){setTimeout(function(){a.find(".select2").trigger("change"),d("[data-ams-reset-callback]",a).each(function(e,t){var n=d(t),r=n.data(),t=MyAMS.core.getFunctionByName(r.amsResetCallback);void 0!==t&&t.call(document,a,n,r.amsResetCallbackOptions)}),MyAMS.form.resetChanged(a)},10)},resetChanged:function(e){void 0!==e&&d(e).removeAttr("data-ams-form-changed")},customResetHandler:function(e){var t,n=d(e.target),r=n.data();r.amsResetHandler&&(!0!==r.amsKeepDefault&&!0!==r.amsResetKeepDefault&&e.preventDefault(),void 0!==(t=MyAMS.core.getFunctionByName(r.amsResetHandler))&&t.call(document,e,n,r.amsResetHandlerOptions))},setInvalid:function(e,t,n){"string"==typeof t&&(t=d('[name="'.concat(t,'"]'),e)),t.exists()&&(e=t.closest(".form-widget"),d(".invalid-feedback",e).remove(),d("<span>").text(n).addClass("is-invalid invalid-feedback").appendTo(e),t.removeClass("valid").addClass("is-invalid"))},getSettings:function(e,t,n,r,a){e={submitWarning:i,getValidators:c,checkValidators:u,clearAlerts:MyAMS.form.clearAlerts,initSubmitButton:l,resetSubmitButton:g,getData:y,initData:M,initDataCallback:null,getTarget:p,initTarget:S,getAction:h,getAjaxSettings:v,getProgressSettings:A,getProgressState:x,submit:C,datatype:null,submitOptions:null,submitHandler:(e.attr("action")||"").replace(/#/,""),submitTarget:e.attr("target")||null,submitMessage:null,submitCallback:T,progressHandler:null,progressFieldName:"progressId",progressInterval:1e3,progressTarget:null,progressCallback:null,progressEndCallback:null,resetBeforeSubmit:!1,keepModalOpen:!1,resetAfterSubmit:w,resetTimeout:1e3,resetAfterError:k,downloadTarget:null,getDownloadTarget:F,initDownloadTarget:D,resetDownloadTarget:R},e=d.extend({},e);return d.extendPrefix(e,"amsForm",function(e){return MyAMS.core.getFunctionByName(e)||e},t,r),d.extendOnly(e,function(e){return MyAMS.core.getFunctionByName(e)||e},a),e},submit:function(a,o,e){var i=2<arguments.length&&void 0!==e?e:{};if(!(a=d(a)).exists())return!1;"object"===t(o)&&(i=o,o=void 0);var s=a.data(),c=d(s.amsSubmitButton),u=c.data()||{},l=MyAMS.form.getSettings(a,s,c,u,i);return s.submitted?l.submitWarning(a,l):l.checkValidators(a,l).then(function(e){"success"===e&&MyAMS.require("ajax","i18n").then(function(){MyAMS.ajax.check(d.fn.ajaxSubmit,"".concat(MyAMS.env.baseURL,"../ext/jquery-form").concat(MyAMS.env.extext,".js")).then(function(){l.clearAlerts(a,l),l.initSubmitButton(a,l,c);var e,t,n=l.getData(a,l,s,c,u,i),r={veto:!1};l.initData(a,l,c,n,i,r),r.veto?l.resetSubmitButton(a,l,c):((e=l.getTarget(a,l,s,u))&&e.exists()&&l.initTarget(a,l,e),t=l.getAction(a,l,o),r=l.getAjaxSettings(a,l,c,n,t,e),(t=l.getDownloadTarget(a,l))&&l.initDownloadTarget(a,l,t,r),r.progress=l.getProgressSettings(a,l,c,n),l.submit(a,l,c,n,r,e),t&&l.resetDownloadTarget(a,l,c,t,r))})})}),!1}};function i(n){return new Promise(function(e,t){n.data("ams-form-hide-submitted")?e():MyAMS.require("i18n","alert").then(function(){MyAMS.alert.messageBox({status:"warning",title:MyAMS.i18n.WAIT,message:MyAMS.i18n.FORM_SUBMITTED,icon:"fa-save",timeout:n.data("ams-form-alert-timeout")||5e3})}).then(e,t)})}function c(e){var r=new Map,t=(e.data("ams-form-validator")||"").trim().split(/[\s,;]+/),a=[];return d(t).each(function(e,t){t&&a.push(t)}),0<a.length&&r.set(e,a),d("[data-ams-form-validator]",e).each(function(e,t){var n=d(t),t=(n.data("ams-form-validator")||"").trim().split(/[\s,;]+/);a=[],d(t).each(function(e,t){t&&a.push(t)}),0<a.length&&r.set(n,a)}),r}function u(u,l){return new Promise(function(c,e){var t=l.getValidators(u,l);if(t.size){var n=[],r=f(t.entries());try{for(r.s();!(a=r.n()).done;){var a=m(a.value,2),o=a[0],i=f(a[1]);try{for(i.s();!(s=i.n()).done;){var s=s.value;n.push(MyAMS.core.executeFunctionByName(s,document,u,o))}}catch(e){i.e(e)}finally{i.f()}}}catch(e){r.e(e)}finally{r.f()}d.when.apply(d,n).then(function(){for(var t="success",n=[],e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];for(var o=0,i=r;o<i.length;o++){var s=i[o];!0!==s&&(t="error","string"==typeof s?n.push(s):d.isArray(s)&&0<s.length&&(n=n.concat(s)))}0<n.length?MyAMS.require("i18n","alert").then(function(){var e=1===n.length?MyAMS.i18n.ERROR_OCCURED:MyAMS.i18n.ERRORS_OCCURED;MyAMS.alert.alert({parent:u,status:"danger",header:e,message:n}),c(t)}):c(t)},function(){e("error")})}else c("success")})}function l(e,t,n){var r=n.data("ams-loading-text")||n.text().trim();r?(n.data("original-text",n.text()).prop("disabled",!0).text("".concat(r,"...")),d("<div>").addClass("progress").appendTo(n)):n.data("original-html",n.html()).prop("disabled",!0).html('<i class="fa fa-cog fa-spin"></i>')}function g(e,t,n){d(".progress",n).remove();var r=n.data("original-text");r?n.text(r):(r=n.data("original-html"))&&n.html(r),n.prop("disabled",!1)}function y(e,t,n,r,a,o){a=d.extend({},n.amsFormData,a.amsFormData,o.data),o=r.attr("name");return o&&(a[o]=r.val()),a}function M(e,t,n,r,a,o){var i=t.initDataCallback;i&&d.extend(r,i(e,t,n,r,a,o)),e.trigger("init-data.ams.form",[r,o])}function p(e,t){return d(t.submitTarget)}e.form=o;var b=d.templates({markup:'\n\t<div class="row m-3">\n\t\t<div class="text-center w-100">\n\t\t\t<i class="fa fa-3x fa-cog fa-spin"></i>\n\t\t\t{{if message}}\n\t\t\t<strong>{{:message}}</strong>\n\t\t\t{{/if}}\n\t\t</div>\n\t</div>'});function S(e,t,n){n.html(b.render({message:t.submitMessage})),n.parents(".hidden").removeClass("hidden")}function h(e,t,n){var t=n||t.submitHandler,t=t.startsWith(window.location.protocol)?t:MyAMS.ajax.getAddr()+t;return t}function v(t,o,i,e,n,s){e={url:n,type:"post",cache:!1,data:e,dataType:o.datatype,beforeSerialize:function(e){var t={veto:!1};if(e.trigger("before-serialize.ams.form",[t]),t.veto)return!1;void 0!==window.tinyMCE&&tinyMCE.triggerSave()},beforeSubmit:function(e,t){var n={veto:!1};if(t.trigger("before-submit.ams.form",[e,n]),n.veto)return!1;t.data("submitted",!0),o.resetBeforeSubmit&&setTimeout(function(){o.resetSubmitButton(t,o,i)},250)},uploadProgress:function(e,t,n,r){d(".progress",i).css("background-image","linear-gradient(to right, white -45%, green ".concat(r,"%, red ").concat(r,"%, red)"))},complete:function(e){t.trigger("complete.ams.form",[e])},success:function(e,t,n,r){var a={veto:!1};if(r.trigger("submit-success.ams.form",[e,t,n,a]),!a.veto){a=r.closest(".modal-dialog");a.exists()&&!o.keepModalOpen&&MyAMS.modal&&MyAMS.modal.close(a);try{o.submitCallback(r,o,s,e,t,n)}finally{o.resetAfterSubmit(r,o,i),MyAMS.form.resetChanged(r)}}},error:function(e,t,n,r){r.trigger("submit-error.ams.form",[e,t,n,s]),s&&o.resetAfterError(r,o,i,s),o.resetAfterSubmit(r,o,i)},iframe:!1};return d.extend({},e,o.submitOptions)}function A(e,t,n,r){var a=t.progressHandler;if(a){var o=t.progressFieldName;r[o]=MyAMS.core.generateUUID();n=n;return t.progressTarget&&(n=d(t.progressTarget)),{handler:a,interval:t.progressInterval,fieldname:o,target:n,callback:t.progressCallback,endCallback:t.progressEndCallback}}}function x(e,t,r,a,o){var i=setTimeout(function n(){var e={};e[a.fieldname]=r[a.fieldname];MyAMS.ajax.post(a.handler,e).then(MyAMS.core.getFunctionByName(a.callback||function(e,t){d.isArray(e)&&(t=e[1],e=e[0]),"success"===t?"running"===e.status?(e.message?o.text(e.message):(t=e.progress||o.data("ams-progress-text")||MyAMS.i18n.PROGRESS,e.current?t+=": ".concat(e.current," / ").concat(e.length||100):t+="...",o.text(t)),i=setTimeout(n,a.interval)):"finished"===e.status&&s():s()}),s)},a.interval);function s(){clearTimeout(i),t.resetSubmitButton(e,t,o),MyAMS.core.executeFunctionByName(a.endCallback,document,e,t,o),MyAMS.form.resetChanged(e)}}function C(e,t,n,r,a,o){a.progress&&t.getProgressState(e,t,r,a.progress,o),e.ajaxSubmit(a)}function T(e,t,n,r,a,o){var i=t.datatype;switch(i||(s=MyAMS.ajax.getResponse(o))&&(i=s.contentType,r=s.data),i){case"binary":case"script":case"xml":break;case"json":MyAMS.ajax.handleJSON(r,e,n);break;default:MyAMS.form.resetChanged(e),n.css({opacity:"0.0"}),n.removeClass("hidden").parents(".hidden").removeClass(".hidden"),n.html(r).delay(50).animate({opacity:"1.0"},250),MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,n).then(function(){MyAMS.require("ajax").then(function(){MyAMS.ajax.check(d.fn.scrollTo,"".concat(MyAMS.env.baseURL,"../ext/jquery-scrollto").concat(MyAMS.env.extext,".js")).then(function(){d("#main").scrollTo(n,{offset:-15})})})})}var s=o.getResponseHeader("X-AMS-Callback");s&&(i=o.getResponseHeader("X-AMS-Callback-Options")||"{}",MyAMS.core.executeFunctionByName(s,document,e,t,i,r,a,o)),e.trigger("after-submit.ams.form",[r])}function w(e,t,n){e.data("submitted")&&(t.resetSubmitButton(e,t,n),e.data("submitted",!1),e.removeData("ams-submit-button"),e.trigger("after-reset.ams.form"))}function k(e,t,n){d("i",n).removeClass("fa-spin").removeClass("fa-cog").addClass("fa-ambulance")}function F(e,t){return t.downloadTarget}function D(e,t,n,r){var a=d('iframe[name="'.concat(n,'"]'));a.exists()||(a=d("<iframe>").attr("name",n).hide().appendTo(MyAMS.dom.root)),d.extend(r,{iframe:!0,iframeTarget:a})}function R(e,t,n,r,a){var o=e.closest(".modal-dialog"),i=t.keepModalOpen;o.exists()&&!0!==i&&MyAMS.require("modal").then(function(){MyAMS.modal.close(o)}),a.progress||setTimeout(function(){t.resetAfterSubmit(e,t,n),MyAMS.ajax&&MyAMS.ajax.stop(),MyAMS.form.resetChanged(e)},t.resetTimeout)}window.MyAMS&&(MyAMS.env.bundle?MyAMS.config.modules.push("form"):(MyAMS.form=o,console.debug("MyAMS: form module loaded...")))});
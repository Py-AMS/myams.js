<h1>MyAMS "datatables" plug-in</h1>

<section>
	<p><strong>DataTables</strong> is another very common JQuery plug-in which allows to add
	nice extensions to classic HTML tables, including basic features like sorting and filtering,
	and more advanced ones like data export, printing, responsive rendering and many more.</p>
	<p>MyAMS provides a few custom options compared with default DataTables ones, and allows
	to download all extensions automatically if required.</p>
	<p>Except when specified explicitly, all DataTables options can be set using standard data
	attributes as defined by DataTables (see <a href="https://datatables.net">DataTables
	website</a>).</p>
	<p>As usual, custom data attributes defined by MyAMS can use the short <code>data-ams-</code>
	prefix, or <code>data-ams-datatable-</code> when name conflicts can occur.</p>
	<p>The simplest way to use DataTables is just to add the <code>datatable</code> class to
	a very standard table:</p>
	<section class="m-3">
		<h3>Table title</h3>
		<table id="myTable_1"
			   class="table table-bordered table-striped table-sm datatable width-100">
			<thead>
				<tr>
					<th>Name</th>
					<th>Value</th>
					<th>Address</th>
					<th>Email</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>John Doe</td>
					<td>Manager</td>
					<td>Boston</td>
					<td>john.doe@example.com</td>
				</tr>
				<tr>
					<td>Joe Bar</td>
					<td>Manager</td>
					<td>Paris</td>
					<td>joe.bar@example.com</td>
				</tr>
				<tr>
					<td>Wanda Foo</td>
					<td>Contributor</td>
					<td>Washington</td>
					<td>wanda.foo@example.com</td>
				</tr>
				<tr>
					<td>Gretta Davis</td>
					<td>Guest</td>
					<td>(unknown)</td>
					<td>(unknown)</td>
				</tr>
			</tbody>
		</table>
	</section>
<pre>	&lt;table class="table table-bordered table-striped table-sm datatable"&gt;
	  &lt;thead&gt;
	    &lt;tr&gt;...&lt;/tr&gt;
	  &lt;/thead&gt;
	  ...
	&lt;/table&gt;
</pre>
</section>

<section id="dt-order">
	<h2>Initial rows ordering</h2>
	<p>You can define the initial rows ordering using the <code>data-ams-order</code>
	attribute; you can set this attribute using a string or a JSON array: each array item is a tuple
	containing the row index and the order direction (<code>asc</code> or <code>desc</code>),
	like in: <code>data-ams-order='[[2, "asc"], [3, "desc"]]'</code>, which is equivalent to
	<code>data-ams-order="2,asc;3,desc"</code>.</p>
	<section class="m-3">
		<h3>Table title</h3>
		<table id="myTable_1.1"
			   class="table table-bordered table-striped table-sm datatable width-100"
			   data-ams-order="2,asc">
			<thead>
				<tr>
					<th>Name</th>
					<th>Value</th>
					<th>Address</th>
					<th>Email</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>John Doe</td>
					<td>Manager</td>
					<td>Boston</td>
					<td>john.doe@example.com</td>
				</tr>
				<tr>
					<td>Joe Bar</td>
					<td>Manager</td>
					<td>Paris</td>
					<td>joe.bar@example.com</td>
				</tr>
				<tr>
					<td>Wanda Foo</td>
					<td>Contributor</td>
					<td>Washington</td>
					<td>wanda.foo@example.com</td>
				</tr>
				<tr>
					<td>Gretta Davis</td>
					<td>Guest</td>
					<td>(unknown)</td>
					<td>(unknown)</td>
				</tr>
			</tbody>
		</table>
	</section>
<pre>	&lt;table class="table table-bordered table-striped table-sm datatable"
	        data-ams-order="2,asc"&gt;
	  &lt;thead&gt;
	    &lt;tr&gt;...&lt;/tr&gt;
	  &lt;/thead&gt;
	  ...
	&lt;/table&gt;
</pre>
</section>

<section id="dt-columns">
	<h2>Table column definitions</h2>
	<p>MyAMS and DataTables allows to define columns; this can be done with MyAMS by setting
	data attributes on columns headers.</p>
	<p>The <code>data-ams-stype</code> attribute can be used on a column header to define
	column's type, <code>data-ams-sortable</code> to define if a column can be sorted or not,
	and otherwise <code>data-ams-column</code> can store a serialized JSON object which can
	hold all column properties (see <a href="https://datatables.net/reference/option/columns">
	DataTables reference manual</a>).</p>
	<section class="m-3">
		<h3>Table title</h3>
		<table id="myTable_1.2"
			   class="table table-bordered table-striped table-sm datatable width-100">
			<thead>
				<tr>
					<th>Name</th>
					<th data-ams-column='{"className": "table-info"}'>Value</th>
					<th data-ams-type="html">Address</th>
					<th data-ams-sortable="false">Email</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>John Doe</td>
					<td>Manager</td>
					<td>Boston</td>
					<td>john.doe@example.com</td>
				</tr>
				<tr>
					<td>Joe Bar</td>
					<td>Manager</td>
					<td>Paris</td>
					<td>joe.bar@example.com</td>
				</tr>
				<tr>
					<td>Wanda Foo</td>
					<td>Contributor</td>
					<td>Washington</td>
					<td>wanda.foo@example.com</td>
				</tr>
				<tr>
					<td>Gretta Davis</td>
					<td>Guest</td>
					<td>(unknown)</td>
					<td>(unknown)</td>
				</tr>
			</tbody>
		</table>
	</section>
<pre>	&lt;table class="table table-bordered table-striped table-sm datatable"&gt;
	  &lt;thead&gt;
	    &lt;tr&gt;
	      &lt;th data-ams-type="html"&gt;Value&lt;/&gt;
	      &lt;th data-ams-sortable="false"&gt;Value&lt;/&gt;
	      &lt;th data-ams-column='{"className": "table-info"}'&gt;Value&lt;/&gt;
	    &lt;/tr&gt;
	  &lt;/thead&gt;
	  ...
	&lt;/table&gt;
</pre>
</section>

<section id="dt-buttons">
	<h2>Adding buttons</h2>
	<p>Standard buttons can be added just by adding a <code>data-buttons</code> attribute with
	a string value set to <code>default</code>; this will add <i>Copy</i> and <i>Print</i>
	buttons:</p>
	<section class="m-3">
		<h3>Table title</h3>
		<table id="myTable_2"
			   class="table table-bordered table-striped table-sm datatable width-100"
			   data-buttons="default">
			<thead>
				<tr>
					<th>Name</th>
					<th>Value</th>
					<th>Address</th>
					<th>Email</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>John Doe</td>
					<td>Manager</td>
					<td>Boston</td>
					<td>john.doe@example.com</td>
				</tr>
				<tr>
					<td>Joe Bar</td>
					<td>Manager</td>
					<td>Paris</td>
					<td>joe.bar@example.com</td>
				</tr>
				<tr>
					<td>Wanda Foo</td>
					<td>Contributor</td>
					<td>Washington</td>
					<td>wanda.foo@example.com</td>
				</tr>
				<tr>
					<td>Gretta Davis</td>
					<td>Guest</td>
					<td>(unknown)</td>
					<td>(unknown)</td>
				</tr>
			</tbody>
		</table>
	</section>
<pre>	&lt;table class="table table-bordered table-striped table-sm datatable"
	       data-buttons="default"&gt;
	  &lt;thead&gt;
	    &lt;tr&gt;...&lt;/tr&gt;
	  &lt;/thead&gt;
	  ...
	&lt;/table&gt;
</pre>

	<p>Setting <code>data-buttons</code> value to <code>all</code> instead of <code>default</code>
	will provide all common buttons:</p>
	<section class="m-3">
		<h3>Table title</h3>
		<table id="myTable_3"
			   class="table table-bordered table-striped table-sm datatable width-100"
			   data-buttons="all">
			<thead>
				<tr>
					<th>Name</th>
					<th>Value</th>
					<th>Address</th>
					<th>Email</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>John Doe</td>
					<td>Manager</td>
					<td>Boston</td>
					<td>john.doe@example.com</td>
				</tr>
				<tr>
					<td>Joe Bar</td>
					<td>Manager</td>
					<td>Paris</td>
					<td>joe.bar@example.com</td>
				</tr>
				<tr>
					<td>Wanda Foo</td>
					<td>Contributor</td>
					<td>Washington</td>
					<td>wanda.foo@example.com</td>
				</tr>
				<tr>
					<td>Gretta Davis</td>
					<td>Guest</td>
					<td>(unknown)</td>
					<td>(unknown)</td>
				</tr>
			</tbody>
		</table>
	</section>
<pre>	&lt;table class="table table-bordered table-striped table-sm datatable"
	       data-buttons="all"&gt;
	  &lt;thead&gt;
	    &lt;tr&gt;...&lt;/tr&gt;
	  &lt;/thead&gt;
	  ...
	&lt;/table&gt;
</pre>

	<p>Alternatively, you can use default Datatables syntax and specify an array of required
	buttons:</p>
	<section class="m-3">
		<h3>Table title</h3>
		<table id="myTable_4"
			   class="table table-bordered table-striped table-sm datatable width-100"
			   data-buttons='["copy", "csv", "print"]'>
			<thead>
				<tr>
					<th>Name</th>
					<th>Value</th>
					<th>Address</th>
					<th>Email</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>John Doe</td>
					<td>Manager</td>
					<td>Boston</td>
					<td>john.doe@example.com</td>
				</tr>
				<tr>
					<td>Joe Bar</td>
					<td>Manager</td>
					<td>Paris</td>
					<td>joe.bar@example.com</td>
				</tr>
				<tr>
					<td>Wanda Foo</td>
					<td>Contributor</td>
					<td>Washington</td>
					<td>wanda.foo@example.com</td>
				</tr>
				<tr>
					<td>Gretta Davis</td>
					<td>Guest</td>
					<td>(unknown)</td>
					<td>(unknown)</td>
				</tr>
			</tbody>
		</table>
	</section>
<pre>	&lt;table class="table table-bordered table-striped table-sm datatable"
	       data-buttons='["copy", "csv", "print"]'&gt;
	  &lt;thead&gt;
	    &lt;tr&gt;...&lt;/tr&gt;
	  &lt;/thead&gt;
	  ...
	&lt;/table&gt;
</pre>
</section>

<section id="dt-options">
	<h2>MyAMS <code>DataTables</code> plug-in options</h2>
	<p>The DataTables plug-in and all it's extensions options are extensively described into
	DataTables manual.</p>
	<p>MyAMS allows a dynamic loading of all requested extensions (including their stylesheets),
	which are activated using default DataTables data-attributes; for example, defining the
	<code>data-buttons</code> attribute will automatically download the <i>Buttons</i> extension,
	and all the dependencies required based on the requested buttons. All extensions are disabled
	by default, except the <i>Responsive</i> one which have to be disabled explicitly using
	<code>data-responsive="false"</code> attribute.</p>
	<p>Many DataTatables options and extensions can be defined using JSON objects, which can be
	set with data-attributes, or with Javascript using the <code>data-ams-init</code>
	callback or a <code>before-init</code> event handler; the following example implements both
	of them:</p>
	<section class="m-3">
		<h3>Table title</h3>
		<table id="myTable_5"
			   class="table table-bordered table-striped table-sm datatable width-100"
			   data-ams-modules='{"app": "resources/js/myams-app.js"}'
			   data-ams-init="MyAMS.app.datatables.initCallback"
			   data-ams-events-handlers='{
			   		"before-init.ams.datatable": "MyAMS.app.datatables.initHandler"
			   }'>
			<thead>
				<tr>
					<th>Name</th>
					<th>Value</th>
					<th>Address</th>
					<th>Email</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>John Doe</td>
					<td>Manager</td>
					<td>Boston</td>
					<td>john.doe@example.com</td>
				</tr>
				<tr>
					<td>Joe Bar</td>
					<td>Manager</td>
					<td>Paris</td>
					<td>joe.bar@example.com</td>
				</tr>
				<tr>
					<td>Wanda Foo</td>
					<td>Contributor</td>
					<td>Washington</td>
					<td>wanda.foo@example.com</td>
				</tr>
				<tr>
					<td>Gretta Davis</td>
					<td>Guest</td>
					<td>(unknown)</td>
					<td>(unknown)</td>
				</tr>
			</tbody>
		</table>
	</section>
<pre>	&lt;table class="table table-bordered table-striped table-sm datatable"
	       data-ams-modules='{"app": "resources/js/myams-app.js"}'
	       data-ams-init="MyAMS.app.datatables.initCallback"
	       data-ams-events-handlers='{
	         "before-init.ams.datatable": "MyAMS.app.datatables.initHandler"
	       }'&gt;
	  &lt;thead&gt;
	    &lt;tr&gt;...&lt;/tr&gt;
	  &lt;/thead&gt;
	  ...
	&lt;/table&gt;
</pre>
	<p>And here is the matching Javascript code:</p>
<pre>	datatables: {

		initCallback: (table, settings) => {
			settings.dom = `B${settings.dom}`;
			settings.buttons = ['copy', 'print'];
		},

		initHandler: function(evt, table, settings, veto) {
			settings.lengthMenu = [1, 3, 5, 10];
		}
	}
</pre>
</section>

<section id="dt-extensions">
	<h2>Custom DataTables extensions</h2>
	<p>MyAMS provides a few DataTables extensions; for example, we provide custom sorters and
	types detectors for dates and datetimes in Euro format (<code>DD/MM/YYYY</code>, or
	<code>DD/MM/YYY - HH:MM</code>); there is also a custom sorter called
	<code>numeric-comma</code>, which can be used to sort numeric values using a comma as
	separator.</p>
	<section class="m-3">
		<h3>Table title</h3>
		<table id="myTable_6"
			   class="table table-bordered table-striped table-sm datatable width-100">
			<thead>
				<tr>
					<th>Name</th>
					<th>Value</th>
					<th>Birth date</th>
					<th>Registration</th>
					<th>Value</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>John Doe</td>
					<td>Manager</td>
					<td>02/04/1969</td>
					<td>15/01/2018 - 11:20</td>
					<td>5</td>
				</tr>
				<tr>
					<td>Joe Bar</td>
					<td>Manager</td>
					<td>04/03/2002</td>
					<td>02/05/2019 - 10:30</td>
					<td>32,50</td>
				</tr>
				<tr>
					<td>Wanda Foo</td>
					<td>Contributor</td>
					<td>10/01/2020</td>
					<td>02/05/2019 - 08:42</td>
					<td>15,50</td>
				</tr>
				<tr>
					<td>Gretta Davis</td>
					<td>Guest</td>
					<td>15/02/2018</td>
					<td>15/01/2018 - 20:30</td>
					<td>8</td>
				</tr>
			</tbody>
		</table>
	</section>
</section>

<section id="dt-row-reorder">
	<h2>Handling tables ordering</h2>
	<p>There are use cases where you want to handle table's row odering manually, without using
	standard sorting features. MyAMS is adding a few helpers for this, all you have is to
	disable standard sorting features, and to specify a few options; you will notice that an
	cell is included in each row to display ordering handle:</p>
	<section class="m-3">
		<h3>Table with ordering</h3>
		<table id="myTable_7"
			   class="table table-bordered table-striped table-sm datatable width-100"
			   data-searching="false" data-info="false" data-paging="false" data-ordering="false"
			   data-row-reorder='{"update": false}'
			   data-ams-reorder-data="MyAMS.app.datatables.reorderDataGetter"
			   data-ams-reorder-url="data/reorder.json"
			   data-ams-reorder-post-attr="order"
			   data-ams-reorder-post-data="MyAMS.app.datatables.reorderPostDataGetter"
			   data-ams-reorder-callback="MyAMS.app.datatables.reorderCallback">
			<thead>
				<tr>
					<th data-ams-column='{"className": "reorder"}'></th>
					<th>Name</th>
					<th>Value</th>
					<th>Birth date</th>
					<th>Registration</th>
				</tr>
			</thead>
			<tbody>
				<tr data-ams-row-value="1">
					<td><i class="fas fa-arrows-alt-v"></i></td>
					<td>John Doe</td>
					<td>Manager</td>
					<td>02/04/1969</td>
					<td>15/01/2018 - 11:20</td>
				</tr>
				<tr data-ams-row-value="2">
					<td><i class="fas fa-arrows-alt-v"></i></td>
					<td>Joe Bar</td>
					<td>Manager</td>
					<td>04/03/2002</td>
					<td>02/05/2019 - 10:30</td>
				</tr>
				<tr data-ams-row-value="3">
					<td><i class="fas fa-arrows-alt-v"></i></td>
					<td>Wanda Foo</td>
					<td>Contributor</td>
					<td>10/01/2020</td>
					<td>02/05/2019 - 08:42</td>
				</tr>
				<tr data-ams-row-value="4">
					<td><i class="fas fa-arrows-alt-v"></i></td>
					<td>Gretta Davis</td>
					<td>Guest</td>
					<td>15/02/2018</td>
					<td>15/01/2018 - 20:30</td>
				</tr>
			</tbody>
		</table>
	</section>
<pre>	&lt;table id="myTable_7"
	       class="table table-bordered table-striped table-sm datatable width-100"
	       data-searching="false" data-info="false" data-paging="false" data-ordering="false"
	       data-row-reorder='{"update": false}'
	       data-ams-reorder-url="data/reorder.json"&gt;
	  &lt;thead&gt;
	    &lt;tr&gt;
	      &lt;th data-ams-column='{"className": "reorder"}'&gt;&lt;/th&gt;
	      &lt;th&gt;...&lt;/th&gt;
	      ...
	    &lt;/tr&gt;
	  &lt;/thead&gt;
	  &lt;tbody&gt;
	    &lt;tr data-ams-row-value="1"&gt;
	      &lt;td&gt;&lt;i class="fas fa-arrows-alt-v"&gt;&lt;/i&gt;&lt;/td&gt;
	      &lt;td&gt;...&lt;/td&gt;
	      ...
	    &lt;/tr&gt;
	    ...
	  &lt;/tbody&gt;
	&lt;/table&gt;
</pre>
	<div class="alert alert-info p-2 m-2" role="alert">
		<h5 class="alert-heading">
			<i class="fas fa-info-circle"></i>
			Info
		</h5>
		<p>You can notice how we disabled searching, info display, paging and ordering in this
		table; <code>rowReorder</code> updates have been disabled so we can handle submission
		of new table order to a remote service; the <code>reorder</code> CSS class is added to
		first column definition.</p>
	</div>
	<section class="m-3">
		<h3>MyAMS <code>reorder</code> custom options</h3>
		<p>Custom MyAMS options attributes used to handler rows ordering are prefixed by
		<code>data-ams-reorder-</code></p>
		<table class="table table-sm">
			<tr>
				<th>Name</th>
				<th>Default</th>
				<th>Description</th>
			</tr>
			<tr>
				<td><code>url</code></td>
				<td>null</td>
				<td>Target URL to which new order data are sent with a JSON POST.</td>
			</tr>
			<tr>
				<td><code>data</code></td>
				<td class="text-nowrap">data-ams-row-value</td>
				<td>This option can be defined in two ways: it can be the name of rows attribute
				containing the row value; it can also be the dotted name of a function which will
				be called to get this value for each row, with the row as argument.</td>
			</tr>
			<tr>
				<td class="text-nowrap"><code>post-data</code></td>
				<td>null</td>
				<td>By default, MyAMS just send an array of reordered rows IDs in a parameter
				called <code>order</code>; if you want to customize submitted JSON contents, you
				can set this attribute with the dotted name of a function which will be called to
				get this it: the function will receive two arguments which are the table and the
				new ordered list of rows IDs.</td>
			</tr>
			<tr>
				<td class="text-nowrap"><code>post-attr</code></td>
				<td>'order'</td>
				<td>If you don't define a custom <code>post-data</code> attribute to get POST data,
				the list of rows IDs will be send using this property name.</td>
			</tr>
			<tr>
				<td><code>callback</code></td>
				<td>null</td>
				<td>The JSON POST result is handled by MyAMS using
				<a href="#mod-ajax.html!handleJSON"><code>MyAMS.ajax.handleJSON</code></a>; if you
				want to provide your own callback, set this attribute with it's dotted name: it
				will be called with the original <code>table</code>, and with <code>result</code>,
				<code>status</code> and <code>xhr</code> arguments, like a classic JQuery AJAX
				call; the function must return a Promise.</td>
			</tr>
		</table>
		<div class="alert alert-warning p-2 m-2" role="alert">
			<h5 class="alert-heading">
				<i class="fas fa-info-circle"></i>
				Info
			</h5>
			<p>Like many DataTables extensions, Reorder events have to be applied on the
			DataTables object instead of the original DOM table, so they must be applied in
			Javascript in an after-init callback, like in:</p>
<pre>	afterInitCallback: (table, plugin, settings) => {
		plugin.on('row-reorder', (evt, details, changes) => {
			// event handling code
		}
	}
</pre>
		</div>
	</section>
</section>
